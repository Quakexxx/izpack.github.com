<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [izpack-changes] r1865 - in izpack-src/trunk/src/native: .	ShellLink_x64 ShellLink_x64/Release_Unicode ShellLink_x64/x64	ShellLink_x64/x64/Debug Unicode ShellLink_x64/x64/Release Unicode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:izpack-changes%40lists.berlios.de?Subject=%5Bizpack-changes%5D%20r1865%20-%20in%20izpack-src/trunk/src/native%3A%20.%0A%09ShellLink_x64%20ShellLink_x64/Release_Unicode%20ShellLink_x64/x64%0A%09ShellLink_x64/x64/Debug%20Unicode%20ShellLink_x64/x64/Release%20Unicode&In-Reply-To=">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000612.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[izpack-changes] r1865 - in izpack-src/trunk/src/native: .	ShellLink_x64 ShellLink_x64/Release_Unicode ShellLink_x64/x64	ShellLink_x64/x64/Debug Unicode ShellLink_x64/x64/Release Unicode</H1>
    <B>noreply at berlios.de</B> 
    <A HREF="mailto:izpack-changes%40lists.berlios.de?Subject=%5Bizpack-changes%5D%20r1865%20-%20in%20izpack-src/trunk/src/native%3A%20.%0A%09ShellLink_x64%20ShellLink_x64/Release_Unicode%20ShellLink_x64/x64%0A%09ShellLink_x64/x64/Debug%20Unicode%20ShellLink_x64/x64/Release%20Unicode&In-Reply-To="
       TITLE="[izpack-changes] r1865 - in izpack-src/trunk/src/native: .	ShellLink_x64 ShellLink_x64/Release_Unicode ShellLink_x64/x64	ShellLink_x64/x64/Debug Unicode ShellLink_x64/x64/Release Unicode">noreply at berlios.de
       </A><BR>
    <I>Thu Aug  9 22:24:33 CEST 2007</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000612.html">[izpack-changes] r1866 -	izpack-src/trunk/src/lib/com/izforge/izpack/util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#611">[ date ]</a>
              <a href="thread.html#611">[ thread ]</a>
              <a href="subject.html#611">[ subject ]</a>
              <a href="author.html#611">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: vralev
Date: 2007-08-09 22:24:04 +0200 (Thu, 09 Aug 2007)
New Revision: 1865

Added:
   izpack-src/trunk/src/native/ShellLink_x64/
   izpack-src/trunk/src/native/ShellLink_x64/Release/
   izpack-src/trunk/src/native/ShellLink_x64/Release_Unicode/
   izpack-src/trunk/src/native/ShellLink_x64/Release_Unicode/ShellLink_x64.dll
   izpack-src/trunk/src/native/ShellLink_x64/ShellLink.cpp
   izpack-src/trunk/src/native/ShellLink_x64/ShellLink.dsp
   izpack-src/trunk/src/native/ShellLink_x64/ShellLink.dsw
   izpack-src/trunk/src/native/ShellLink_x64/ShellLink.opt
   izpack-src/trunk/src/native/ShellLink_x64/ShellLink.sln
   izpack-src/trunk/src/native/ShellLink_x64/ShellLink.suo
   izpack-src/trunk/src/native/ShellLink_x64/ShellLink.vcproj
   izpack-src/trunk/src/native/ShellLink_x64/com_izforge_izpack_util_os_ShellLink.h
   izpack-src/trunk/src/native/ShellLink_x64/compile.cmd
   izpack-src/trunk/src/native/ShellLink_x64/x64/
   izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/
   izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/BuildLog.htm
   izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/ShellLink.dll.embed.manifest
   izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/ShellLink.dll.embed.manifest.res
   izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/ShellLink.dll.intermediate.manifest
   izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/mt.dep
   izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/
   izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/BuildLog.htm
   izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/ShellLink.dll.intermediate.manifest
   izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/mt.dep
Log:
64-bit ShellLink source

Added: izpack-src/trunk/src/native/ShellLink_x64/Release_Unicode/ShellLink_x64.dll
===================================================================
(Binary files differ)


Property changes on: izpack-src/trunk/src/native/ShellLink_x64/Release_Unicode/ShellLink_x64.dll
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: izpack-src/trunk/src/native/ShellLink_x64/ShellLink.cpp
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/ShellLink.cpp	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/ShellLink.cpp	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1,1305 @@
+/*
+ * IzPack - Copyright 2001-2005 Julien Ponge, All Rights Reserved.
+ * 
+ * <A HREF="http://www.izforge.com/izpack/">http://www.izforge.com/izpack/</A>
+ * <A HREF="http://developer.berlios.de/projects/izpack/">http://developer.berlios.de/projects/izpack/</A>
+ * 
+ * Copyright 2002 Elmar Grom
+ * 
+ * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ *     <A HREF="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</A>
+ *     
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+/* Defining AMD64 here because project settings do not keep the preprocessor
+ * definition for some reason.
+ */
+#define AMD64
+
+/* Stuff for differ between UNICODE and MBCS 
+ * May be this work only with visual studio 6.x
+ * To switch between MBCS and UNICODE change the
+ * precompiler defines from /D _MBCS to /D _UNICODE
+ * ----------------- START ---------------------
+ */
+
+
+#ifdef _UNICODE
+#define UNICODE
+#define NEW_STRING(a)		NewString(a, _tcslen((TCHAR*)a))
+#define GET_STRING_CHARS	GetStringChars
+#define RELEASE_STRING_CHARS ReleaseStringChars
+#else
+#define NEW_STRING(a)		NewStringUTF(a)
+#define GET_STRING_CHARS	GetStringUTFChars
+#define RELEASE_STRING_CHARS ReleaseStringUTFChars
+#endif
+#ifdef _WINDOWS
+#define WINVER 0x0400
+#define _WIN32_WINNT 0x0400
+#endif
+/* Stuff for differ between UNICODE and MBCS 
+ * May be this work only with visual studio 6.x
+ * ----------------- END ---------------------
+ */
+
+
+
+#include &quot;com_izforge_izpack_util_os_ShellLink.h&quot;
+#include &lt;winerror.h&gt;
+#include &lt;objbase.h&gt;
+#include &lt;basetyps.h&gt;
+#include &lt;shlobj.h&gt;
+#include &lt;objidl.h&gt;
+#include &lt;windows.h&gt;
+#include &lt;tchar.h&gt;
+
+// --------------------------------------------------------------------------
+// Gound rules used for the implementation of this native interface
+// of ShellLink:
+//
+// 1) all functions return an integer success code
+// 2) positive success codes report that everything went ok
+// 3) negative success codes report some type of problem
+// 4) a success code of 0 does not exist
+// 5) 'get' functions deposit their results in the corresponding member
+//    variables on the Java side.
+// 6) &quot;set' functions retrieve their input from the corresponding member
+//    variables on the Java side.
+// 7) functions other than 'get' and 'set' recive their input -if any- in
+//    the form of arguments.
+// 8) functions that are exposed on the Java side (public, protectd)
+//    follow the Java naming conventions, in that they begin with a lower
+//    case character.
+// 9) all functions that have a Java wrapper by the same name follow the
+//    Windows naming convention, in that they start with an upper case
+//    letter. This avoids having to invent new method names for Java and
+//    it allows to keep a clean naming convention on the Java side.
+// ============================================================================
+//
+// I M P O R T A N T !
+// -------------------
+//
+// This interface communicates with the OS via COM. In order for things to
+// work properly, it is necessary to observe the following pattern of
+// operation and to observe the order of execution (i.e. do not call
+// getInterface() before calling initializeCOM()).
+//
+// 1) call initializeCOM() - It's best to do this in the constructor
+// 2) call getInterface() - It's best to do this in the constructor as well
+//
+// 3) do your stuff (load, save, get, set ...)
+//
+// 4) call releaseInterface() before terminating the application, best done
+//    in the finalizer
+// 5) call releaseCOM() before terminating the application, best done
+//    in the finalizer. Do NOT call this if the call to initializeCOM() did
+//    not succeed, otherwise you'll mess things up pretty badly!
+// ============================================================================
+// Variables that must be declared on the Java side:
+//
+// private int     nativeHandle;
+//
+// private String  linkPath;
+// private String  linkName;
+//
+// private String  arguments;
+// private String  description;
+// private String  iconPath;
+// private String  targetPath;
+// private String  workingDirectory;
+//
+// private int     hotkey;
+// private int     iconIndex;
+// private int     showCommand;
+// private int     linkType;
+// --------------------------------------------------------------------------
+
+// --------------------------------------------------------------------------
+// Macro Definitions
+// --------------------------------------------------------------------------
+#define   ACCESS                0         // index for retrieving the registry access key
+#define   MIN_KEY               0         // for verifying that an index received in the form of a call parameter is actually leagal
+#define   MAX_KEY               5         // for verifying that an index received in the form of a call parameter is actually leagal
+
+// --------------------------------------------------------------------------
+// Prototypes
+// --------------------------------------------------------------------------
+// Hey C crowd, don't freak out! ShellLink.h is auto generated and I'd like
+// to have everything close by in this package. Besides, these are only used
+// in this file...
+// --------------------------------------------------------------------------
+int  getNewHandle ();
+void freeLinks ();
+
+// --------------------------------------------------------------------------
+// Constant Definitions
+// --------------------------------------------------------------------------
+
+// the registry keys to get access to the various shortcut locations for the current user
+const char CURRENT_USER_KEY [5][100] =
+{
+  &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders&quot;, // this is where the details are stored in the registry
+  &quot;Desktop&quot;,                                                               // this is where desktop shortcuts go
+  &quot;Programs&quot;,                                                              // this is where items of the progams menu go
+  &quot;Start Menu&quot;,                                                            // this is right in the start menu
+  &quot;Startup&quot;                                                                // this is where stuff goes that should be executed on OS launch
+};
+
+// the registry keys to get access to the various shortcut locations for all users
+const char ALL_USER_KEY [5][100] =
+{
+  &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders&quot;, // this is where the details are stored in the registry
+  &quot;Common Desktop&quot;,                                                        // this is where desktop shortcuts go
+  &quot;Common Programs&quot;,                                                       // this is where items of the progams menu go
+  &quot;Common Start Menu&quot;,                                                     // this is right in the start menu
+  &quot;Common Startup&quot;                                                         // this is where stuff goes that should be executed on OS launch
+};
+
+// Success Codes
+const jint  SL_OK                 =  1;     // returned if a call was successful
+const jint  SL_ERROR              = -1;     // unspecific return if a call was not successful
+const jint  SL_INITIALIZED        = -2;     // return value from initialization functions if already initialized
+const jint  SL_NOT_INITIALIZED    = -3;     // return value from uninitialization functions if never initialized
+const jint  SL_OUT_OF_HANDLES     = -4;     // there are no more interface handles available
+const jint  SL_NO_IPERSIST        = -5;     // could not get a handle for the IPersist interface
+const jint  SL_NO_SAVE            = -6;     // could not save the link
+const jint  SL_WRONG_DATA_TYPE    = -7;     // an unexpected data type has been passed or received
+const jint  SL_CAN_NOT_READ_PATH  = -8;     // was not able to read the link path from the Windows Registry
+
+const int   MAX_TEXT_LENGTH       =  1000;  // buffer size for text buffers
+const int   ALLOC_INCREMENT       =  10;    // allocation increment for allocation of additional storage space for link references
+
+// --------------------------------------------------------------------------
+// Variable Declarations
+// --------------------------------------------------------------------------
+int           referenceCount      = 0;
+
+// --------------------------------------------------------
+// DLLs are not objects!
+// --------------------
+// What this means is that if multiple references are made
+// to the same DLL in the same program space, no new
+// storage is allocated for the variables in the DLL.
+// For all practical purposes, variables in DLLs are equal
+// to static variables in classes - all instances share
+// the same storage space.
+// ========================================================
+// Since this code is designed to operate in conjunction
+// with a Java class, there is a possibility for multiple
+// instances of the class to acces this code 'simultaniously'.
+// As a result, one instance could be modifying the link
+// data for another instance. To avoid this, I am
+// artificially creating multiple DLL 'instances' by
+// providing a storage array for pointers to multiple
+// instances of IShellLink. Each Java instance must
+// access its IShellLink through a handle (the array
+// index where its corresponding pointer is stored).
+// ========================================================
+// For details on how this works see:
+// - getNewHandle()
+// - freeLinks()
+// --------------------------------------------------------
+int           linkCapacity        = 0;      // indicates the current capacity for storing pointers
+IShellLink**  p_shellLink         = NULL;   // pointers to the IShellLink interface
+
+// --------------------------------------------------------------------------
+// Gain COM access
+//
+// returns: SL_OK       if the initialization was successfull
+//          SL_ERROR    otherwise
+//
+// I M P O R T A N T !!
+// --------------------
+//
+// 1) This method must be called first!
+// 2) The application must call releaseCOM() just before terminating but
+//    only if a result of SL_OK was retruned form this function!
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_initializeCOM (JNIEnv  *env,
+                                                                                jobject  obj)
+{
+  HRESULT hres;
+
+  if (referenceCount &gt; 0)
+  {
+    referenceCount++;
+    return (SL_OK);
+  }
+
+  hres = CoInitializeEx (NULL, COINIT_APARTMENTTHREADED);
+
+  if (SUCCEEDED (hres))
+  {
+    referenceCount++;
+    return (SL_OK);
+  }
+
+  return (SL_ERROR);
+}
+
+// --------------------------------------------------------------------------
+// Releases COM and frees associated resources. This function should be
+// called as the very last operation before the application terminates.
+// Call this function only if a prior call to initializeCOM() returned SL_OK.
+//
+// returns: SL_OK               under normal circumstances
+//          SL_NOT_INITIALIZED  if the reference count indicates that no
+//                              current users exist.
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_releaseCOM (JNIEnv  *env,
+                                                                             jobject  obj)
+{
+  referenceCount--;
+
+  if (referenceCount == 0)
+  {
+    CoUninitialize ();
+    // This is the end of things, so this is a good time to
+    // free the storage for the IShellLink pointers.
+    freeLinks ();
+    return (SL_OK);
+  }
+  else if (referenceCount &lt; 0)
+  {
+    referenceCount++;
+    return (SL_NOT_INITIALIZED);
+  }
+  else
+  {
+    return (SL_OK);
+  }
+}
+
+// --------------------------------------------------------------------------
+// This function gains access to the ISchellLink interface. It must be
+// called before any other calls can be made but after initializeCOM().
+//
+// I M P O R T A N T !!
+// --------------------
+//
+// releaseInterface() must be called before terminating the application!
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_getInterface (JNIEnv  *env,
+                                                                               jobject  obj)
+{
+  HRESULT hres;
+  int     handle;
+
+  // Get a handle
+  handle = getNewHandle ();
+  if (handle &lt; 0)
+  {
+    return (SL_OUT_OF_HANDLES);
+  }
+
+  // Store the handle on the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass( obj );
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+
+  (env)-&gt;SetIntField (obj, handleID, (jint)handle);
+
+  /*
+   * Note: CoCreateInstance() supports only the creation of a single instance.
+   * Need to find out how to use CoGetClassObject() to create multiple instances.
+   * It should be possible to have multiple instances available, got to make this work!
+   */
+
+  // Get a pointer to the IShellLink interface
+  hres = CoCreateInstance (CLSID_ShellLink,
+                           NULL,
+                           CLSCTX_INPROC_SERVER,
+                           IID_IShellLink,
+                           (void **)&amp;p_shellLink [handle]);
+
+  // Do error handling
+  if (SUCCEEDED (hres))
+  {
+    return (SL_OK);
+  }
+
+  return (SL_ERROR);
+}
+
+// --------------------------------------------------------------------------
+// This function returns a new handle to be used for the next client. If no
+// more handles are available -1 is returnd.
+// --------------------------------------------------------------------------
+int getNewHandle ()
+{
+  IShellLink* pointer;
+
+  // loop through the array to find an unoccupied location
+  int i;
+  for (i = 0; i &lt; linkCapacity; i++)
+  {
+    pointer = p_shellLink [i];
+    // if an unoccupied location is found return the index
+    if (pointer == NULL)
+    {
+      return (i);
+    }
+  }
+
+  // if we get here, all locations are in use and we need to
+  // create more storage space to satisfy the request
+  int   newSize     = sizeof (IShellLink*) * (linkCapacity + ALLOC_INCREMENT);
+  void* tempPointer = realloc ((void *)p_shellLink, newSize);
+
+  if (tempPointer != NULL)
+  {
+    p_shellLink  = (IShellLink**)tempPointer;
+    linkCapacity = linkCapacity + ALLOC_INCREMENT;
+
+    for (int k = i; k &lt; linkCapacity; k++)
+    {
+      p_shellLink [k] = NULL;
+    }
+    return (i);
+  }
+  else
+  {
+    return (-1);
+  }
+}
+
+// --------------------------------------------------------------------------
+// This function frees the storage that was allocated for the storage of
+// pointers to IShellLink interfaces. It also cleans up any interfaces that
+// have not yet been reliquished (clients left a mess -&gt; bad boy!).
+// --------------------------------------------------------------------------
+void freeLinks ()
+{
+  if (p_shellLink != NULL)
+  {
+    // loop through the array and release any interfaces that
+    // have not been freed yet
+    IShellLink* pointer;
+    for (int i = 0; i &lt; linkCapacity; i++)
+    {
+      pointer = p_shellLink [i];
+      // if an unoccupied location is found, return the index
+      if (pointer != NULL)
+      {
+        pointer-&gt;Release ();
+        p_shellLink [i] = NULL;
+      }
+    }
+
+    // free the pointer storage itself
+    linkCapacity = 0;
+    free (p_shellLink);
+  }
+}
+
+// --------------------------------------------------------------------------
+// This function frees this dll, allowing the operating system to remove
+// the code from memory and releasing the reference to the dll on disk. 
+// After this call this dll can not be used any more.
+//
+// THIS FUNCTION DOES NOT RETURN !!!
+// --------------------------------------------------------------------------
+JNIEXPORT void JNICALL Java_com_izforge_izpack_util_os_ShellLink_FreeLibrary (JNIEnv *env, 
+                                                                              jobject obj,
+                                                                              jstring name)
+{
+  // convert the name from Java string type
+  const jchar *libraryName = (env)-&gt;GET_STRING_CHARS (name, 0);
+
+  // get a module handle 
+  HMODULE handle = GetModuleHandle ((TCHAR*)libraryName);
+
+  // release the string object
+  (env)-&gt;RELEASE_STRING_CHARS (name, libraryName);
+  
+  // now we are rady to free the library
+  FreeLibraryAndExitThread (handle, 0);
+}
+
+// --------------------------------------------------------------------------
+// Releases the interface
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_releaseInterface (JNIEnv  *env,
+                                                                                   jobject  obj)
+{
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  if (handle &lt; 0)
+  {
+    return (SL_OK);
+  }
+  
+  if (p_shellLink [handle] == NULL)
+  {
+    return (SL_NOT_INITIALIZED);
+  }
+
+  p_shellLink [handle]-&gt;Release ();
+  p_shellLink [handle] = NULL;
+  (env)-&gt;SetIntField (obj, handleID, -1);
+  return (SL_OK);
+}
+
+// --------------------------------------------------------------------------
+// Retrieves the command-line arguments associated with a shell link object
+//
+// Result is deposited in 'arguments'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetArguments (JNIEnv  *env,
+                                                                               jobject  obj)
+{
+  TCHAR    arguments [MAX_TEXT_LENGTH];
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  hres = p_shellLink [handle]-&gt;GetArguments (arguments,
+                                             MAX_TEXT_LENGTH);
+
+  // ------------------------------------------------------
+  // set the member variables
+  // ------------------------------------------------------
+  if (SUCCEEDED (hres))
+  {
+    jfieldID  argumentsID = (env)-&gt;GetFieldID      (cls, &quot;arguments&quot;, &quot;Ljava/lang/String;&quot;);
+    jstring   j_arguments = (env)-&gt;NEW_STRING      ((jchar*)arguments);
+
+    (env)-&gt;SetObjectField (obj, argumentsID, j_arguments);
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Retrieves the description string for a shell link object.
+//
+// Result is deposited in 'description'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetDescription (JNIEnv  *env,
+                                                                                 jobject  obj)
+{
+  TCHAR description [MAX_TEXT_LENGTH];
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  hres = p_shellLink [handle]-&gt;GetDescription (description,
+                                               MAX_TEXT_LENGTH);
+
+  if (SUCCEEDED (hres))
+  {
+    jfieldID  descriptionID = (env)-&gt;GetFieldID      (cls, &quot;description&quot;, &quot;Ljava/lang/String;&quot;);
+    jstring   j_description = (env)-&gt;NEW_STRING      ((jchar*)description); // convert to Java String type
+
+    (env)-&gt;SetObjectField (obj, descriptionID, j_description);
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Retrieves the hot key for a shell link object.
+//
+// Result is deposited in 'hotkey'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetHotkey	(JNIEnv  *env,
+                                                                             jobject  obj)
+{
+  WORD    hotkey;
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  hres = p_shellLink [handle]-&gt;GetHotkey (&amp;hotkey);
+
+  if (SUCCEEDED (hres))
+  {
+    jfieldID  hotkeyID = (env)-&gt;GetFieldID      (cls, &quot;hotkey&quot;, &quot;I&quot;);
+
+    (env)-&gt;SetIntField (obj, hotkeyID, (jint)hotkey);
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+
+
+}
+
+// --------------------------------------------------------------------------
+// Retrieves the location (path and index) of the icon for a shell link object.
+//
+// The path is deposited in 'iconPath'
+// The index is deposited in 'iconIndex'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetIconLocation	(JNIEnv  *env,
+                                                                                   jobject  obj)
+{
+  HRESULT hres;
+  TCHAR    iconPath [MAX_PATH];
+  int     iconIndex;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  hres = p_shellLink [handle]-&gt;GetIconLocation (iconPath,
+                                                MAX_PATH,
+                                                &amp;iconIndex);
+
+  // ------------------------------------------------------
+  // set the member variables
+  // ------------------------------------------------------
+  if (SUCCEEDED (hres))
+  {
+    jfieldID  pathID      = (env)-&gt;GetFieldID      (cls, &quot;iconPath&quot;, &quot;Ljava/lang/String;&quot;);
+    jfieldID  indexID     = (env)-&gt;GetFieldID      (cls, &quot;iconIndex&quot;, &quot;I&quot;);
+    jstring   j_iconPath  = (env)-&gt;NEW_STRING      ((jchar*)iconPath);
+
+    (env)-&gt;SetObjectField  (obj, pathID, j_iconPath);
+    (env)-&gt;SetIntField     (obj, indexID, (jint)iconIndex);
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+
+
+}
+
+// --------------------------------------------------------------------------
+// Retrieves the path and filename of a shell link object.
+//
+// Result is deposited in 'targetPath'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetPath (JNIEnv  *env,
+                                                                          jobject  obj)
+{
+  WIN32_FIND_DATA findData;
+  TCHAR            targetPath [MAX_PATH];
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  hres = p_shellLink [handle]-&gt;GetPath (targetPath,
+                                        MAX_PATH,
+                                        &amp;findData,
+                                        SLGP_UNCPRIORITY);
+
+  // ------------------------------------------------------
+  // set the member variables
+  // ------------------------------------------------------
+  if (SUCCEEDED (hres))
+  {
+    jfieldID  pathID        = (env)-&gt;GetFieldID(cls, &quot;targetPath&quot;, &quot;Ljava/lang/String;&quot;);
+    jstring   j_targetPath  = (env)-&gt;NEW_STRING(    (jchar*)targetPath);
+
+    (env)-&gt;SetObjectField (obj, pathID, j_targetPath);
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Retrieves the show (SW_) command for a shell link object.
+//
+// Result is deposited in 'showCommand'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetShowCommand (JNIEnv  *env,
+                                                                                 jobject  obj)
+{
+  HRESULT   hres;
+  int       showCommand;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  hres = p_shellLink [handle]-&gt;GetShowCmd (&amp;showCommand);
+
+  // ------------------------------------------------------
+  // set the member variables
+  // ------------------------------------------------------
+  if (SUCCEEDED (hres))
+  {
+    jfieldID  commandID = (env)-&gt;GetFieldID      (cls, &quot;showCommand&quot;, &quot;I&quot;);
+
+    (env)-&gt;SetIntField (obj, commandID, (jint)showCommand);
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Retrieves the name of the working directory for a shell link object.
+//
+// Result is deposited in 'workingDirectory'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetWorkingDirectory	(JNIEnv  *env,
+                                                                                       jobject  obj)
+{
+  HRESULT hres;
+  TCHAR workingDirectory [MAX_PATH];
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  hres = p_shellLink [handle]-&gt;GetWorkingDirectory (workingDirectory,
+                                                    MAX_PATH);
+
+  // ------------------------------------------------------
+  // set the member variables
+  // ------------------------------------------------------
+  if (SUCCEEDED (hres))
+  {
+    jfieldID  directoryID         = (env)-&gt;GetFieldID      (cls, &quot;workingDirectory&quot;, &quot;Ljava/lang/String;&quot;);
+    jstring   j_workingDirectory  = (env)-&gt;NEW_STRING      ((jchar*)workingDirectory);
+
+    (env)-&gt;SetObjectField (obj, directoryID, j_workingDirectory);
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Resolves a shell link by searching for the shell link object and
+// updating the shell link path and its list of identifiers (if necessary).
+//
+// I recommend to call this function before saving the shortcut. This will
+// ensure that the link is working and all the identifiers are updated, so
+// that the link will actually work when used later on. If for some reason
+// the link can not be resolved, at least the creating application knows
+// about this.
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_Resolve	(JNIEnv  *env,
+                                                                           jobject  obj)
+{
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  hres = p_shellLink [handle]-&gt;Resolve (NULL,
+                                        SLR_NO_UI | SLR_UPDATE);
+
+  if (SUCCEEDED (hres))
+  {
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Sets the command-line arguments associated with a shell link object.
+//
+// Input is taken from 'arguments'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetArguments (JNIEnv  *env,
+                                                                               jobject  obj)
+{
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  // ------------------------------------------------------
+  // get the member variables
+  // ------------------------------------------------------
+  jfieldID    argumentsID = (env)-&gt;GetFieldID               (cls, &quot;arguments&quot;, &quot;Ljava/lang/String;&quot;);
+  jstring     j_arguments = (jstring)(env)-&gt;GetObjectField  (obj, argumentsID);
+  const TCHAR *arguments   = (TCHAR*)(env)-&gt;GET_STRING_CHARS        (j_arguments, 0);
+
+  hres = p_shellLink [handle]-&gt;SetArguments (arguments);
+
+  (env)-&gt;RELEASE_STRING_CHARS(j_arguments, (jchar*)arguments);
+
+  if (SUCCEEDED (hres))
+  {
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Sets the description string for a shell link object.
+//
+// Input is taken from 'description'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetDescription (JNIEnv  *env,
+                                                                                 jobject  obj)
+{
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  // ------------------------------------------------------
+  // get the member variables
+  // ------------------------------------------------------
+  jfieldID    descriptionID = (env)-&gt;GetFieldID               (cls, &quot;description&quot;, &quot;Ljava/lang/String;&quot;);
+  jstring     j_description = (jstring)(env)-&gt;GetObjectField  (obj, descriptionID);
+  const TCHAR *description   = (TCHAR*)(env)-&gt;GET_STRING_CHARS        (j_description, 0);
+
+  hres = p_shellLink [handle]-&gt;SetDescription( description );
+
+  (env)-&gt;RELEASE_STRING_CHARS(j_description, (jchar*)description);
+
+  if (SUCCEEDED (hres))
+  {
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Sets the hot key for a shell link object.
+//
+// Input is taken from 'hotkey'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetHotkey	(JNIEnv  *env,
+                                                                             jobject  obj)
+{
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  // ------------------------------------------------------
+  // get the member variables
+  // ------------------------------------------------------
+  jfieldID    hotkeyID  = (env)-&gt;GetFieldID      (cls, &quot;hotkey&quot;, &quot;I&quot;);
+  jint        hotkey    = (env)-&gt;GetIntField     (obj, hotkeyID);
+
+  hres = p_shellLink [handle]-&gt;SetHotkey ((unsigned short)hotkey);
+  if (SUCCEEDED (hres))
+  {
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Sets the location (path and index) of the icon for a shell link object.
+//
+// The path is taken from 'iconPath'
+// The index is taken from 'iconIndex'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetIconLocation	(JNIEnv  *env,
+                                                                                   jobject  obj)
+{
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  // ------------------------------------------------------
+  // get the member variables
+  // ------------------------------------------------------
+  jfieldID    pathID        = (env)-&gt;GetFieldID               (cls, &quot;iconPath&quot;, &quot;Ljava/lang/String;&quot;);
+  jstring     j_iconPath    = (jstring)(env)-&gt;GetObjectField  (obj, pathID);
+  const TCHAR *iconPath      = (TCHAR*)(env)-&gt;GET_STRING_CHARS        (j_iconPath, 0);
+
+  jfieldID    indexID       = (env)-&gt;GetFieldID               (cls, &quot;iconIndex&quot;, &quot;I&quot;);
+  jint        iconIndex     = (env)-&gt;GetIntField              (obj, indexID);
+
+  hres = p_shellLink [handle]-&gt;SetIconLocation (iconPath,
+                                                iconIndex);
+
+  (env)-&gt;RELEASE_STRING_CHARS(j_iconPath, (jchar*)iconPath);
+
+  if (SUCCEEDED (hres))
+  {
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Sets the path and filename of a shell link object.
+//
+// Input is taken from 'targetPath'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetPath	(JNIEnv  *env,
+                                                                           jobject  obj)
+{
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  // ------------------------------------------------------
+  // get the member variables
+  // ------------------------------------------------------
+  jfieldID    pathID        = (env)-&gt;GetFieldID               (cls, &quot;targetPath&quot;, &quot;Ljava/lang/String;&quot;);
+  jstring     j_targetPath  = (jstring)(env)-&gt;GetObjectField  (obj, pathID);
+  const TCHAR *targetPath    = (TCHAR*)(env)-&gt;GET_STRING_CHARS        (j_targetPath, 0);
+
+  hres = p_shellLink [handle]-&gt;SetPath (targetPath);
+
+  (env)-&gt;RELEASE_STRING_CHARS(j_targetPath, (jchar*)targetPath);
+
+  if (SUCCEEDED (hres))
+  {
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Sets the show (SW_) command for a shell link object.
+//
+// Input is taken from 'showCommand'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetShowCommand (JNIEnv  *env,
+                                                                                 jobject  obj)
+{
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  // ------------------------------------------------------
+  // get the member variables
+  // ------------------------------------------------------
+  jfieldID    commandID   = (env)-&gt;GetFieldID      (cls, &quot;showCommand&quot;, &quot;I&quot;);
+  jint        showCommand = (env)-&gt;GetIntField     (obj, commandID);
+
+  hres = p_shellLink [handle]-&gt;SetShowCmd (showCommand);
+  if (SUCCEEDED (hres))
+  {
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// Sets the name of the working directory for a shell link object.
+//
+// Input is taken from 'workingDirectory'
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetWorkingDirectory	(JNIEnv  *env,
+                                                                                       jobject  obj)
+{
+  HRESULT hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  // ------------------------------------------------------
+  // get the member variables
+  // ------------------------------------------------------
+  jfieldID    pathID              = (env)-&gt;GetFieldID               (cls, &quot;workingDirectory&quot;, &quot;Ljava/lang/String;&quot;);
+  jstring     j_workingDirectory  = (jstring)(env)-&gt;GetObjectField  (obj, pathID);
+  const TCHAR *workingDirectory    = (TCHAR*)(env)-&gt;GET_STRING_CHARS        (j_workingDirectory, 0);
+
+  hres = p_shellLink [handle]-&gt;SetWorkingDirectory (workingDirectory);
+
+  (env)-&gt;RELEASE_STRING_CHARS(j_workingDirectory, (jchar*)workingDirectory);
+
+  if (SUCCEEDED (hres))
+  {
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+// --------------------------------------------------------------------------
+// This function saves the shell link.
+//
+// name - the fully qualified path for saving the shortcut.
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_saveLink (JNIEnv  *env,
+                                                                           jobject  obj,
+                                                                           jstring  name)
+{
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  // ----------------------------------------------------
+  // Query IShellLink for the IPersistFile interface for
+  // saving the shell link in persistent storage.
+  // ----------------------------------------------------
+  IPersistFile* p_persistFile;
+  HRESULT       hres = p_shellLink [handle]-&gt;QueryInterface (IID_IPersistFile,
+                                                             (void **)&amp;p_persistFile);
+
+  if (!SUCCEEDED (hres))
+  {
+    return (SL_NO_IPERSIST);
+  }
+
+  // ----------------------------------------------------
+  // convert from Java string type
+  // ----------------------------------------------------
+  const unsigned short *pathName = (env)-&gt;GetStringChars (name, 0);
+  
+  // ----------------------------------------------------
+  // Save the link
+  // ----------------------------------------------------
+  hres = p_persistFile-&gt;Save   ((wchar_t*)pathName, FALSE);
+  p_persistFile-&gt;SaveCompleted ((wchar_t*)pathName);
+  
+  // ----------------------------------------------------
+  // Release the pointer to IPersistFile
+  // and the string object
+  // ----------------------------------------------------
+  p_persistFile-&gt;Release ();
+  (env)-&gt;ReleaseStringChars (name, pathName);
+
+  // ------------------------------------------------------
+  // return success code
+  // ------------------------------------------------------
+  if (SUCCEEDED (hres))
+  {
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_NO_SAVE);
+  }
+}
+
+// --------------------------------------------------------------------------
+// This function loads a shell link.
+//
+// name - the fully qualified path for loading the shortcut.
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_loadLink (JNIEnv  *env,
+                                                                           jobject  obj,
+                                                                           jstring  name)
+{
+  HRESULT     hres;
+
+  // Get the handle from the Java side
+  jclass      cls       = (env)-&gt;GetObjectClass  (obj);
+  jfieldID    handleID  = (env)-&gt;GetFieldID      (cls, &quot;nativeHandle&quot;, &quot;I&quot;);
+  jint        handle    = (env)-&gt;GetIntField     (obj, handleID);
+
+  // ----------------------------------------------------
+  // Query IShellLink for the IPersistFile interface for
+  // saving the shell link in persistent storage.
+  // ----------------------------------------------------
+  IPersistFile* p_persistFile;
+  hres = p_shellLink [handle]-&gt;QueryInterface (IID_IPersistFile,
+                                               (void **)&amp;p_persistFile);
+
+  if (SUCCEEDED (hres))
+  {
+    // convert from Java string type
+    const unsigned short *pathName = (env)-&gt;GetStringChars (name, 0);
+
+    // --------------------------------------------------
+    // Load the link
+    // --------------------------------------------------
+    hres = p_persistFile-&gt;Load ((wchar_t *)pathName,
+                                STGM_DIRECT    |
+                                STGM_READWRITE |
+                                STGM_SHARE_EXCLUSIVE);
+
+    // --------------------------------------------------
+    // Release the pointer to IPersistFile
+    // --------------------------------------------------
+    p_persistFile-&gt;Release ();
+    (env)-&gt;ReleaseStringChars (name, pathName);
+  }
+
+  // ------------------------------------------------------
+  // return success code
+  // ------------------------------------------------------
+  if (SUCCEEDED (hres))
+  {
+    return (SL_OK);
+  }
+  else
+  {
+    return (SL_ERROR);
+  }
+}
+
+
+// --------------------------------------------------------------------------
+// resolves a Windows Standard path using SHGetPathFromIDList
+// inputs:
+//  inc iCsidl - one of the CSIDL
+//    valid  	CSIDL_COMMON_DESKTOPDIRECTORY
+//				CSIDL_COMMON_STARTMENU	
+//				CSIDL_COMMON_PROGRAMS
+//				CSIDL_COMMON_STARTUP
+//           	CSIDL_DESKTOPDIRECTORY
+//				CSIDL_STARTMENU	
+//				CSIDL_PROGRAMS
+//				CSIDL_STARTUP
+// returns:
+//   the Windows Standard Path in szPath.
+// --------------------------------------------------------------------------
+LONG GetLinkPath( int iCsidl, LPTSTR szPath )
+{
+    HRESULT hr;
+
+    // Allocate a pointer to an Item ID list
+    LPITEMIDLIST pidl;
+
+    // Get a pointer to an item ID list that
+    // represents the path of a special folder
+    hr = SHGetSpecialFolderLocation(NULL, iCsidl, &amp;pidl);
+
+    if ( SUCCEEDED(hr) )
+    {
+        // Convert the item ID list's binary
+        // representation into a file system path
+        BOOL f = SHGetPathFromIDList(pidl, szPath);
+
+        // Allocate a pointer to an IMalloc interface
+        LPMALLOC pMalloc;
+
+        // Get the address of our task allocator's IMalloc interface
+        hr = SHGetMalloc(&amp;pMalloc);
+
+        // Free the item ID list allocated by SHGetSpecialFolderLocation
+        pMalloc-&gt;Free(pidl);
+
+        // Free our task allocator
+        pMalloc-&gt;Release();
+
+		if ( f == FALSE )
+		{
+		    *szPath = TCHAR('\0');
+			return E_FAIL;
+		}
+
+        // return the special folder's path (contained in szPath)
+        return S_OK;
+    }
+	else
+	{
+		// null path for error return.
+		*szPath = TCHAR('\0');
+	}
+
+	return E_FAIL;
+}
+
+// --------------------------------------------------------------------------
+// This function retrieves the location of the folders that hold shortcuts.
+// The information comes from SHGetSpecialFolderLocation, 
+// since it's more accurate.
+//  SHGetSpecialFolderLocation (since shell32.dll ver 4.0 - win 95, IE 3).
+//
+// target   - where the path should point. The following are legal values
+//            to use
+//
+//            1 - path for shortcuts that show on the desktop
+//            2 - path for shortcuts that show in the Programs menu
+//            3 - path for shortcuts that show in the start menu
+//            4 - path to the Startup group. These shortcuts are executed
+//                at OS launch time
+//
+//            Note: all other values cause an empty string to be returned
+//
+// Program groups (sub-menus) in the programs and start menus can be created
+// by creating a new folder at the indicated location and placing the links
+// in that folder. These folders can be nested to any depth with each level
+// creating an additional menu level.
+//
+// Results are deposited in 'currentUserLinkPath' and 'allUsersLinkPath' 
+// respectively
+// --------------------------------------------------------------------------
+// --------------------------------------------------------------------------
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetFullLinkPath
+  (JNIEnv *env, jobject obj, jint utype, jint ltype)
+{
+  ULONG   ul_size = MAX_PATH;       // buffer size
+  TCHAR   szPath [MAX_PATH];        // path we are looking for 
+  int	  csidl;
+  jclass	cls;
+  jfieldID  pathID;
+  jstring   j_path;
+  LONG 		successCode;
+  
+  if ((ltype &gt; MIN_KEY) &amp;&amp; (ltype &lt; MAX_KEY))
+  {
+	//translate request into a CSIDL, based on user-type and link-type
+
+	// user type
+	if ( utype == com_izforge_izpack_util_os_ShellLink_ALL_USERS )
+	{
+		switch ( ltype )		// link type
+		{
+			case ( com_izforge_izpack_util_os_ShellLink_DESKTOP ) :
+			csidl = CSIDL_COMMON_DESKTOPDIRECTORY;
+			break;
+
+			case ( com_izforge_izpack_util_os_ShellLink_START_MENU ) :
+			csidl = CSIDL_COMMON_STARTMENU;
+			break;
+
+			case ( com_izforge_izpack_util_os_ShellLink_PROGRAM_MENU ) :
+			csidl = CSIDL_COMMON_PROGRAMS;
+			break;
+
+			case ( com_izforge_izpack_util_os_ShellLink_STARTUP ) :
+			csidl = CSIDL_COMMON_STARTUP;
+			break;
+
+			default :
+			break;
+		}
+
+		successCode = GetLinkPath( csidl, szPath );
+
+		if ( SUCCEEDED(successCode) )
+		{
+
+			// ------------------------------------------------------
+			// set the member variables
+			// ------------------------------------------------------
+			cls    = (env)-&gt;GetObjectClass (obj);
+			pathID = (env)-&gt;GetFieldID     (cls, &quot;allUsersLinkPath&quot;, &quot;Ljava/lang/String;&quot;);
+			j_path = (env)-&gt;NEW_STRING   ((jchar*)szPath);
+
+			(env)-&gt;SetObjectField (obj, pathID, j_path);
+			return (SL_OK);
+		}
+		else
+		{
+			// failure code from GetLinkPath()
+			return successCode;
+		}
+	}
+	else if ( utype == com_izforge_izpack_util_os_ShellLink_CURRENT_USER )
+	{
+		switch ( ltype )		// link type
+		{
+			case ( com_izforge_izpack_util_os_ShellLink_DESKTOP ) :
+			csidl = CSIDL_DESKTOPDIRECTORY;
+			break;
+
+			case ( com_izforge_izpack_util_os_ShellLink_START_MENU ) :
+			csidl = CSIDL_STARTMENU;
+			break;
+
+			case ( com_izforge_izpack_util_os_ShellLink_PROGRAM_MENU ) :
+			csidl = CSIDL_PROGRAMS;
+			break;
+
+			case ( com_izforge_izpack_util_os_ShellLink_STARTUP ) :
+			csidl = CSIDL_STARTUP;
+			break;
+
+			default :
+			break;
+		}
+
+		successCode = GetLinkPath( csidl, szPath );
+
+		if ( SUCCEEDED(successCode) )
+		{
+			// ------------------------------------------------------
+			// set the member variables
+			// ------------------------------------------------------
+			cls    = (env)-&gt;GetObjectClass (obj);
+			pathID = (env)-&gt;GetFieldID     (cls, &quot;currentUserLinkPath&quot;, &quot;Ljava/lang/String;&quot;);
+			j_path = (env)-&gt;NEW_STRING   ((jchar*)szPath);
+
+			(env)-&gt;SetObjectField (obj, pathID, j_path);
+
+			return (SL_OK);
+		}
+		else
+		{
+			// failure code from GetLinkPath()
+			return successCode;
+		}
+	}
+
+  }
+
+  return SL_CAN_NOT_READ_PATH;
+}
+

Added: izpack-src/trunk/src/native/ShellLink_x64/ShellLink.dsp
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/ShellLink.dsp	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/ShellLink.dsp	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1,169 @@
+# Microsoft Developer Studio Project File - Name=&quot;ShellLink&quot; - Package Owner=&lt;4&gt;
+# Microsoft Developer Studio Generated Build File, Format Version 6.00
+# ** NICHT BEARBEITEN **
+
+# TARGTYPE &quot;Win32 (x86) Dynamic-Link Library&quot; 0x0102
+
+CFG=ShellLink - Win32 Debug Unicode
+!MESSAGE Dies ist kein g&#252;ltiges Makefile. Zum Erstellen dieses Projekts mit NMAKE
+!MESSAGE verwenden Sie den Befehl &quot;Makefile exportieren&quot; und f&#252;hren Sie den Befehl
+!MESSAGE 
+!MESSAGE NMAKE /f &quot;ShellLink.mak&quot;.
+!MESSAGE 
+!MESSAGE Sie k&#246;nnen beim Ausf&#252;hren von NMAKE eine Konfiguration angeben
+!MESSAGE durch Definieren des Makros CFG in der Befehlszeile. Zum Beispiel:
+!MESSAGE 
+!MESSAGE NMAKE /f &quot;ShellLink.mak&quot; CFG=&quot;ShellLink - Win32 Debug Unicode&quot;
+!MESSAGE 
+!MESSAGE F&#252;r die Konfiguration stehen zur Auswahl:
+!MESSAGE 
+!MESSAGE &quot;ShellLink - Win32 Release&quot; (basierend auf  &quot;Win32 (x86) Dynamic-Link Library&quot;)
+!MESSAGE &quot;ShellLink - Win32 Debug&quot; (basierend auf  &quot;Win32 (x86) Dynamic-Link Library&quot;)
+!MESSAGE &quot;ShellLink - Win32 Release Unicode&quot; (basierend auf  &quot;Win32 (x86) Dynamic-Link Library&quot;)
+!MESSAGE &quot;ShellLink - Win32 Debug Unicode&quot; (basierend auf  &quot;Win32 (x86) Dynamic-Link Library&quot;)
+!MESSAGE 
+
+# Begin Project
+# PROP AllowPerConfigDependencies 0
+# PROP Scc_ProjName &quot;&quot;
+# PROP Scc_LocalPath &quot;&quot;
+CPP=cl.exe
+MTL=midl.exe
+RSC=rc.exe
+
+!IF  &quot;$(CFG)&quot; == &quot;ShellLink - Win32 Release&quot;
+
+# PROP BASE Use_MFC 0
+# PROP BASE Use_Debug_Libraries 0
+# PROP BASE Output_Dir &quot;Release&quot;
+# PROP BASE Intermediate_Dir &quot;Release&quot;
+# PROP BASE Target_Dir &quot;&quot;
+# PROP Use_MFC 0
+# PROP Use_Debug_Libraries 0
+# PROP Output_Dir &quot;Release&quot;
+# PROP Intermediate_Dir &quot;Release&quot;
+# PROP Ignore_Export_Lib 0
+# PROP Target_Dir &quot;&quot;
+# ADD BASE CPP /nologo /MT /W3 /GX /O2 /D &quot;WIN32&quot; /D &quot;NDEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /D &quot;_USRDLL&quot; /D &quot;SHELLLINK_EXPORTS&quot; /YX /FD /c
+# ADD CPP /nologo /MT /w /W0 /GX /I &quot;C:\usr\java\jdk1.3.1_05\include&quot; /I &quot;C:\usr\java\jdk1.3.1_05\include\win32&quot; /D &quot;WIN32&quot; /D &quot;NDEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /D &quot;_USRDLL&quot; /D &quot;SHELLLINK_EXPORTS&quot; /YX /FD /c
+# ADD BASE MTL /nologo /D &quot;NDEBUG&quot; /mktyplib203 /win32
+# ADD MTL /nologo /D &quot;NDEBUG&quot; /mktyplib203 /win32
+# ADD BASE RSC /l 0x407 /d &quot;NDEBUG&quot;
+# ADD RSC /l 0x407 /d &quot;NDEBUG&quot;
+BSC32=bscmake.exe
+# ADD BASE BSC32 /nologo
+# ADD BSC32 /nologo
+LINK32=link.exe
+# ADD BASE LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /dll /machine:I386
+# ADD LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /dll /machine:I386
+
+!ELSEIF  &quot;$(CFG)&quot; == &quot;ShellLink - Win32 Debug&quot;
+
+# PROP BASE Use_MFC 0
+# PROP BASE Use_Debug_Libraries 1
+# PROP BASE Output_Dir &quot;Debug&quot;
+# PROP BASE Intermediate_Dir &quot;Debug&quot;
+# PROP BASE Target_Dir &quot;&quot;
+# PROP Use_MFC 0
+# PROP Use_Debug_Libraries 1
+# PROP Output_Dir &quot;Debug&quot;
+# PROP Intermediate_Dir &quot;Debug&quot;
+# PROP Ignore_Export_Lib 0
+# PROP Target_Dir &quot;&quot;
+# ADD BASE CPP /nologo /MTd /W3 /Gm /GX /ZI /Od /D &quot;WIN32&quot; /D &quot;_DEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /D &quot;_USRDLL&quot; /D &quot;SHELLLINK_EXPORTS&quot; /YX /FD /GZ /c
+# ADD CPP /nologo /MTd /W3 /Gm /GX /ZI /Od /I &quot;C:\usr\java\jdk1.3.1_05\include&quot; /I &quot;C:\usr\java\jdk1.3.1_05\include\win32&quot; /D &quot;WIN32&quot; /D &quot;_DEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /D &quot;_USRDLL&quot; /D &quot;SHELLLINK_EXPORTS&quot; /YX /FD /GZ /c
+# ADD BASE MTL /nologo /D &quot;_DEBUG&quot; /mktyplib203 /win32
+# ADD MTL /nologo /D &quot;_DEBUG&quot; /mktyplib203 /win32
+# ADD BASE RSC /l 0x407 /d &quot;_DEBUG&quot;
+# ADD RSC /l 0x407 /d &quot;_DEBUG&quot;
+BSC32=bscmake.exe
+# ADD BASE BSC32 /nologo
+# ADD BSC32 /nologo
+LINK32=link.exe
+# ADD BASE LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /dll /debug /machine:I386 /pdbtype:sept
+# ADD LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /dll /debug /machine:I386 /pdbtype:sept
+
+!ELSEIF  &quot;$(CFG)&quot; == &quot;ShellLink - Win32 Release Unicode&quot;
+
+# PROP BASE Use_MFC 0
+# PROP BASE Use_Debug_Libraries 0
+# PROP BASE Output_Dir &quot;Release_Unicode&quot;
+# PROP BASE Intermediate_Dir &quot;Release_Unicode&quot;
+# PROP BASE Ignore_Export_Lib 0
+# PROP BASE Target_Dir &quot;&quot;
+# PROP Use_MFC 0
+# PROP Use_Debug_Libraries 0
+# PROP Output_Dir &quot;Release_Unicode&quot;
+# PROP Intermediate_Dir &quot;Release_Unicode&quot;
+# PROP Ignore_Export_Lib 0
+# PROP Target_Dir &quot;&quot;
+# ADD BASE CPP /nologo /MT /w /W0 /GX /I &quot;C:\usr\java\jdk1.3.1_05\include&quot; /I &quot;C:\usr\java\jdk1.3.1_05\include\win32&quot; /D &quot;WIN32&quot; /D &quot;NDEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /D &quot;_USRDLL&quot; /D &quot;SHELLLINK_EXPORTS&quot; /YX /FD /c
+# ADD CPP /nologo /MT /w /W0 /GX /I &quot;C:\usr\java\jdk1.3.1_05\include&quot; /I &quot;C:\usr\java\jdk1.3.1_05\include\win32&quot; /D &quot;WIN32&quot; /D &quot;NDEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_UNICODE&quot; /D &quot;_USRDLL&quot; /D &quot;SHELLLINK_EXPORTS&quot; /YX /FD /c
+# ADD BASE MTL /nologo /D &quot;NDEBUG&quot; /mktyplib203 /win32
+# ADD MTL /nologo /D &quot;NDEBUG&quot; /mktyplib203 /win32
+# ADD BASE RSC /l 0x407 /d &quot;NDEBUG&quot;
+# ADD RSC /l 0x407 /d &quot;NDEBUG&quot;
+BSC32=bscmake.exe
+# ADD BASE BSC32 /nologo
+# ADD BSC32 /nologo
+LINK32=link.exe
+# ADD BASE LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /dll /machine:I386
+# ADD LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /dll /machine:I386
+
+!ELSEIF  &quot;$(CFG)&quot; == &quot;ShellLink - Win32 Debug Unicode&quot;
+
+# PROP BASE Use_MFC 0
+# PROP BASE Use_Debug_Libraries 1
+# PROP BASE Output_Dir &quot;Debug_Unicode&quot;
+# PROP BASE Intermediate_Dir &quot;Debug_Unicode&quot;
+# PROP BASE Ignore_Export_Lib 0
+# PROP BASE Target_Dir &quot;&quot;
+# PROP Use_MFC 0
+# PROP Use_Debug_Libraries 1
+# PROP Output_Dir &quot;Debug_Unicode&quot;
+# PROP Intermediate_Dir &quot;Debug_Unicode&quot;
+# PROP Ignore_Export_Lib 0
+# PROP Target_Dir &quot;&quot;
+# ADD BASE CPP /nologo /MTd /W3 /Gm /GX /ZI /Od /I &quot;C:\usr\java\jdk1.3.1_05\include&quot; /I &quot;C:\usr\java\jdk1.3.1_05\include\win32&quot; /D &quot;WIN32&quot; /D &quot;_DEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_MBCS&quot; /D &quot;_USRDLL&quot; /D &quot;SHELLLINK_EXPORTS&quot; /YX /FD /GZ /c
+# ADD CPP /nologo /MTd /W3 /Gm /GX /ZI /Od /I &quot;C:\usr\java\jdk1.3.1_05\include&quot; /I &quot;C:\usr\java\jdk1.3.1_05\include\win32&quot; /D &quot;WIN32&quot; /D &quot;_DEBUG&quot; /D &quot;_WINDOWS&quot; /D &quot;_UNICODE&quot; /D &quot;_USRDLL&quot; /D &quot;SHELLLINK_EXPORTS&quot; /YX /FD /GZ /c
+# ADD BASE MTL /nologo /D &quot;_DEBUG&quot; /mktyplib203 /win32
+# ADD MTL /nologo /D &quot;_DEBUG&quot; /mktyplib203 /win32
+# ADD BASE RSC /l 0x407 /d &quot;_DEBUG&quot;
+# ADD RSC /l 0x407 /d &quot;_DEBUG&quot;
+BSC32=bscmake.exe
+# ADD BASE BSC32 /nologo
+# ADD BSC32 /nologo
+LINK32=link.exe
+# ADD BASE LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /dll /debug /machine:I386 /pdbtype:sept
+# ADD LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /dll /debug /machine:I386 /pdbtype:sept
+
+!ENDIF 
+
+# Begin Target
+
+# Name &quot;ShellLink - Win32 Release&quot;
+# Name &quot;ShellLink - Win32 Debug&quot;
+# Name &quot;ShellLink - Win32 Release Unicode&quot;
+# Name &quot;ShellLink - Win32 Debug Unicode&quot;
+# Begin Group &quot;Quellcodedateien&quot;
+
+# PROP Default_Filter &quot;cpp;c;cxx;rc;def;r;odl;idl;hpj;bat&quot;
+# Begin Source File
+
+SOURCE=.\ShellLink.cpp
+# End Source File
+# End Group
+# Begin Group &quot;Header-Dateien&quot;
+
+# PROP Default_Filter &quot;h;hpp;hxx;hm;inl&quot;
+# Begin Source File
+
+SOURCE=.\com_izforge_izpack_util_os_ShellLink.h
+# End Source File
+# End Group
+# Begin Group &quot;Ressourcendateien&quot;
+
+# PROP Default_Filter &quot;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe&quot;
+# End Group
+# End Target
+# End Project

Added: izpack-src/trunk/src/native/ShellLink_x64/ShellLink.dsw
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/ShellLink.dsw	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/ShellLink.dsw	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1,29 @@
+Microsoft Developer Studio Workspace File, Format Version 6.00
+# WARNUNG: DIESE ARBEITSBEREICHSDATEI DARF NICHT BEARBEITET ODER GEL&#214;SCHT WERDEN!
+
+###############################################################################
+
+Project: &quot;ShellLink&quot;=&quot;.\ShellLink.dsp&quot; - Package Owner=&lt;4&gt;
+
+Package=&lt;5&gt;
+{{{
+}}}
+
+Package=&lt;4&gt;
+{{{
+}}}
+
+###############################################################################
+
+Global:
+
+Package=&lt;5&gt;
+{{{
+}}}
+
+Package=&lt;3&gt;
+{{{
+}}}
+
+###############################################################################
+

Added: izpack-src/trunk/src/native/ShellLink_x64/ShellLink.opt
===================================================================
(Binary files differ)


Property changes on: izpack-src/trunk/src/native/ShellLink_x64/ShellLink.opt
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: izpack-src/trunk/src/native/ShellLink_x64/ShellLink.sln
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/ShellLink.sln	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/ShellLink.sln	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1,26 @@
+&#239;&#187;&#191;
+Microsoft Visual Studio Solution File, Format Version 9.00
+# Visual Studio 2005
+Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;ShellLink&quot;, &quot;ShellLink.vcproj&quot;, &quot;{BF46B82B-A948-4C56-91C8-A5F20FB2D869}&quot;
+EndProject
+Global
+	GlobalSection(SolutionConfigurationPlatforms) = preSolution
+		Debug Unicode|Win32 = Debug Unicode|Win32
+		Debug|Win32 = Debug|Win32
+		Release Unicode|Win32 = Release Unicode|Win32
+		Release|Win32 = Release|Win32
+	EndGlobalSection
+	GlobalSection(ProjectConfigurationPlatforms) = postSolution
+		{BF46B82B-A948-4C56-91C8-A5F20FB2D869}.Debug Unicode|Win32.ActiveCfg = Debug Unicode|Win32
+		{BF46B82B-A948-4C56-91C8-A5F20FB2D869}.Debug Unicode|Win32.Build.0 = Debug Unicode|Win32
+		{BF46B82B-A948-4C56-91C8-A5F20FB2D869}.Debug|Win32.ActiveCfg = Debug|Win32
+		{BF46B82B-A948-4C56-91C8-A5F20FB2D869}.Debug|Win32.Build.0 = Debug|Win32
+		{BF46B82B-A948-4C56-91C8-A5F20FB2D869}.Release Unicode|Win32.ActiveCfg = Release Unicode|Win32
+		{BF46B82B-A948-4C56-91C8-A5F20FB2D869}.Release Unicode|Win32.Build.0 = Release Unicode|Win32
+		{BF46B82B-A948-4C56-91C8-A5F20FB2D869}.Release|Win32.ActiveCfg = Release|Win32
+		{BF46B82B-A948-4C56-91C8-A5F20FB2D869}.Release|Win32.Build.0 = Release|Win32
+	EndGlobalSection
+	GlobalSection(SolutionProperties) = preSolution
+		HideSolutionNode = FALSE
+	EndGlobalSection
+EndGlobal

Added: izpack-src/trunk/src/native/ShellLink_x64/ShellLink.suo
===================================================================
(Binary files differ)


Property changes on: izpack-src/trunk/src/native/ShellLink_x64/ShellLink.suo
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: izpack-src/trunk/src/native/ShellLink_x64/ShellLink.vcproj
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/ShellLink.vcproj	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/ShellLink.vcproj	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1,452 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;windows-1251&quot;?&gt;
+&lt;VisualStudioProject
+	ProjectType=&quot;Visual C++&quot;
+	Version=&quot;8.00&quot;
+	Name=&quot;ShellLink&quot;
+	ProjectGUID=&quot;{BF46B82B-A948-4C56-91C8-A5F20FB2D869}&quot;
+	&gt;
+	&lt;Platforms&gt;
+		&lt;Platform
+			Name=&quot;Win32&quot;
+		/&gt;
+	&lt;/Platforms&gt;
+	&lt;ToolFiles&gt;
+	&lt;/ToolFiles&gt;
+	&lt;Configurations&gt;
+		&lt;Configuration
+			Name=&quot;Debug Unicode|Win32&quot;
+			OutputDirectory=&quot;.\Debug_Unicode&quot;
+			IntermediateDirectory=&quot;.\Debug_Unicode&quot;
+			ConfigurationType=&quot;2&quot;
+			InheritedPropertySheets=&quot;$(VCInstallDir)VCProjectDefaults\UpgradeFromVC60.vsprops&quot;
+			UseOfMFC=&quot;0&quot;
+			ATLMinimizesCRunTimeLibraryUsage=&quot;false&quot;
+			CharacterSet=&quot;1&quot;
+			&gt;
+			&lt;Tool
+				Name=&quot;VCPreBuildEventTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCCustomBuildTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCXMLDataGeneratorTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCWebServiceProxyGeneratorTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCMIDLTool&quot;
+				PreprocessorDefinitions=&quot;_DEBUG&quot;
+				MkTypLibCompatible=&quot;true&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				TargetEnvironment=&quot;1&quot;
+				TypeLibraryName=&quot;.\Debug_Unicode/ShellLink.tlb&quot;
+				HeaderFileName=&quot;&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCCLCompilerTool&quot;
+				Optimization=&quot;0&quot;
+				AdditionalIncludeDirectories=&quot;C:\usr\java\jdk1.3.1_05\include,C:\usr\java\jdk1.3.1_05\include\win32&quot;
+				PreprocessorDefinitions=&quot;WIN32;_DEBUG;_WINDOWS;_USRDLL;SHELLLINK_EXPORTS&quot;
+				MinimalRebuild=&quot;true&quot;
+				BasicRuntimeChecks=&quot;3&quot;
+				RuntimeLibrary=&quot;1&quot;
+				PrecompiledHeaderFile=&quot;.\Debug_Unicode/ShellLink.pch&quot;
+				AssemblerListingLocation=&quot;.\Debug_Unicode/&quot;
+				ObjectFile=&quot;.\Debug_Unicode/&quot;
+				ProgramDataBaseFileName=&quot;.\Debug_Unicode/&quot;
+				WarningLevel=&quot;3&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				DebugInformationFormat=&quot;4&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCManagedResourceCompilerTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCResourceCompilerTool&quot;
+				PreprocessorDefinitions=&quot;_DEBUG&quot;
+				Culture=&quot;1031&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCPreLinkEventTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCLinkerTool&quot;
+				OutputFile=&quot;.\Debug_Unicode/ShellLink_x64.dll&quot;
+				LinkIncremental=&quot;2&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				GenerateDebugInformation=&quot;true&quot;
+				ProgramDatabaseFile=&quot;.\Debug_Unicode/ShellLink.pdb&quot;
+				ImportLibrary=&quot;.\Debug_Unicode/ShellLink.lib&quot;
+				TargetMachine=&quot;1&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCALinkTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCManifestTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCXDCMakeTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCBscMakeTool&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				OutputFile=&quot;.\Debug_Unicode/ShellLink.bsc&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCFxCopTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCAppVerifierTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCWebDeploymentTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCPostBuildEventTool&quot;
+			/&gt;
+		&lt;/Configuration&gt;
+		&lt;Configuration
+			Name=&quot;Debug|Win32&quot;
+			OutputDirectory=&quot;.\Debug&quot;
+			IntermediateDirectory=&quot;.\Debug&quot;
+			ConfigurationType=&quot;2&quot;
+			InheritedPropertySheets=&quot;$(VCInstallDir)VCProjectDefaults\UpgradeFromVC60.vsprops&quot;
+			UseOfMFC=&quot;0&quot;
+			ATLMinimizesCRunTimeLibraryUsage=&quot;false&quot;
+			CharacterSet=&quot;2&quot;
+			&gt;
+			&lt;Tool
+				Name=&quot;VCPreBuildEventTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCCustomBuildTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCXMLDataGeneratorTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCWebServiceProxyGeneratorTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCMIDLTool&quot;
+				PreprocessorDefinitions=&quot;_DEBUG&quot;
+				MkTypLibCompatible=&quot;true&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				TargetEnvironment=&quot;1&quot;
+				TypeLibraryName=&quot;.\Debug/ShellLink.tlb&quot;
+				HeaderFileName=&quot;&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCCLCompilerTool&quot;
+				Optimization=&quot;0&quot;
+				AdditionalIncludeDirectories=&quot;C:\usr\java\jdk1.3.1_05\include,C:\usr\java\jdk1.3.1_05\include\win32&quot;
+				PreprocessorDefinitions=&quot;WIN32;_DEBUG;_WINDOWS;_USRDLL;SHELLLINK_EXPORTS&quot;
+				MinimalRebuild=&quot;true&quot;
+				BasicRuntimeChecks=&quot;3&quot;
+				RuntimeLibrary=&quot;1&quot;
+				PrecompiledHeaderFile=&quot;.\Debug/ShellLink.pch&quot;
+				AssemblerListingLocation=&quot;.\Debug/&quot;
+				ObjectFile=&quot;.\Debug/&quot;
+				ProgramDataBaseFileName=&quot;.\Debug/&quot;
+				WarningLevel=&quot;3&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				DebugInformationFormat=&quot;4&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCManagedResourceCompilerTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCResourceCompilerTool&quot;
+				PreprocessorDefinitions=&quot;_DEBUG&quot;
+				Culture=&quot;1031&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCPreLinkEventTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCLinkerTool&quot;
+				OutputFile=&quot;.\Debug/ShellLink.dll&quot;
+				LinkIncremental=&quot;2&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				GenerateDebugInformation=&quot;true&quot;
+				ProgramDatabaseFile=&quot;.\Debug/ShellLink.pdb&quot;
+				ImportLibrary=&quot;.\Debug/ShellLink.lib&quot;
+				TargetMachine=&quot;1&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCALinkTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCManifestTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCXDCMakeTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCBscMakeTool&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				OutputFile=&quot;.\Debug/ShellLink.bsc&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCFxCopTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCAppVerifierTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCWebDeploymentTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCPostBuildEventTool&quot;
+			/&gt;
+		&lt;/Configuration&gt;
+		&lt;Configuration
+			Name=&quot;Release|Win32&quot;
+			OutputDirectory=&quot;.\Release&quot;
+			IntermediateDirectory=&quot;.\Release&quot;
+			ConfigurationType=&quot;2&quot;
+			InheritedPropertySheets=&quot;$(VCInstallDir)VCProjectDefaults\UpgradeFromVC60.vsprops&quot;
+			UseOfMFC=&quot;0&quot;
+			ATLMinimizesCRunTimeLibraryUsage=&quot;false&quot;
+			CharacterSet=&quot;2&quot;
+			&gt;
+			&lt;Tool
+				Name=&quot;VCPreBuildEventTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCCustomBuildTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCXMLDataGeneratorTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCWebServiceProxyGeneratorTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCMIDLTool&quot;
+				PreprocessorDefinitions=&quot;NDEBUG&quot;
+				MkTypLibCompatible=&quot;true&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				TargetEnvironment=&quot;1&quot;
+				TypeLibraryName=&quot;.\Release/ShellLink.tlb&quot;
+				HeaderFileName=&quot;&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCCLCompilerTool&quot;
+				Optimization=&quot;4&quot;
+				AdditionalIncludeDirectories=&quot;C:\usr\java\jdk1.3.1_05\include,C:\usr\java\jdk1.3.1_05\include\win32&quot;
+				PreprocessorDefinitions=&quot;WIN32;NDEBUG;_WINDOWS;_USRDLL;SHELLLINK_EXPORTS&quot;
+				RuntimeLibrary=&quot;0&quot;
+				PrecompiledHeaderFile=&quot;.\Release/ShellLink.pch&quot;
+				AssemblerListingLocation=&quot;.\Release/&quot;
+				ObjectFile=&quot;.\Release/&quot;
+				ProgramDataBaseFileName=&quot;.\Release/&quot;
+				SuppressStartupBanner=&quot;true&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCManagedResourceCompilerTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCResourceCompilerTool&quot;
+				PreprocessorDefinitions=&quot;NDEBUG&quot;
+				Culture=&quot;1031&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCPreLinkEventTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCLinkerTool&quot;
+				OutputFile=&quot;.\Release/ShellLink.dll&quot;
+				LinkIncremental=&quot;1&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				ProgramDatabaseFile=&quot;.\Release/ShellLink.pdb&quot;
+				ImportLibrary=&quot;.\Release/ShellLink.lib&quot;
+				TargetMachine=&quot;1&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCALinkTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCManifestTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCXDCMakeTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCBscMakeTool&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				OutputFile=&quot;.\Release/ShellLink.bsc&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCFxCopTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCAppVerifierTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCWebDeploymentTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCPostBuildEventTool&quot;
+			/&gt;
+		&lt;/Configuration&gt;
+		&lt;Configuration
+			Name=&quot;Release Unicode|Win32&quot;
+			OutputDirectory=&quot;.\Release_Unicode&quot;
+			IntermediateDirectory=&quot;.\Release_Unicode&quot;
+			ConfigurationType=&quot;2&quot;
+			InheritedPropertySheets=&quot;$(VCInstallDir)VCProjectDefaults\UpgradeFromVC60.vsprops&quot;
+			UseOfMFC=&quot;0&quot;
+			ATLMinimizesCRunTimeLibraryUsage=&quot;false&quot;
+			CharacterSet=&quot;1&quot;
+			&gt;
+			&lt;Tool
+				Name=&quot;VCPreBuildEventTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCCustomBuildTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCXMLDataGeneratorTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCWebServiceProxyGeneratorTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCMIDLTool&quot;
+				PreprocessorDefinitions=&quot;NDEBUG&quot;
+				MkTypLibCompatible=&quot;true&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				TargetEnvironment=&quot;1&quot;
+				TypeLibraryName=&quot;.\Release_Unicode/ShellLink.tlb&quot;
+				HeaderFileName=&quot;&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCCLCompilerTool&quot;
+				Optimization=&quot;4&quot;
+				AdditionalIncludeDirectories=&quot;C:\usr\java\jdk1.3.1_05\include,C:\usr\java\jdk1.3.1_05\include\win32&quot;
+				PreprocessorDefinitions=&quot;WIN32;NDEBUG;_WINDOWS;_USRDLL;SHELLLINK_EXPORTS&quot;
+				RuntimeLibrary=&quot;0&quot;
+				PrecompiledHeaderFile=&quot;.\Release_Unicode/ShellLink.pch&quot;
+				AssemblerListingLocation=&quot;.\Release_Unicode/&quot;
+				ObjectFile=&quot;.\Release_Unicode/&quot;
+				ProgramDataBaseFileName=&quot;.\Release_Unicode/&quot;
+				SuppressStartupBanner=&quot;true&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCManagedResourceCompilerTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCResourceCompilerTool&quot;
+				PreprocessorDefinitions=&quot;NDEBUG&quot;
+				Culture=&quot;1031&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCPreLinkEventTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCLinkerTool&quot;
+				OutputFile=&quot;.\Release_Unicode/ShellLink.dll&quot;
+				LinkIncremental=&quot;1&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				ProgramDatabaseFile=&quot;.\Release_Unicode/ShellLink.pdb&quot;
+				ImportLibrary=&quot;.\Release_Unicode/ShellLink.lib&quot;
+				TargetMachine=&quot;1&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCALinkTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCManifestTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCXDCMakeTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCBscMakeTool&quot;
+				SuppressStartupBanner=&quot;true&quot;
+				OutputFile=&quot;.\Release_Unicode/ShellLink.bsc&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCFxCopTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCAppVerifierTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCWebDeploymentTool&quot;
+			/&gt;
+			&lt;Tool
+				Name=&quot;VCPostBuildEventTool&quot;
+			/&gt;
+		&lt;/Configuration&gt;
+	&lt;/Configurations&gt;
+	&lt;References&gt;
+	&lt;/References&gt;
+	&lt;Files&gt;
+		&lt;Filter
+			Name=&quot;Quellcodedateien&quot;
+			Filter=&quot;cpp;c;cxx;rc;def;r;odl;idl;hpj;bat&quot;
+			&gt;
+			&lt;File
+				RelativePath=&quot;ShellLink.cpp&quot;
+				&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug Unicode|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						AdditionalIncludeDirectories=&quot;&quot;
+						PreprocessorDefinitions=&quot;&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Debug|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						AdditionalIncludeDirectories=&quot;&quot;
+						PreprocessorDefinitions=&quot;&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Release|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						AdditionalIncludeDirectories=&quot;&quot;
+						PreprocessorDefinitions=&quot;&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
+				&lt;FileConfiguration
+					Name=&quot;Release Unicode|Win32&quot;
+					&gt;
+					&lt;Tool
+						Name=&quot;VCCLCompilerTool&quot;
+						AdditionalIncludeDirectories=&quot;&quot;
+						PreprocessorDefinitions=&quot;&quot;
+					/&gt;
+				&lt;/FileConfiguration&gt;
+			&lt;/File&gt;
+		&lt;/Filter&gt;
+		&lt;Filter
+			Name=&quot;Header-Dateien&quot;
+			Filter=&quot;h;hpp;hxx;hm;inl&quot;
+			&gt;
+			&lt;File
+				RelativePath=&quot;com_izforge_izpack_util_os_ShellLink.h&quot;
+				&gt;
+			&lt;/File&gt;
+		&lt;/Filter&gt;
+		&lt;Filter
+			Name=&quot;Ressourcendateien&quot;
+			Filter=&quot;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe&quot;
+			&gt;
+		&lt;/Filter&gt;
+	&lt;/Files&gt;
+	&lt;Globals&gt;
+	&lt;/Globals&gt;
+&lt;/VisualStudioProject&gt;

Added: izpack-src/trunk/src/native/ShellLink_x64/com_izforge_izpack_util_os_ShellLink.h
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/com_izforge_izpack_util_os_ShellLink.h	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/com_izforge_izpack_util_os_ShellLink.h	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1,245 @@
+/* DO NOT EDIT THIS FILE - it is machine generated */
+#include &lt;jni.h&gt;
+/* Header for class com_izforge_izpack_util_os_ShellLink */
+
+#ifndef _Included_com_izforge_izpack_util_os_ShellLink
+#define _Included_com_izforge_izpack_util_os_ShellLink
+#ifdef __cplusplus
+extern &quot;C&quot; {
+#endif
+#undef com_izforge_izpack_util_os_ShellLink_HIDE
+#define com_izforge_izpack_util_os_ShellLink_HIDE 0L
+#undef com_izforge_izpack_util_os_ShellLink_NORMAL
+#define com_izforge_izpack_util_os_ShellLink_NORMAL 1L
+#undef com_izforge_izpack_util_os_ShellLink_MINIMIZED
+#define com_izforge_izpack_util_os_ShellLink_MINIMIZED 2L
+#undef com_izforge_izpack_util_os_ShellLink_MAXIMIZED
+#define com_izforge_izpack_util_os_ShellLink_MAXIMIZED 3L
+#undef com_izforge_izpack_util_os_ShellLink_MINNOACTIVE
+#define com_izforge_izpack_util_os_ShellLink_MINNOACTIVE 7L
+#undef com_izforge_izpack_util_os_ShellLink_MIN_SHOW
+#define com_izforge_izpack_util_os_ShellLink_MIN_SHOW 0L
+#undef com_izforge_izpack_util_os_ShellLink_MAX_SHOW
+#define com_izforge_izpack_util_os_ShellLink_MAX_SHOW 7L
+#undef com_izforge_izpack_util_os_ShellLink_DESKTOP
+#define com_izforge_izpack_util_os_ShellLink_DESKTOP 1L
+#undef com_izforge_izpack_util_os_ShellLink_PROGRAM_MENU
+#define com_izforge_izpack_util_os_ShellLink_PROGRAM_MENU 2L
+#undef com_izforge_izpack_util_os_ShellLink_START_MENU
+#define com_izforge_izpack_util_os_ShellLink_START_MENU 3L
+#undef com_izforge_izpack_util_os_ShellLink_STARTUP
+#define com_izforge_izpack_util_os_ShellLink_STARTUP 4L
+#undef com_izforge_izpack_util_os_ShellLink_MIN_TYPE
+#define com_izforge_izpack_util_os_ShellLink_MIN_TYPE 1L
+#undef com_izforge_izpack_util_os_ShellLink_MAX_TYPE
+#define com_izforge_izpack_util_os_ShellLink_MAX_TYPE 4L
+#undef com_izforge_izpack_util_os_ShellLink_SL_OK
+#define com_izforge_izpack_util_os_ShellLink_SL_OK 1L
+#undef com_izforge_izpack_util_os_ShellLink_SL_ERROR
+#define com_izforge_izpack_util_os_ShellLink_SL_ERROR -1L
+#undef com_izforge_izpack_util_os_ShellLink_SL_INITIALIZED
+#define com_izforge_izpack_util_os_ShellLink_SL_INITIALIZED -2L
+#undef com_izforge_izpack_util_os_ShellLink_SL_NOT_INITIALIZED
+#define com_izforge_izpack_util_os_ShellLink_SL_NOT_INITIALIZED -3L
+#undef com_izforge_izpack_util_os_ShellLink_SL_OUT_OF_HANDLES
+#define com_izforge_izpack_util_os_ShellLink_SL_OUT_OF_HANDLES -4L
+#undef com_izforge_izpack_util_os_ShellLink_SL_NO_IPERSIST
+#define com_izforge_izpack_util_os_ShellLink_SL_NO_IPERSIST -5L
+#undef com_izforge_izpack_util_os_ShellLink_SL_NO_SAVE
+#define com_izforge_izpack_util_os_ShellLink_SL_NO_SAVE -6L
+#undef com_izforge_izpack_util_os_ShellLink_SL_WRONG_DATA_TYPE
+#define com_izforge_izpack_util_os_ShellLink_SL_WRONG_DATA_TYPE -7L
+#undef com_izforge_izpack_util_os_ShellLink_UNINITIALIZED
+#define com_izforge_izpack_util_os_ShellLink_UNINITIALIZED -1L
+#undef com_izforge_izpack_util_os_ShellLink_CURRENT_USER
+#define com_izforge_izpack_util_os_ShellLink_CURRENT_USER 0L
+#undef com_izforge_izpack_util_os_ShellLink_ALL_USERS
+#define com_izforge_izpack_util_os_ShellLink_ALL_USERS 1L
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    initializeCOM
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_initializeCOM
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    releaseCOM
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_releaseCOM
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    getInterface
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_getInterface
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    releaseInterface
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_releaseInterface
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    GetArguments
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetArguments
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    GetDescription
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetDescription
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    GetHotkey
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetHotkey
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    GetIconLocation
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetIconLocation
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    GetPath
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetPath
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    GetShowCommand
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetShowCommand
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    GetWorkingDirectory
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetWorkingDirectory
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    Resolve
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_Resolve
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    SetArguments
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetArguments
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    SetDescription
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetDescription
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    SetHotkey
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetHotkey
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    SetIconLocation
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetIconLocation
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    SetPath
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetPath
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    SetShowCommand
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetShowCommand
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    SetWorkingDirectory
+ * Signature: ()I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_SetWorkingDirectory
+  (JNIEnv *, jobject);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    saveLink
+ * Signature: (Ljava/lang/String;)I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_saveLink
+  (JNIEnv *, jobject, jstring);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    loadLink
+ * Signature: (Ljava/lang/String;)I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_loadLink
+  (JNIEnv *, jobject, jstring);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    GetFullLinkPath
+ * Signature: (II)I
+ */
+JNIEXPORT jint JNICALL Java_com_izforge_izpack_util_os_ShellLink_GetFullLinkPath
+  (JNIEnv *, jobject, jint, jint);
+
+/*
+ * Class:     com_izforge_izpack_util_os_ShellLink
+ * Method:    FreeLibrary
+ * Signature: (Ljava/lang/String;)V
+ */
+JNIEXPORT void JNICALL Java_com_izforge_izpack_util_os_ShellLink_FreeLibrary
+  (JNIEnv *, jobject, jstring);
+
+#ifdef __cplusplus
+}
+#endif
+#endif

Added: izpack-src/trunk/src/native/ShellLink_x64/compile.cmd
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/compile.cmd	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/compile.cmd	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1,55 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/izpack-changes">+ at echo</A> off
+color f0
+
+cd %~dp0
+
+
+echo Make project in:
+cd
+
+
+set ShellLinkMak=ShellLink.mak
+
+echo TODO if fail: Adjust JAVA_HOME in %CD%\%ShellLinkMak%
+
+echo.
+
+echo using C:\Program Files\Microsoft Visual Studio\VC98\Bin
+echo  TODO if fail: adjust the path if not in $path
+echo.
+
+set MSVCDIR=C:\Program Files\Microsoft Visual Studio
+
+SET INCLUDE=%MSVCDIR%\VC98\Include
+SET LIB=%MSVCDIR%\VC98\Lib
+
+set PATH=%MSVCDIR%\Common\MSDev98\Bin;%MSVCDIR%\VC98\Bin;%PATH%
+
+echo PATH=%PATH%
+
+echo.
+echo cleaning up...
+
+nmake /f %ShellLinkMak% CFG=&quot;ShellLink - Win32 Release&quot; CLEAN
+
+echo.
+echo (Re-)Compiling...
+
+
+nmake /f %ShellLinkMak% CFG=&quot;ShellLink - Win32 Release&quot;
+
+echo.
+echo cleaning up...
+
+nmake /f %ShellLinkMak% CFG=&quot;ShellLink - Win32 Release Unicode&quot; CLEAN
+
+echo.
+echo (Re-)Compiling...
+
+
+nmake /f %ShellLinkMak% CFG=&quot;ShellLink - Win32 Release Unicode&quot;
+
+echo.
+echo Pause, to check the current build
+echo.
+pause

Added: izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/BuildLog.htm
===================================================================
(Binary files differ)


Property changes on: izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/BuildLog.htm
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/ShellLink.dll.embed.manifest
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/ShellLink.dll.embed.manifest	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/ShellLink.dll.embed.manifest	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1,3 @@
+&#239;&#187;&#191;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
+&lt;assembly xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot; manifestVersion=&quot;1.0&quot;&gt;
+&lt;/assembly&gt;
\ No newline at end of file

Added: izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/ShellLink.dll.embed.manifest.res
===================================================================
(Binary files differ)


Property changes on: izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/ShellLink.dll.embed.manifest.res
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/ShellLink.dll.intermediate.manifest
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/ShellLink.dll.intermediate.manifest	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/ShellLink.dll.intermediate.manifest	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1,3 @@
+&lt;?xml version='1.0' encoding='UTF-8' standalone='yes'?&gt;
+&lt;assembly xmlns='urn:schemas-microsoft-com:asm.v1' manifestVersion='1.0'&gt;
+&lt;/assembly&gt;

Added: izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/mt.dep
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/mt.dep	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/x64/Debug Unicode/mt.dep	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1 @@
+Manifest resource last updated at 23:21:14.00 on Sat 06/23/2007 

Added: izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/BuildLog.htm
===================================================================
(Binary files differ)


Property changes on: izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/BuildLog.htm
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/ShellLink.dll.intermediate.manifest
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/ShellLink.dll.intermediate.manifest	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/ShellLink.dll.intermediate.manifest	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1,3 @@
+&lt;?xml version='1.0' encoding='UTF-8' standalone='yes'?&gt;
+&lt;assembly xmlns='urn:schemas-microsoft-com:asm.v1' manifestVersion='1.0'&gt;
+&lt;/assembly&gt;

Added: izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/mt.dep
===================================================================
--- izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/mt.dep	2007-07-04 17:09:07 UTC (rev 1864)
+++ izpack-src/trunk/src/native/ShellLink_x64/x64/Release Unicode/mt.dep	2007-08-09 20:24:04 UTC (rev 1865)
@@ -0,0 +1 @@
+Manifest resource last updated at 12:17:14.90 on Sun 06/24/2007 

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000612.html">[izpack-changes] r1866 -	izpack-src/trunk/src/lib/com/izforge/izpack/util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#611">[ date ]</a>
              <a href="thread.html#611">[ thread ]</a>
              <a href="subject.html#611">[ subject ]</a>
              <a href="author.html#611">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/izpack-changes">More information about the izpack-changes
mailing list</a><br>
</body></html>

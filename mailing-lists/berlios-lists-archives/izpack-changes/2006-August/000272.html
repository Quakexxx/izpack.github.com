<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [izpack-changes] r1527 - in izpack-frontend/trunk/src: .	documentation izpack/frontend/actions	izpack/frontend/controller/validators izpack/frontend/model	izpack/frontend/model/files izpack/frontend/model/stages	izpack/frontend/view/components	izpack/frontend/view/components/table	izpack/frontend/view/mode izpack/frontend/view/stages	izpack/frontend/view/stages/compile	izpack/frontend/view/stages/configure	izpack/frontend/view/stages/geninfo	izpack/frontend/view/stages/packs	izpack/frontend/view/stages/packs/editors	izpack/frontend/view/stages/panelselect lib res/i18n utils
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:izpack-changes%40lists.berlios.de?Subject=%5Bizpack-changes%5D%20r1527%20-%20in%20izpack-frontend/trunk/src%3A%20.%0A%09documentation%20izpack/frontend/actions%0A%09izpack/frontend/controller/validators%20izpack/frontend/model%0A%09izpack/frontend/model/files%20izpack/frontend/model/stages%0A%09izpack/frontend/view/components%0A%09izpack/frontend/view/components/table%0A%09izpack/frontend/view/mode%20izpack/frontend/view/stages%0A%09izpack/frontend/view/stages/compile%0A%09izpack/frontend/view/stages/configure%0A%09izpack/frontend/view/stages/geninfo%0A%09izpack/frontend/view/stages/packs%0A%09izpack/frontend/view/stages/packs/editors%0A%09izpack/frontend/view/stages/panelselect%20lib%20res/i18n%20utils&In-Reply-To=">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000271.html">
   <LINK REL="Next"  HREF="000273.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[izpack-changes] r1527 - in izpack-frontend/trunk/src: .	documentation izpack/frontend/actions	izpack/frontend/controller/validators izpack/frontend/model	izpack/frontend/model/files izpack/frontend/model/stages	izpack/frontend/view/components	izpack/frontend/view/components/table	izpack/frontend/view/mode izpack/frontend/view/stages	izpack/frontend/view/stages/compile	izpack/frontend/view/stages/configure	izpack/frontend/view/stages/geninfo	izpack/frontend/view/stages/packs	izpack/frontend/view/stages/packs/editors	izpack/frontend/view/stages/panelselect lib res/i18n utils</H1>
    <B>noreply at berlios.de</B> 
    <A HREF="mailto:izpack-changes%40lists.berlios.de?Subject=%5Bizpack-changes%5D%20r1527%20-%20in%20izpack-frontend/trunk/src%3A%20.%0A%09documentation%20izpack/frontend/actions%0A%09izpack/frontend/controller/validators%20izpack/frontend/model%0A%09izpack/frontend/model/files%20izpack/frontend/model/stages%0A%09izpack/frontend/view/components%0A%09izpack/frontend/view/components/table%0A%09izpack/frontend/view/mode%20izpack/frontend/view/stages%0A%09izpack/frontend/view/stages/compile%0A%09izpack/frontend/view/stages/configure%0A%09izpack/frontend/view/stages/geninfo%0A%09izpack/frontend/view/stages/packs%0A%09izpack/frontend/view/stages/packs/editors%0A%09izpack/frontend/view/stages/panelselect%20lib%20res/i18n%20utils&In-Reply-To="
       TITLE="[izpack-changes] r1527 - in izpack-frontend/trunk/src: .	documentation izpack/frontend/actions	izpack/frontend/controller/validators izpack/frontend/model	izpack/frontend/model/files izpack/frontend/model/stages	izpack/frontend/view/components	izpack/frontend/view/components/table	izpack/frontend/view/mode izpack/frontend/view/stages	izpack/frontend/view/stages/compile	izpack/frontend/view/stages/configure	izpack/frontend/view/stages/geninfo	izpack/frontend/view/stages/packs	izpack/frontend/view/stages/packs/editors	izpack/frontend/view/stages/panelselect lib res/i18n utils">noreply at berlios.de
       </A><BR>
    <I>Fri Aug 11 17:52:27 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000271.html">[izpack-changes] r1526 - in	izpack-src/trunk/src/lib/com/izforge/izpack: gui installer
</A></li>
        <LI>Next message: <A HREF="000273.html">[izpack-changes] r1528 - izpack-frontend/trunk/src/lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#272">[ date ]</a>
              <a href="thread.html#272">[ thread ]</a>
              <a href="subject.html#272">[ subject ]</a>
              <a href="author.html#272">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: gumbo
Date: 2006-08-11 17:52:24 +0200 (Fri, 11 Aug 2006)
New Revision: 1527

Added:
   izpack-frontend/trunk/src/documentation/
   izpack-frontend/trunk/src/documentation/DocumentationGenerator.java
   izpack-frontend/trunk/src/izpack/frontend/model/OS.java
   izpack-frontend/trunk/src/izpack/frontend/view/components/OSSelector.java
   izpack-frontend/trunk/src/lib/validation-1.3.0.jar
Modified:
   izpack-frontend/trunk/src/izpack/frontend/actions/ActionHandler.java
   izpack-frontend/trunk/src/izpack/frontend/controller/validators/PanelSelectionValidator.java
   izpack-frontend/trunk/src/izpack/frontend/controller/validators/StageValidator.java
   izpack-frontend/trunk/src/izpack/frontend/model/PackModel.java
   izpack-frontend/trunk/src/izpack/frontend/model/files/DirectoryModel.java
   izpack-frontend/trunk/src/izpack/frontend/model/files/Executable.java
   izpack-frontend/trunk/src/izpack/frontend/model/files/FileModel.java
   izpack-frontend/trunk/src/izpack/frontend/model/files/FileSet.java
   izpack-frontend/trunk/src/izpack/frontend/model/files/PackFileModel.java
   izpack-frontend/trunk/src/izpack/frontend/model/files/Parsable.java
   izpack-frontend/trunk/src/izpack/frontend/model/stages/ConfigurationStageModel.java
   izpack-frontend/trunk/src/izpack/frontend/model/stages/GeneralInformationModel.java
   izpack-frontend/trunk/src/izpack/frontend/model/stages/PackStageModel.java
   izpack-frontend/trunk/src/izpack/frontend/model/stages/PanelModel.java
   izpack-frontend/trunk/src/izpack/frontend/view/components/table/PackCellEditor.java
   izpack-frontend/trunk/src/izpack/frontend/view/components/table/PackCellRenderer.java
   izpack-frontend/trunk/src/izpack/frontend/view/components/table/TableEditor.java
   izpack-frontend/trunk/src/izpack/frontend/view/mode/WizardMode.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/IzPackStage.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/compile/Compile.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/configure/PanelConfigurator.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/GeneralInfoPanel.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/GeneralInformation.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/UIConfig.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/ListTable.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/Pack.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/DirectoryEditor.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/ExecutableEditor.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/FileEditor.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/FileSetEditor.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/PackEditor.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/ParsableEditor.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/SetEditor.java
   izpack-frontend/trunk/src/izpack/frontend/view/stages/panelselect/PanelSelection.java
   izpack-frontend/trunk/src/res/i18n/LangResources_en.properties
   izpack-frontend/trunk/src/utils/XML.java
Log:
Updated validation

Added: izpack-frontend/trunk/src/documentation/DocumentationGenerator.java
===================================================================
--- izpack-frontend/trunk/src/documentation/DocumentationGenerator.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/documentation/DocumentationGenerator.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -0,0 +1,71 @@
+/*
+ * Created on May 4, 2006
+ * 
+ * $Id: DocumentationGenerator.java Feb 8, 2004 izpack-frontend
+ * Copyright (C) 2005 Andy Gombos
+ * 
+ * File : DocumentationGenerator.java 
+ * Description : TODO Add description
+ * Author's email : <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-changes">gumbo at users.berlios.de</A>
+ * 
+ * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ *     <A HREF="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</A>
+ *     
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package documentation;
+
+import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileNotFoundException;
+import java.io.IOException;
+import java.io.PrintWriter;
+import java.util.List;
+
+import au.id.jericho.lib.html.Element;
+import au.id.jericho.lib.html.Segment;
+import au.id.jericho.lib.html.Source;
+import au.id.jericho.lib.html.StartTag;
+
+public class DocumentationGenerator
+{
+
+    /**
+     * @param args
+     * @throws IOException 
+     * @throws FileNotFoundException 
+     */
+    public static void main(String[] args) throws FileNotFoundException, IOException
+    {        
+        Source src = new Source(new FileInputStream(new File(&quot;H:\\izpack-src\\src\\doc-ng\\XHTML\\node4.html&quot;)));
+        src.setLogWriter(new PrintWriter(System.err));       
+        
+        List&lt;Element&gt; tags = src.findAllElements(&quot;h2&quot;);
+        
+        for (Element tag : tags)
+        {       
+            String text = tag.extractText();
+           
+           if (text.endsWith(&quot;Panel&quot;))
+           {
+               System.out.println(text);
+               
+               StartTag t = src.findNextStartTag(tag.getEnd(), &quot;h2&quot;);
+               
+               if (t == null)
+                   t = src.findNextStartTag(tag.getEnd(), &quot;hr&quot;);
+                   
+               System.out.println(&quot;\t&quot; + new Segment(src, tag.getEnd(), t.getBegin()).extractText());
+           }
+        }
+    }
+
+}

Modified: izpack-frontend/trunk/src/izpack/frontend/actions/ActionHandler.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/actions/ActionHandler.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/actions/ActionHandler.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -108,6 +108,10 @@
             if (installerUI != null)
             {
                 welcomeUI.setVisible(false);
+                
+                System.out.println(&quot;Creating new installer&quot;);                
+                
+                installerUI.resetState();
                 installerUI.setVisible(true);
             }
         }

Modified: izpack-frontend/trunk/src/izpack/frontend/controller/validators/PanelSelectionValidator.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/controller/validators/PanelSelectionValidator.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/controller/validators/PanelSelectionValidator.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -23,6 +23,8 @@
 
 package izpack.frontend.controller.validators;
 
+import izpack.frontend.model.PanelInfo;
+import izpack.frontend.model.stages.PanelModel;
 import izpack.frontend.model.stages.PanelSelectionModel;
 
 import com.jgoodies.validation.Severity;
@@ -55,10 +57,48 @@
                             &quot;Panels&quot;,
                             &quot;dest&quot;
                             ));
+        }                
+        
+        tmp.configData = new PanelInfo(&quot;&quot;, &quot;&quot;, &quot;Install Panel&quot;, &quot;&quot;, &quot;&quot;, null, null);        
+        
+        if (!model.contains(tmp))
+        {
+            vr.add(new PropertyValidationMessage(
+                            Severity.ERROR,
+                            &quot;must have an installation panel to perform the install&quot;,
+                            model,
+                            &quot;Panels&quot;,
+                            &quot;dest&quot;));
         }
         
+        tmp.configData = new PanelInfo(&quot;&quot;, &quot;&quot;, &quot;Welcome Panel&quot;, &quot;&quot;, &quot;&quot;, null, null);        
+        
+        if (!model.contains(tmp))
+        {
+            vr.add(new PropertyValidationMessage(
+                            Severity.WARNING,
+                            &quot;should have a welcome panel&quot;,
+                            model,
+                            &quot;Panels&quot;,
+                            &quot;dest&quot;));
+        }
+        
+        tmp.configData = new PanelInfo(&quot;&quot;, &quot;&quot;, &quot;Finish Panel&quot;, &quot;&quot;, &quot;&quot;, null, null);        
+        tmp2.configData = new PanelInfo(&quot;&quot;, &quot;&quot;, &quot;Simple Finish Panel&quot;, &quot;&quot;, &quot;&quot;, null, null);
+        
+        if (! (model.contains(tmp) || model.contains(tmp2)) )
+        {
+            vr.add(new PropertyValidationMessage(
+                            Severity.WARNING,
+                            &quot;should have a finishing panel&quot;,
+                            model,
+                            &quot;Panels&quot;,
+                            &quot;dest&quot;));
+        }
+        
         return vr;
     }
 
+    private PanelModel tmp = new PanelModel(), tmp2 = new PanelModel();
     PanelSelectionModel model;
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/controller/validators/StageValidator.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/controller/validators/StageValidator.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/controller/validators/StageValidator.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -23,12 +23,13 @@
 
 package izpack.frontend.controller.validators;
 
-import com.jgoodies.validation.ValidationCapable;
+import com.jgoodies.validation.Validator;
 
+
 /**
  * @author Andy Gombos
  */
-public interface StageValidator extends ValidationCapable
+public interface StageValidator extends Validator
 {
 
 }

Added: izpack-frontend/trunk/src/izpack/frontend/model/OS.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/OS.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/OS.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -0,0 +1,141 @@
+/*
+ * Created on Aug 9, 2006
+ * 
+ * $Id: OS.java Feb 8, 2004 izpack-frontend
+ * Copyright (C) 2005 Andy Gombos
+ * 
+ * File : OS.java 
+ * Description : TODO Add description
+ * Author's email : <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-changes">gumbo at users.berlios.de</A>
+ * 
+ * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ *     <A HREF="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</A>
+ *     
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package izpack.frontend.model;
+
+import javax.xml.xpath.XPath;
+import javax.xml.xpath.XPathConstants;
+import javax.xml.xpath.XPathExpressionException;
+import javax.xml.xpath.XPathFactory;
+
+import org.w3c.dom.Document;
+import org.w3c.dom.Element;
+import org.w3c.dom.NamedNodeMap;
+import org.w3c.dom.Node;
+import org.w3c.dom.NodeList;
+
+import utils.XML;
+
+import com.jgoodies.binding.beans.Model;
+
+public class OS extends Model
+{   
+    boolean windows, unix, mac;
+    
+    public boolean isMac()
+    {
+        return mac;
+    }
+
+    public boolean isUnix()
+    {
+        return unix;
+    }
+
+    public boolean isWindows()
+    {
+        return windows;
+    }
+
+    public void setMac(boolean mac)
+    {
+        this.mac = mac;
+        firePropertyChange(&quot;mac&quot;, false, mac);
+    }
+
+    public void setUnix(boolean unix)
+    {
+        this.unix = unix;
+        firePropertyChange(&quot;unix&quot;, false, unix);
+    }
+
+    public void setWindows(boolean windows)
+    {
+        this.windows = windows;
+        firePropertyChange(&quot;windows&quot;, false, windows);
+    }
+    
+    @Override
+    public String toString()
+    {
+        return &quot;Windows: &quot; + windows + &quot; Unix: &quot; + unix + &quot; Mac: &quot; + mac;
+    }
+
+    public void createXML(Document doc, Element packElement)
+    {        
+        if (windows)
+        {            
+            createOSElement(doc, packElement, &quot;windows&quot;);
+        }            
+        if (unix)
+        {            
+            createOSElement(doc, packElement, &quot;unix&quot;);
+        }
+        if (mac)
+        {            
+            createOSElement(doc, packElement, &quot;mac&quot;);
+        }
+    }
+
+    private void createOSElement(Document doc, Element packElement, String osFamily)
+    {        
+        Element root = XML.createElement(&quot;os&quot;, doc);
+        root.setAttribute(&quot;family&quot;, osFamily);
+            
+        packElement.appendChild(root);
+    }
+    
+    public void initFromXML(Node node)
+    {
+        XPath xpath = XPathFactory.newInstance().newXPath();
+        try
+        {
+            initFromXML((NodeList) xpath.evaluate(&quot;os&quot;, node, XPathConstants.NODESET));
+        }
+        catch (XPathExpressionException e)
+        {
+            // TODO Auto-generated catch block
+            e.printStackTrace();
+        }
+    }
+
+    public void initFromXML(NodeList os)
+    {
+        for (int i = 0; i &lt; os.getLength(); i++)
+        {
+            NamedNodeMap attrs = os.item(i).getAttributes();
+            
+            if (attrs.getNamedItem(&quot;family&quot;) != null)
+            {
+                String family = attrs.getNamedItem(&quot;family&quot;).getNodeValue();
+                
+                if (family.equalsIgnoreCase(&quot;windows&quot;))
+                    windows = true;
+                else if (family.equalsIgnoreCase(&quot;unix&quot;))
+                    unix = true;
+                else if (family.equalsIgnoreCase(&quot;mac&quot;))
+                    mac = true;
+            }
+        }        
+    }
+}

Modified: izpack-frontend/trunk/src/izpack/frontend/model/PackModel.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/PackModel.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/PackModel.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -62,7 +62,8 @@
         model = new DefaultTableModel(15, 1);
     }
     
-    private String name = &quot;&quot;, desc = &quot;&quot;, id = &quot;&quot;, os = &quot;&quot;;
+    private String name = &quot;&quot;, desc = &quot;&quot;, id = &quot;&quot;;
+    private OS oses = new OS();
     private boolean required = true, preselected = true, loose = false;
     
     /**
@@ -96,9 +97,9 @@
     /**
      * @return Returns the os.
      */
-    public String getOS()
-    {
-        return os;
+    public OS getOS()
+    {        
+        return oses;
     }
     /**
      * @return Returns the preselected.
@@ -145,10 +146,11 @@
     /**
      * @param os The os to set.
      */
-    public void setOS(String os)
-    {
-        this.os = os;
+    public void setOSes(OS os)
+    {     
+        this.oses = os;
     }
+    
     /**
      * @param preselected The preselected to set.
      */
@@ -171,18 +173,17 @@
         pack.setAttribute(&quot;name&quot;, name);
         pack.setAttribute(&quot;required&quot;, required ? &quot;yes&quot; : &quot;no&quot;);
         pack.setAttribute(&quot;preselected&quot;, preselected ? &quot;yes&quot; : &quot;no&quot;);
-        pack.setAttribute(&quot;loose&quot;, loose ? &quot;true&quot; : &quot;false&quot;);
-        
-        if (!os.equals(&quot;&quot;))
-            pack.setAttribute(&quot;os&quot;, os);
-        
+        pack.setAttribute(&quot;loose&quot;, loose ? &quot;true&quot; : &quot;false&quot;);        
+                
         if (!id.equals(&quot;&quot;))        
             pack.setAttribute(&quot;id&quot;, id);
         
         Element descElem = XML.createElement(&quot;description&quot;, doc);
         descElem.setTextContent(desc);
         
-        pack.appendChild(descElem);
+        pack.appendChild(descElem);        
+     
+        oses.createXML(doc, pack);
         
         //Convert the model into a list so it can be sorted
         ArrayList elements = new ArrayList();
@@ -226,10 +227,6 @@
         
         setLoose(stringToBoolean(getAttribute(attributes, &quot;loose&quot;)));
         
-        String os = getAttribute(attributes, &quot;os&quot;);
-        if (os != null &amp;&amp; !os.equals(&quot;&quot;))
-            setOS(os);
-        
         String id = getAttribute(attributes, &quot;id&quot;);
         if (id != null &amp;&amp; !id.equals(&quot;&quot;))
             setId(id);
@@ -243,12 +240,15 @@
         {            
             String packLoc = &quot;//pack[&quot; + (packIndex + 1) + &quot;]/&quot;;
             
+            NodeList os         = (NodeList) xpath.evaluate(packLoc + &quot;os&quot;, packNode, XPathConstants.NODESET);
+            
             NodeList dirs       = (NodeList) xpath.evaluate(packLoc + &quot;file&quot;, packNode, XPathConstants.NODESET);
             NodeList fileset    = (NodeList) xpath.evaluate(packLoc + &quot;fileset&quot;, packNode, XPathConstants.NODESET);
             NodeList files      = (NodeList) xpath.evaluate(packLoc + &quot;singlefile&quot;, packNode, XPathConstants.NODESET);
             NodeList execs      = (NodeList) xpath.evaluate(packLoc + &quot;executable&quot;, packNode, XPathConstants.NODESET);
             NodeList parsables  = (NodeList) xpath.evaluate(packLoc + &quot;parsable&quot;, packNode, XPathConstants.NODESET);
             
+            oses.initFromXML(os);
             createChildParts(dirs, DirectoryModel.class);
             createChildParts(files, FileModel.class);
             createChildParts(fileset, FileSet.class);

Modified: izpack-frontend/trunk/src/izpack/frontend/model/files/DirectoryModel.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/files/DirectoryModel.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/files/DirectoryModel.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -23,6 +23,8 @@
 
 package izpack.frontend.model.files;
 
+import izpack.frontend.model.OS;
+
 import org.w3c.dom.Document;
 import org.w3c.dom.Element;
 import org.w3c.dom.NamedNodeMap;
@@ -45,12 +47,11 @@
         dir.setAttribute(&quot;src&quot;, source);
         dir.setAttribute(&quot;targetdir&quot;, target);
         
-        if (!os.equals(&quot;&quot;))
-            dir.setAttribute(&quot;os&quot;, os);
-        
         if (!override.equals(&quot;&quot;))
             dir.setAttribute(&quot;override&quot;, override);
         
+        os.createXML(doc, dir);
+        
         return dir;
     }
 
@@ -62,8 +63,8 @@
        
        target = attributes.getNamedItem(&quot;targetdir&quot;).getNodeValue();
        
-       if (attributes.getNamedItem(&quot;os&quot;) != null)
-           os = attributes.getNamedItem(&quot;os&quot;).getNodeValue();       
+       os = new OS();
+       os.initFromXML(elementNode);
        
        if (attributes.getNamedItem(&quot;override&quot;) != null)
            override = attributes.getNamedItem(&quot;override&quot;).getNodeValue();

Modified: izpack-frontend/trunk/src/izpack/frontend/model/files/Executable.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/files/Executable.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/files/Executable.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -23,8 +23,11 @@
 
 package izpack.frontend.model.files;
 
+import izpack.frontend.model.OS;
+
 import org.w3c.dom.Document;
 import org.w3c.dom.Element;
+import org.w3c.dom.NamedNodeMap;
 import org.w3c.dom.Node;
 
 import utils.XML;
@@ -37,6 +40,7 @@
 public class Executable implements PackElement
 {
     public String target = &quot;&quot;, execClass = &quot;&quot;, type = &quot;&quot;, stage = &quot;&quot;, failure = &quot;&quot;, keep = &quot;&quot;, args = &quot;&quot;;
+    public OS os;
 
     /* (non-Javadoc)
      * @see izpack.frontend.model.files.ElementModel#writeXML()
@@ -53,6 +57,8 @@
         setOptionalAttribute(executable, &quot;failure&quot;, failure);
         setOptionalAttribute(executable, &quot;keep&quot;, keep);
         
+        os.createXML(doc, executable);
+        
         Element argsElem = XML.createElement(&quot;args&quot;, doc);
         Element arg = XML.createElement(&quot;arg&quot;, doc);
         arg.setAttribute(&quot;value&quot;, args);
@@ -67,11 +73,30 @@
     {
         if ((value != null) &amp;&amp; !value.equals(&quot;&quot;))
             elem.setAttribute(attrName, value);
-    }
+    } 
 
     public void initFromXML(Node elementNode)
     {
-        // TODO Auto-generated method stub
+        NamedNodeMap attributes = elementNode.getAttributes();
         
+        if (attributes.getNamedItem(&quot;targetfile&quot;) != null)
+            target = attributes.getNamedItem(&quot;targetfile&quot;).getNodeValue();
+        if (attributes.getNamedItem(&quot;class&quot;) != null)
+            execClass = attributes.getNamedItem(&quot;class&quot;).getNodeValue();
+        if (attributes.getNamedItem(&quot;type&quot;) != null)
+            type  = attributes.getNamedItem(&quot;type&quot;).getNodeValue();
+        if (attributes.getNamedItem(&quot;stage&quot;) != null)            
+            stage = attributes.getNamedItem(&quot;stage&quot;).getNodeValue();
+        if (attributes.getNamedItem(&quot;failure&quot;) != null)
+            failure = attributes.getNamedItem(&quot;failure&quot;).getNodeValue();
+        if (attributes.getNamedItem(&quot;keep&quot;) != null)
+            keep = attributes.getNamedItem(&quot;keep&quot;).getNodeValue();
+        
+        
+        //TODO handle args
+        //args = attributes.getNamedItem(&quot;src&quot;).getNodeValue();
+        
+        os = new OS();
+        os.initFromXML(elementNode);
     }
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/model/files/FileModel.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/files/FileModel.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/files/FileModel.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -23,6 +23,8 @@
 
 package izpack.frontend.model.files;
 
+import izpack.frontend.model.OS;
+
 import org.w3c.dom.Document;
 import org.w3c.dom.Element;
 import org.w3c.dom.NamedNodeMap;
@@ -45,12 +47,11 @@
         file.setAttribute(&quot;src&quot;, source);
         file.setAttribute(&quot;target&quot;, target);
         
-        if (!os.equals(&quot;&quot;))
-            file.setAttribute(&quot;os&quot;, os);
-        
         if (!override.equals(&quot;&quot;))
             file.setAttribute(&quot;override&quot;, override);
         
+        os.createXML(doc, file);
+        
         return file;
     }
 
@@ -62,8 +63,8 @@
         
         target = attributes.getNamedItem(&quot;target&quot;).getNodeValue();
         
-        if (attributes.getNamedItem(&quot;os&quot;) != null)
-            os = attributes.getNamedItem(&quot;os&quot;).getNodeValue();       
+        os = new OS();
+        os.initFromXML(elementNode);
         
         if (attributes.getNamedItem(&quot;override&quot;) != null)
             override = attributes.getNamedItem(&quot;override&quot;).getNodeValue();

Modified: izpack-frontend/trunk/src/izpack/frontend/model/files/FileSet.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/files/FileSet.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/files/FileSet.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -23,6 +23,8 @@
 
 package izpack.frontend.model.files;
 
+import izpack.frontend.model.OS;
+
 import java.util.ArrayList;
 import java.util.Iterator;
 
@@ -53,17 +55,16 @@
     {   
         Element fset = XML.createElement(&quot;fileset&quot;, doc);
         fset.setAttribute(&quot;dir&quot;, source);
-        fset.setAttribute(&quot;targetdir&quot;, target);
+        fset.setAttribute(&quot;targetdir&quot;, target);        
         
-        if (!os.equals(&quot;&quot;))
-            fset.setAttribute(&quot;os&quot;, os);
-        
         if (!override.equals(&quot;&quot;))
             fset.setAttribute(&quot;override&quot;, override);
         
         fset.setAttribute(&quot;casesensitive&quot;, yesNoBoolean(caseSensitive));
         fset.setAttribute(&quot;defaultexcludes&quot;, yesNoBoolean(defaultExcludes));
         
+        os.createXML(doc, fset);
+        
         for (Iterator iter = files.iterator(); iter.hasNext();)
         {
             Set element = (Set) iter.next();            
@@ -83,8 +84,8 @@
         
         target = attributes.getNamedItem(&quot;targetdir&quot;).getNodeValue();
         
-        if (attributes.getNamedItem(&quot;os&quot;) != null)
-            os = attributes.getNamedItem(&quot;os&quot;).getNodeValue();       
+        os = new OS();
+        os.initFromXML(elementNode);
         
         if (attributes.getNamedItem(&quot;override&quot;) != null)
             override = attributes.getNamedItem(&quot;override&quot;).getNodeValue();

Modified: izpack-frontend/trunk/src/izpack/frontend/model/files/PackFileModel.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/files/PackFileModel.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/files/PackFileModel.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -23,10 +23,13 @@
 
 package izpack.frontend.model.files;
 
+import izpack.frontend.model.OS;
+
 /**
  * @author Andy Gombos
  */
 public abstract class PackFileModel implements PackElement
 {
-    public String target = &quot;&quot;, source = &quot;&quot;, os = &quot;&quot;, override = &quot;&quot;;
+    public String target = &quot;&quot;, source = &quot;&quot;, override = &quot;&quot;;
+    public OS os;
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/model/files/Parsable.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/files/Parsable.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/files/Parsable.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -23,8 +23,11 @@
 
 package izpack.frontend.model.files;
 
+import izpack.frontend.model.OS;
+
 import org.w3c.dom.Document;
 import org.w3c.dom.Element;
+import org.w3c.dom.NamedNodeMap;
 import org.w3c.dom.Node;
 
 import utils.XML;
@@ -34,7 +37,8 @@
  */
 public class Parsable implements PackElement
 {
-    public String targetfile, type = &quot;plain&quot;, encoding, os;
+    public String targetfile, type = &quot;plain&quot;, encoding;
+    public OS os;    
 
     /* (non-Javadoc)
      * @see izpack.frontend.model.files.PackElement#writeXML()
@@ -48,15 +52,22 @@
         if (encoding != null &amp;&amp; !encoding.equals(&quot;&quot;))
             parsable.setAttribute(&quot;encoding&quot;, encoding);
         
-        if (os != null &amp;&amp; !os.equals(&quot;&quot;))
-            parsable.setAttribute(&quot;os&quot;, os);
+        os.createXML(doc, parsable);
         
         return parsable;
     }
 
     public void initFromXML(Node elementNode)
     {
-        // TODO Auto-generated method stub
+        NamedNodeMap attributes = elementNode.getAttributes();
         
+        //TODO handle error about missing required attributes
+        targetfile = attributes.getNamedItem(&quot;targetfile&quot;).getNodeValue();
+        
+        if (attributes.getNamedItem(&quot;encoding&quot;) != null)
+            encoding = attributes.getNamedItem(&quot;encoding&quot;).getNodeValue();
+        
+        os = new OS();
+        os.initFromXML(elementNode);        
     }
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/model/stages/ConfigurationStageModel.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/stages/ConfigurationStageModel.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/stages/ConfigurationStageModel.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -123,4 +123,11 @@
     {
         return editors;
     }
+
+    public void reset()
+    {
+        editors.clear();
+        
+        currentlyActivePanel = 0;        
+    }
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/model/stages/GeneralInformationModel.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/stages/GeneralInformationModel.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/stages/GeneralInformationModel.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -23,12 +23,13 @@
 
 package izpack.frontend.model.stages;
 
+import izpack.frontend.controller.AuthorManager;
 import izpack.frontend.model.Author;
 import izpack.frontend.model.SelectListModel;
 
-import java.net.MalformedURLException;
 import java.net.URL;
 import java.util.ArrayList;
+import java.util.Iterator;
 
 import javax.swing.ListModel;
 import javax.xml.xpath.XPath;
@@ -173,6 +174,30 @@
     //GUI Prefs
     boolean resizable;
     int width, height;
+    
+    public void resetModel()
+    {        
+        setAppName(&quot;&quot;);        
+        setHeight(0);
+        setWidth(0);
+        setHomepage(&quot;&quot;);        
+        setResizable(true);
+        setVersion(&quot;&quot;);
+        
+        authors.clear();
+        
+        
+        ArrayList authorListData = AuthorManager.loadAuthors();
+        if (authorListData != null)
+        {
+            for (Iterator iter = authorListData.iterator(); iter.hasNext(); )
+            {
+               authors.add(iter.next());
+            }        
+        }
+        
+        langCodes.clear();
+    }
 
     /* (non-Javadoc)
      * @see izpack.frontend.model.stages.StageDataModel#writeToXML()

Modified: izpack-frontend/trunk/src/izpack/frontend/model/stages/PackStageModel.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/stages/PackStageModel.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/stages/PackStageModel.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -73,21 +73,24 @@
      */
     public void initFromXML(Document doc)
     {
-        XPath xpath = XPathFactory.newInstance().newXPath();
+        XPath xpath = XPathFactory.newInstance().newXPath();        
         
+        
+        //Remove the spacer rows
+        for (int i = getRowCount() - 1; i &gt;= 0; i--)
+            removeRow(i);
+        
         try
         {
             NodeList packs = (NodeList) xpath.evaluate(&quot;//packs/pack&quot;, doc, XPathConstants.NODESET);
-            NodeList desc  = (NodeList)     xpath.evaluate(&quot;//packs/pack/description&quot;, doc, XPathConstants.NODESET);
+            NodeList desc  = (NodeList) xpath.evaluate(&quot;//packs/pack/description&quot;, doc, XPathConstants.NODESET);
             
             for (int i = 0; i &lt; packs.getLength(); i++)
-            {
+            {                
                 PackModel pack = new PackModel();
                 pack.initFromXML(i, packs.item(i), desc.item(i));
                 
-                //Insert a row, but remove the empty one that was present originally
-                insertRow(i, new Object[]{pack});
-                removeRow(getRowCount() - i - 1);
+                insertRow(i, new Object[]{pack});                
             }
         }
         catch (XPathExpressionException e)

Modified: izpack-frontend/trunk/src/izpack/frontend/model/stages/PanelModel.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/model/stages/PanelModel.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/model/stages/PanelModel.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -32,6 +32,15 @@
     public boolean valid;
     
     @Override
+    public boolean equals(Object obj)
+    {
+        if (obj instanceof PanelModel)
+            return configData.getName().equals(( (PanelModel) obj).configData.getName());
+        else
+            return false;
+    }
+    
+    @Override
     public String toString()
     {
         return configData.getName();

Added: izpack-frontend/trunk/src/izpack/frontend/view/components/OSSelector.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/components/OSSelector.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/components/OSSelector.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -0,0 +1,95 @@
+/*
+ * Created on Apr 7, 2005
+ * 
+ * $Id: OSComboBox.java Feb 8, 2004 izpack-frontend
+ * Copyright (C) 2005 Andy Gombos
+ * 
+ * File : OSComboBox.java 
+ * Description : TODO Add description
+ * Author's email : <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-changes">gumbo at users.berlios.de</A>
+ * 
+ * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ *     <A HREF="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</A>
+ *     
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package izpack.frontend.view.components;
+
+import izpack.frontend.model.OS;
+
+import java.awt.FlowLayout;
+
+import javax.swing.JCheckBox;
+import javax.swing.JPanel;
+
+import org.w3c.dom.Document;
+import org.w3c.dom.Element;
+
+import utils.XML;
+
+import com.jgoodies.binding.PresentationModel;
+import com.jgoodies.binding.adapter.Bindings;
+import com.jgoodies.binding.beans.PropertyAdapter;
+
+/**
+ * @author Andy Gombos
+ */
+public class OSSelector extends JPanel
+{
+    public OSSelector()
+    {       
+        windows = new JCheckBox(&quot;Windows&quot;);
+        unix = new JCheckBox(&quot;Unix&quot;);
+        mac = new JCheckBox(&quot;Mac&quot;);
+        
+        model = new PresentationModel(osModel);
+        
+        Bindings.bind(windows, model.getModel(&quot;windows&quot;));
+        Bindings.bind(unix, model.getModel(&quot;unix&quot;));
+        Bindings.bind(mac, model.getModel(&quot;mac&quot;));
+        
+        FlowLayout layout = new FlowLayout();
+        layout.setAlignment(FlowLayout.LEFT);
+        setLayout(layout);        
+        add(windows);
+        add(unix);
+        add(mac);
+    }
+    
+    public OS getOsModel()
+    {
+        return osModel;
+    }
+    
+    public void setOsModel(OS osModel)
+    {        
+        this.osModel = osModel;
+        
+        model = new PresentationModel(osModel);
+        
+        Bindings.bind(windows, model.getModel(&quot;windows&quot;));
+        Bindings.bind(unix, model.getModel(&quot;unix&quot;));
+        Bindings.bind(mac, model.getModel(&quot;mac&quot;));
+    }
+    
+    public void setNoneSelected()
+    {
+        osModel.setMac(false);
+        osModel.setWindows(false);
+        osModel.setUnix(false);
+    }
+    
+    private JCheckBox windows, unix, mac;
+    
+    //TODO the pack stuff should bind to the model, not create a new instance
+    private OS osModel = new OS();
+    private PresentationModel model;            
+}

Modified: izpack-frontend/trunk/src/izpack/frontend/view/components/table/PackCellEditor.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/components/table/PackCellEditor.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/components/table/PackCellEditor.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -25,6 +25,7 @@
 
 import izpack.frontend.model.PackModel;
 
+import java.awt.Color;
 import java.awt.Component;
 
 import javax.swing.AbstractCellEditor;
@@ -77,7 +78,7 @@
      
         editingValue = pm;
         
-        if (isSelected)
+        if (isSelected)        
             panel.setBorder(selected);
         else
             panel.setBorder(null);

Modified: izpack-frontend/trunk/src/izpack/frontend/view/components/table/PackCellRenderer.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/components/table/PackCellRenderer.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/components/table/PackCellRenderer.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -24,6 +24,7 @@
 
 import izpack.frontend.model.PackModel;
 
+import java.awt.Color;
 import java.awt.Component;
 
 import javax.swing.JCheckBox;
@@ -76,7 +77,7 @@
         desc.setText(pm.getDesc());
         required.setSelected(pm.isRequired());
 
-        if (isSelected)            
+        if (isSelected)
             panel.setBorder(selected);
         else
             panel.setBorder(null);

Modified: izpack-frontend/trunk/src/izpack/frontend/view/components/table/TableEditor.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/components/table/TableEditor.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/components/table/TableEditor.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -33,12 +33,16 @@
 
 import javax.swing.JButton;
 import javax.swing.JDialog;
+import javax.swing.event.DocumentEvent;
+import javax.swing.event.DocumentListener;
 
+import com.jgoodies.validation.ValidationResult;
+
 /**
  * @author Andy Gombos
  */
-public abstract class TableEditor extends JDialog implements ActionListener
-{     
+public abstract class TableEditor extends JDialog implements ActionListener, DocumentListener
+{   
     public TableEditor(Frame parent)
     {
         super(parent);
@@ -57,7 +61,23 @@
     public abstract void configureClean();
 
     public abstract ElementModel getModel();
+    
+    public abstract void configureValidation();
+    
+    public abstract ValidationResult validateEditor();
+    
+    public void insertUpdate(DocumentEvent e)
+    {
+        validateEditor();        
+    }
 
+    public void removeUpdate(DocumentEvent e)
+    {
+        validateEditor();        
+    }
+
+    public void changedUpdate(DocumentEvent e) {}
+    
     public boolean wasOKPressed()
     {
         return !cancelled;

Modified: izpack-frontend/trunk/src/izpack/frontend/view/mode/WizardMode.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/mode/WizardMode.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/mode/WizardMode.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -103,8 +103,7 @@
         getContentPane().add(leftNavBar, BorderLayout.WEST);
 
         createMenuBar();
-
-        setPreferredSize(new Dimension(700, 700));
+        
         pack();
 
         long stop = System.currentTimeMillis();
@@ -113,8 +112,19 @@
         System.out.println(&quot;Startup time: &quot; + startupTime + &quot;ms &quot; + (startupTime / 1000f) + &quot;s &quot;
                         + (startupTime / 1000 / 60f) + &quot;min&quot;);
     }
-
-    /*
+    
+    public void resetState()
+    {
+        ArrayList&lt;IzPackStage&gt; stages = IzPackStage.getAllStages();
+        for (IzPackStage stage : stages)
+        {
+            stage.resetStage();
+        }
+        
+        changeStage(new StageChangeEvent(GeneralInformation.class));
+    }
+    
+     /*
      * (non-Javadoc)
      * 
      * @see izpack.frontend.controller.StageChangeListener#changeStage(izpack.frontend.controller.StageChangeEvent)
@@ -265,5 +275,5 @@
     CardLayout layout = new CardLayout();    
 
     private static WelcomeScreen launcher;
-    private static ActionHandler actionHandler; 
+    private static ActionHandler actionHandler;         
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/IzPackStage.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/IzPackStage.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/IzPackStage.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -36,10 +36,13 @@
 import java.awt.Dimension;
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
+import java.beans.PropertyChangeEvent;
+import java.beans.PropertyChangeListener;
 import java.util.ArrayList;
 
 import javax.swing.JButton;
 import javax.swing.JPanel;
+import javax.swing.JScrollPane;
 
 import org.w3c.dom.Document;
 import org.w3c.dom.Element;
@@ -49,14 +52,14 @@
 import com.jgoodies.binding.PresentationModel;
 import com.jgoodies.forms.factories.ButtonBarFactory;
 import com.jgoodies.validation.ValidationResult;
+import com.jgoodies.validation.ValidationResultModel;
 import com.jgoodies.validation.util.DefaultValidationResultModel;
-import com.jgoodies.validation.util.ValidationResultModel;
 import com.jgoodies.validation.view.ValidationResultViewFactory;
 
 /**
  * @author Andy Gombos
  */
-public abstract class IzPackStage extends JPanel implements Stage
+public abstract class IzPackStage extends JPanel implements Stage, PropertyChangeListener
 {   
     protected boolean addValidationListeners = true;
 
@@ -64,32 +67,59 @@
     {
         return validationModel;
     }
+    
     public void setValidationModel(ValidationResultModel validationModel)
     {
         this.validationModel = validationModel;
     }
+    
     protected IzPackStage()
     {   
-        registerStage(this);       
+        registerStage(this);
         
+        validationModel.addPropertyChangeListener(
+                        ValidationResultModel.PROPERTYNAME_ERRORS, this);
+
+        
         //TODO Make the center component a fixed size
     }
+    
+    public abstract void resetStage();
 
+    public JPanel getLeftNavBar()
+    {
+        // TODO Auto-generated method stub
+        return null;
+    }
+
+    public void initializeStage()
+    {
+        validationModel.setResult(validateStage());        
+    }
+
+    public void initializeStageFromXML(Document doc)
+    {
+        // TODO Auto-generated method stub
+        
+    }
+
+    public void propertyChange(PropertyChangeEvent evt)
+    {
+        //if ( ((Boolean) evt.getNewValue() ).booleanValue() == false)
+          //  next.setEnabled(true);
+    }
+
     /*
      * (non-Javadoc)
      * 
      * @see izpack.frontend.view.stages.Stage#getTopNavBar()
      */
     public final JPanel getTopNavBar()
-    {
-        //JPanel base = new JPanel();        
-        
-        
-        
+    {        
         final StageContainer previousCont = stageOrder.getPreviousStage(this.getClass());
         final StageContainer nextCont = stageOrder.getNextStage(this.getClass());
         
-        JButton previous = null, next = null;
+        JButton previous = null;
         
         if (previousCont != null)
         {
@@ -101,9 +131,7 @@
             {
                 fireStageChangeEvent(new StageChangeEvent(previousCont.stageClass));
             }
-        	});        
-        	
-        	//base.add(previous);
+        	});
         }
         
         if (nextCont != null)
@@ -111,18 +139,15 @@
 	        next = UI.getNavButton(nextCont.buttonText, UI.FORWARD);
 	        
 	        next.addActionListener(new ActionListener()
-	        {
-	
+	        {	
 	            public void actionPerformed(ActionEvent e)
 	            {
 	                fireStageChangeEvent(new StageChangeEvent(nextCont.stageClass));
-	            }
-	
-	        });
-	     
-	        //if (previous != null)
-	          //  next.setPreferredSize(previous.getPreferredSize());
-	        //base.add(next);
+	            }	
+	        });	     
+            
+//            if (validationModel.hasErrors())
+  //              next.setEnabled(false);
            
 	    }
         
@@ -131,8 +156,7 @@
         else if (next == null)
             return ButtonBarFactory.buildRightAlignedBar(previous);
         else
-            return ButtonBarFactory.buildRightAlignedBar(previous, next);
-        //return base;
+            return ButtonBarFactory.buildRightAlignedBar(previous, next);      
     }
     
     /*
@@ -146,9 +170,12 @@
         
         validationModel.setResult(validateStage());
         
-        bottom.add(ValidationResultViewFactory.createReportList(validationModel));
+        JScrollPane resultsPane = new JScrollPane(ValidationResultViewFactory.createReportList(validationModel));
+        resultsPane.setPreferredSize(new Dimension(500, 100));
+        
+        bottom.add(resultsPane);
 
-        bottom.setPreferredSize(new Dimension(700, 100));
+        bottom.setPreferredSize(new Dimension(700, 120));
 
         return bottom;
     }
@@ -254,6 +281,8 @@
 	
 	protected static LangResources lr = IzPackFrame.getInstance().langResources();
 	protected static StageOrder stageOrder = new StageOrder();
+    
+    private JButton next = null;
 	
 	protected ValidationResultModel validationModel = new DefaultValidationResultModel();
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/compile/Compile.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/compile/Compile.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/compile/Compile.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -105,4 +105,11 @@
     }
     
     final CompileDisplay displayer;
+
+    @Override
+    public void resetStage()
+    {
+        // TODO Auto-generated method stub
+        
+    }
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/configure/PanelConfigurator.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/configure/PanelConfigurator.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/configure/PanelConfigurator.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -69,8 +69,7 @@
             panelSelectionModel = (PanelSelectionModel) panelSelectionInstance.getDataModel();
             
             if (panelSelectionModel != null)
-            {
-                
+            {                
                 panelSelectionModel.addListDataListener(this);                
             }
             else
@@ -229,4 +228,15 @@
     {
         xmlDoc = doc;        
     }
+
+    @Override
+    public void resetStage()
+    {        
+        model.reset();
+        
+        PanelSelectionModel panelSelectionModel = new PanelSelectionModel();
+        //panelSelectionModel.initWithAllPanels();
+        
+        model.setPanels(panelSelectionModel);
+    }
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/GeneralInfoPanel.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/GeneralInfoPanel.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/GeneralInfoPanel.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -134,7 +134,7 @@
         }
         
         configureValidation();
-        ValidationComponentUtils.updateComponentTreeValidationBackground(this, ValidationResult.EMPTY);                
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, ValidationResult.EMPTY);                
     }
     
     public void actionPerformed(ActionEvent e)
@@ -252,8 +252,8 @@
         ValidationComponentUtils.setMessageKey(appName, &quot;Info.application name&quot;);
         ValidationComponentUtils.setMessageKey(version, &quot;Info.application version&quot;);
         ValidationComponentUtils.setMessageKey(homepage, &quot;Info.homepage&quot;);
-    }
-    
+    }    
+       
     ArrayList authorListModel;
     
     SelectionInList authorModel;    

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/GeneralInformation.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/GeneralInformation.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/GeneralInformation.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -119,7 +119,7 @@
     }
     
     public PresentationModel getValidatingModel()
-    {
+    {   
         if (presModel == null)
         {
             presModel = new PresentationModel(getDataModel());
@@ -130,7 +130,7 @@
                                 {                                    
                                     ValidationResult result = getValidator().validate();
                                     validationModel.setResult(result);
-                                    ValidationComponentUtils.updateComponentTreeValidationBackground(generalInfoPage, result);
+                                    ValidationComponentUtils.updateComponentTreeSeverityBackground(generalInfoPage, result);
                                 }                
                             });
 
@@ -177,4 +177,11 @@
     {
         model.initFromXML(doc);        
     }
+
+    @Override
+    public void resetStage()
+    {
+        model.resetModel();        
+    }
+    
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/UIConfig.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/UIConfig.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/geninfo/UIConfig.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -27,16 +27,23 @@
 import izpack.frontend.view.stages.IzPackStage;
 import izpack.frontend.view.stages.configure.panels.IzPackPanel;
 
+import java.text.Format;
+import java.text.NumberFormat;
+
+import javax.swing.JFormattedTextField;
 import javax.swing.JLabel;
 import javax.swing.JTextField;
 
 import com.jgoodies.binding.PresentationModel;
 import com.jgoodies.binding.adapter.BasicComponentFactory;
 import com.jgoodies.binding.adapter.Bindings;
+import com.jgoodies.binding.value.ConverterFactory;
+import com.jgoodies.binding.value.ValueModel;
 import com.jgoodies.forms.builder.DefaultFormBuilder;
 import com.jgoodies.forms.layout.CellConstraints;
 import com.jgoodies.forms.layout.FormLayout;
 import com.jgoodies.validation.ValidationResult;
+import com.jgoodies.validation.formatter.EmptyNumberFormatter;
 import com.jgoodies.validation.view.ValidationComponentUtils;
 
 /**
@@ -68,7 +75,7 @@
         //TODO internationailze
         resizable = new YesNoCheckBox(&quot;Allow window resizes&quot;);
         
-        width = BasicComponentFactory.createIntegerField(pm.getModel(&quot;width&quot;));
+        width = BasicComponentFactory.createIntegerField(pm.getModel(&quot;width&quot;));        
         width.setColumns(5);
         height = BasicComponentFactory.createIntegerField(pm.getModel(&quot;height&quot;));
         height.setColumns(5);
@@ -96,7 +103,7 @@
         ValidationComponentUtils.setMessageKey(height, &quot;GUIPrefs.height&quot;);
         ValidationComponentUtils.setMessageKey(width, &quot;GUIPrefs.width&quot;);
         
-        ValidationComponentUtils.updateComponentTreeValidationBackground(this, ValidationResult.EMPTY);
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, ValidationResult.EMPTY);
     }
     
     PresentationModel pm;

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/ListTable.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/ListTable.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/ListTable.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -81,7 +81,7 @@
     }
     
     public void addElement(ElementModel em)
-    {
+    {   
         boolean elementAdded = false;
         for (int i = 0; i &lt; model.getRowCount(); i++)
         {
@@ -119,7 +119,7 @@
     }
     
     private void insertElementWithEditor(int row, Class type)
-    {
+    {        
         doubleClickEditor = em.getEditor(type);
         doubleClickEditor.configureClean();
         doubleClickEditor.setVisible(true);

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/Pack.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/Pack.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/Pack.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -220,7 +220,7 @@
     {
         JScrollPane scroll = new JScrollPane();
         scroll
-                        .setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);
+                        .setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);        
 
         scroll.setViewportView(table);
 
@@ -456,4 +456,10 @@
         model.initFromXML(doc);
     }
 
+    @Override
+    public void resetStage()
+    {
+        for (int i = 0; i &lt; model.getRowCount(); i++)
+            model.removeRow(i);        
+    }
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/DirectoryEditor.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/DirectoryEditor.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/DirectoryEditor.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -26,7 +26,7 @@
 import izpack.frontend.controller.filters.DirectoryFilter;
 import izpack.frontend.model.files.DirectoryModel;
 import izpack.frontend.model.files.ElementModel;
-import izpack.frontend.view.components.OSComboBox;
+import izpack.frontend.view.components.OSSelector;
 import izpack.frontend.view.components.OverwriteComboBox;
 import izpack.frontend.view.components.table.TableEditor;
 
@@ -34,8 +34,10 @@
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
 import java.io.File;
+import java.util.List;
 
 import javax.swing.JButton;
+import javax.swing.JComponent;
 import javax.swing.JFileChooser;
 import javax.swing.JPanel;
 import javax.swing.JTextField;
@@ -43,6 +45,10 @@
 import com.jgoodies.forms.builder.DefaultFormBuilder;
 import com.jgoodies.forms.factories.ButtonBarFactory;
 import com.jgoodies.forms.layout.FormLayout;
+import com.jgoodies.validation.Severity;
+import com.jgoodies.validation.ValidationResult;
+import com.jgoodies.validation.message.PropertyValidationMessage;
+import com.jgoodies.validation.view.ValidationComponentUtils;
 
 /**
  * @author Andy Gombos
@@ -52,6 +58,7 @@
     public DirectoryEditor(Frame parent)
     {
         super(parent);
+        setTitle(lr.getText(&quot;UI.DirEditor.Title&quot;));
         
         FormLayout layout = new FormLayout(&quot;right:max(40dlu;p), 3dlu, 80dlu, 3dlu, max(25dlu;p)&quot;, &quot;&quot;);
         DefaultFormBuilder builder = new DefaultFormBuilder(layout, new JPanel());
@@ -60,7 +67,7 @@
         target = new JTextField();
         source = new JTextField();
         overwrite = new OverwriteComboBox();
-        os = new OSComboBox();        
+        os = new OSSelector();        
                 
         browse = new JButton(lr.getText(&quot;UI.Buttons.Browse&quot;));
         
@@ -92,7 +99,7 @@
         builder.nextLine();        
         builder.append(&quot;&lt;html&gt;&quot; + lr.getText(&quot;UI.DirEditor.Overwrite&quot;), overwrite);
         builder.nextLine();
-        builder.append(lr.getText(&quot;UI.DirEditor.OS&quot;), os);
+        builder.append(lr.getText(&quot;UI.DirEditor.OS&quot;), os, 3);
         builder.nextLine();
         
         builder.appendUnrelatedComponentsGapRow();
@@ -124,7 +131,7 @@
         target.setText(fm.target);
         
         overwrite.setOverwriteOption(fm.override);
-        os.setOS(fm.os);
+        os.setOsModel(fm.os);
     }
 
     /* (non-Javadoc)
@@ -137,7 +144,7 @@
         target.setText(&quot;$INSTALL_PATH&quot;);
 
         overwrite.setSelectedIndex(-1);
-        os.setSelectedIndex(-1);
+        os.setNoneSelected();
     }
 
     /* (non-Javadoc)
@@ -150,7 +157,7 @@
         fm.source = source.getText();
         fm.target = target.getText();
         
-        fm.os = os.getOS();
+        fm.os = os.getOsModel();
         fm.override = overwrite.getOverwriteOption();
         
         return fm;
@@ -158,7 +165,7 @@
 
     JButton browse;
     JTextField target, source;    
-    OSComboBox os;
+    OSSelector os;
     OverwriteComboBox overwrite;
     /* (non-Javadoc)
      * @see izpack.frontend.view.components.table.TableEditor#handles(java.lang.Class)
@@ -167,4 +174,47 @@
     {
         return type.equals(DirectoryModel.class);
     }
+    
+    @Override
+    public void configureValidation()
+    {
+        System.out.println(&quot;Configure validation&quot;);
+        
+        ValidationComponentUtils.setMandatory(target, true);
+        ValidationComponentUtils.setMandatory(source, true);
+        
+        ValidationComponentUtils.setMessageKey(target, &quot;Target.file&quot;);
+        ValidationComponentUtils.setMessageKey(source, &quot;Source.file&quot;);        
+        
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, ValidationResult.EMPTY);
+    }
+
+    @Override
+    public ValidationResult validateEditor()
+    {        
+        ValidationResult vr = new ValidationResult();
+        
+        if (target.getText().length() == 0)
+            vr.add(new PropertyValidationMessage(Severity.ERROR, &quot;is mandatory&quot;, target, &quot;Target&quot;, &quot;file&quot;));
+        
+        if (source.getText().length() == 0)
+            vr.add(new PropertyValidationMessage(Severity.ERROR, &quot;is mandatory&quot;, source, &quot;Source&quot;, &quot;file&quot;));
+        else        
+            if (!new File(source.getText()).exists())
+                vr.add(new PropertyValidationMessage(Severity.WARNING, &quot;may not exist&quot;, source, &quot;Source&quot;, &quot;file&quot;));
+        
+        target.setToolTipText(null);
+        source.setToolTipText(null);
+        
+        List messages = vr.getMessages();
+        for (Object object : messages)
+        {
+            PropertyValidationMessage message = (PropertyValidationMessage) object;
+            ((JComponent) message.target()).setToolTipText(message.formattedText());
+        }
+        
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, vr);
+        
+        return vr;
+    }
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/ExecutableEditor.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/ExecutableEditor.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/ExecutableEditor.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -21,6 +21,16 @@
  * limitations under the License.
  */
 
+/*
+ * 
+ * 
+ * 
+ * TODO Implement arguments
+ * 
+ * 
+ * 
+ * 
+ */
 package izpack.frontend.view.stages.packs.editors;
 
 import izpack.frontend.controller.ComboBoxParser;
@@ -29,6 +39,7 @@
 import izpack.frontend.model.files.ElementModel;
 import izpack.frontend.model.files.Executable;
 import izpack.frontend.view.ClassChooser;
+import izpack.frontend.view.components.OSSelector;
 import izpack.frontend.view.components.YesNoRadioPanel;
 import izpack.frontend.view.components.table.TableEditor;
 
@@ -37,10 +48,12 @@
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
 import java.io.File;
+import java.util.List;
 
 import javax.swing.ButtonGroup;
 import javax.swing.JButton;
 import javax.swing.JComboBox;
+import javax.swing.JComponent;
 import javax.swing.JFileChooser;
 import javax.swing.JPanel;
 import javax.swing.JRadioButton;
@@ -49,6 +62,10 @@
 import com.jgoodies.forms.builder.DefaultFormBuilder;
 import com.jgoodies.forms.factories.ButtonBarFactory;
 import com.jgoodies.forms.layout.FormLayout;
+import com.jgoodies.validation.Severity;
+import com.jgoodies.validation.ValidationResult;
+import com.jgoodies.validation.message.PropertyValidationMessage;
+import com.jgoodies.validation.view.ValidationComponentUtils;
 
 /**
  * @author Andy Gombos
@@ -71,10 +88,14 @@
         execClass = new JTextField();
         bin = new JRadioButton(lr.getText(&quot;UI.ExecutableEditor.Type.Bin&quot;));
         jar = new JRadioButton(lr.getText(&quot;UI.ExecutableEditor.Type.JAR&quot;));
+        os = new OSSelector();
         stage = new JComboBox(ComboBoxParser.parseProperty(lr.getText(&quot;UI.ComboBox.Stage&quot;)));
         failure = new JComboBox(ComboBoxParser.parseProperty(lr.getText(&quot;UI.ComboBox.Failure&quot;)));
         keep = new YesNoRadioPanel(&quot;no&quot;);
         
+        target.getDocument().addDocumentListener(this);
+        execClass.getDocument().addDocumentListener(this);
+        
         JPanel typePanel = new JPanel();
         typePanel.setLayout(new FlowLayout());
         typePanel.add(bin);
@@ -121,6 +142,8 @@
         builder.nextLine();
         builder.append(lr.getText(&quot;UI.ExecutableEditor.Type&quot;), typePanel);
         builder.nextLine();
+        builder.append(lr.getText(&quot;UI.ExecutableEditor.OS&quot;), os);
+        builder.nextLine();
         builder.append(lr.getText(&quot;UI.ExecutableEditor.Stage&quot;), stage);
         builder.nextLine();
         builder.append(lr.getText(&quot;UI.ExecutableEditor.Failure&quot;), failure);
@@ -210,12 +233,49 @@
         
         return em;
     }
+    
+    @Override
+    public void configureValidation()
+    {        
+        ValidationComponentUtils.setMessageKey(target, &quot;Target.file&quot;);
+        ValidationComponentUtils.setMessageKey(execClass, &quot;Executable.class&quot;);        
+        
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, ValidationResult.EMPTY);
+    }
 
+    @Override
+    public ValidationResult validateEditor()
+    {        
+        System.out.println(&quot;Validating&quot;);
+        ValidationResult vr = new ValidationResult();
+        
+        if (target.getText().length() == 0)
+            vr.add(new PropertyValidationMessage(Severity.WARNING, &quot;should be provided&quot;, target, &quot;Target&quot;, &quot;file&quot;));
+        
+        if (target.getText().endsWith(&quot;jar&quot;) &amp;&amp; execClass.getText().length() == 0)
+            vr.add(new PropertyValidationMessage(Severity.WARNING, &quot;should specify the class to execute from the JAR&quot;, execClass, &quot;Executable&quot;, &quot;class&quot;));
+        
+        target.setToolTipText(null);        
+        execClass.setToolTipText(null);
+        
+        List messages = vr.getMessages();
+        for (Object object : messages)
+        {
+            PropertyValidationMessage message = (PropertyValidationMessage) object;
+            ((JComponent) message.target()).setToolTipText(message.formattedText());
+        }
+        
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, vr);
+        
+        return vr;
+    }
+
     JButton browse;
     JTextField target;
     JTextField execClass;
-    JRadioButton bin, jar;
+    JRadioButton bin, jar;    
     JComboBox stage;
     JComboBox failure;
     YesNoRadioPanel keep;
+    OSSelector os;
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/FileEditor.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/FileEditor.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/FileEditor.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -29,7 +29,7 @@
 import izpack.frontend.controller.filters.XMLFilter;
 import izpack.frontend.model.files.ElementModel;
 import izpack.frontend.model.files.FileModel;
-import izpack.frontend.view.components.OSComboBox;
+import izpack.frontend.view.components.OSSelector;
 import izpack.frontend.view.components.OverwriteComboBox;
 import izpack.frontend.view.components.table.TableEditor;
 
@@ -37,8 +37,10 @@
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
 import java.io.File;
+import java.util.List;
 
 import javax.swing.JButton;
+import javax.swing.JComponent;
 import javax.swing.JFileChooser;
 import javax.swing.JPanel;
 import javax.swing.JTextField;
@@ -46,24 +48,33 @@
 import com.jgoodies.forms.builder.DefaultFormBuilder;
 import com.jgoodies.forms.factories.ButtonBarFactory;
 import com.jgoodies.forms.layout.FormLayout;
+import com.jgoodies.validation.Severity;
+import com.jgoodies.validation.ValidationResult;
+import com.jgoodies.validation.message.PropertyValidationMessage;
+import com.jgoodies.validation.view.ValidationComponentUtils;
 
 /**
  * @author Andy Gombos
  */
+
 public class FileEditor extends TableEditor
 {
     public FileEditor(Frame parent)
     {
         super(parent);
+        setTitle(lr.getText(&quot;UI.FileEditor.Title&quot;));
         
         FormLayout layout = new FormLayout(&quot;right:max(40dlu;p), 3dlu, 80dlu, 3dlu, max(25dlu;p)&quot;, &quot;&quot;);
-        DefaultFormBuilder builder = new DefaultFormBuilder(layout, new JPanel());
+        DefaultFormBuilder builder = new DefaultFormBuilder(layout, new JPanel());        
         builder.setDefaultDialogBorder();
         
         target = new JTextField();
         source = new JTextField();
         overwrite = new OverwriteComboBox();
-        os = new OSComboBox();        
+        os = new OSSelector();
+        
+        target.getDocument().addDocumentListener(this);
+        source.getDocument().addDocumentListener(this);
                 
         browse = new JButton(lr.getText(&quot;UI.Buttons.Browse&quot;));
         
@@ -97,13 +108,14 @@
         builder.nextLine();        
         builder.append(&quot;&lt;html&gt;&quot; + lr.getText(&quot;UI.FileEditor.Overwrite&quot;), overwrite);
         builder.nextLine();
-        builder.append(lr.getText(&quot;UI.FileEditor.OS&quot;), os);
+        builder.append(lr.getText(&quot;UI.FileEditor.OS&quot;), os, 3);
         builder.nextLine();        
         
         builder.appendUnrelatedComponentsGapRow();
         builder.nextLine();
         builder.append(ButtonBarFactory.buildOKCancelBar(ok, cancel), 3);
         
+        configureValidation();
         getContentPane().add(builder.getPanel());
         pack();
         getRootPane().setDefaultButton(ok);
@@ -129,7 +141,7 @@
         target.setText(fm.target);
         
         overwrite.setOverwriteOption(fm.override);
-        os.setOS(fm.os);
+        os.setOsModel(fm.os);
     }
 
     /* (non-Javadoc)
@@ -142,7 +154,7 @@
         target.setText(&quot;$INSTALL_PATH&quot;);
 
         overwrite.setSelectedIndex(-1);
-        os.setSelectedIndex(-1);
+        os.setNoneSelected();
     }
 
     /* (non-Javadoc)
@@ -155,7 +167,7 @@
         fm.source = source.getText();
         fm.target = target.getText();
         
-        fm.os = os.getOS();
+        fm.os = os.getOsModel();
         fm.override = overwrite.getOverwriteOption();
         
         return fm;
@@ -163,7 +175,7 @@
 
     JButton browse;
     JTextField target, source;    
-    OSComboBox os;
+    OSSelector os;
     OverwriteComboBox overwrite;
     /* (non-Javadoc)
      * @see izpack.frontend.view.components.table.TableEditor#handles(java.lang.Class)
@@ -172,4 +184,45 @@
     {
         return type.equals(FileModel.class);
     }
+
+    @Override
+    public void configureValidation()
+    {   
+        ValidationComponentUtils.setMandatory(target, true);
+        ValidationComponentUtils.setMandatory(source, true);
+        
+        ValidationComponentUtils.setMessageKey(target, &quot;Target.file&quot;);
+        ValidationComponentUtils.setMessageKey(source, &quot;Source.file&quot;);        
+        
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, ValidationResult.EMPTY);
+    }
+
+    @Override
+    public ValidationResult validateEditor()
+    {        
+        ValidationResult vr = new ValidationResult();
+        
+        if (target.getText().length() == 0)
+            vr.add(new PropertyValidationMessage(Severity.ERROR, &quot;is mandatory&quot;, target, &quot;Target&quot;, &quot;file&quot;));
+        
+        if (source.getText().length() == 0)
+            vr.add(new PropertyValidationMessage(Severity.ERROR, &quot;is mandatory&quot;, source, &quot;Source&quot;, &quot;file&quot;));
+        else        
+            if (!new File(source.getText()).exists())
+                vr.add(new PropertyValidationMessage(Severity.WARNING, &quot;may not exist&quot;, source, &quot;Source&quot;, &quot;file&quot;));
+        
+        target.setToolTipText(null);
+        source.setToolTipText(null);
+        
+        List messages = vr.getMessages();
+        for (Object object : messages)
+        {
+            PropertyValidationMessage message = (PropertyValidationMessage) object;
+            ((JComponent) message.target()).setToolTipText(message.formattedText());
+        }        
+        
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, vr);        
+        
+        return vr;
+    }
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/FileSetEditor.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/FileSetEditor.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/FileSetEditor.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -29,7 +29,7 @@
 import izpack.frontend.controller.filters.XMLFilter;
 import izpack.frontend.model.files.ElementModel;
 import izpack.frontend.model.files.FileSet;
-import izpack.frontend.view.components.OSComboBox;
+import izpack.frontend.view.components.OSSelector;
 import izpack.frontend.view.components.OverwriteComboBox;
 import izpack.frontend.view.components.YesNoRadioPanel;
 import izpack.frontend.view.components.table.TableEditor;
@@ -38,10 +38,12 @@
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
 import java.io.File;
+import java.util.List;
 
 import javax.swing.Box;
 import javax.swing.BoxLayout;
 import javax.swing.JButton;
+import javax.swing.JComponent;
 import javax.swing.JFileChooser;
 import javax.swing.JList;
 import javax.swing.JPanel;
@@ -52,6 +54,10 @@
 import com.jgoodies.forms.builder.DefaultFormBuilder;
 import com.jgoodies.forms.factories.ButtonBarFactory;
 import com.jgoodies.forms.layout.FormLayout;
+import com.jgoodies.validation.Severity;
+import com.jgoodies.validation.ValidationResult;
+import com.jgoodies.validation.message.PropertyValidationMessage;
+import com.jgoodies.validation.view.ValidationComponentUtils;
 
 /**
  * @author Andy Gombos
@@ -62,6 +68,8 @@
     {
         super(parent);
         
+        setTitle(lr.getText(&quot;UI.FileSetEditor.Title&quot;));
+        
         FormLayout layout = new FormLayout(&quot;right:max(40dlu;p), 3dlu, 80dlu, 3dlu, max(25dlu;p)&quot;, &quot;&quot;);
         DefaultFormBuilder builder = new DefaultFormBuilder(layout, new JPanel());
         builder.setDefaultDialogBorder();
@@ -69,10 +77,13 @@
         target = new JTextField();
         source = new JTextField();
         overwrite = new OverwriteComboBox();
-        os = new OSComboBox();
+        os = new OSSelector();
         defaultExcludes = new YesNoRadioPanel(&quot;yes&quot;);
-        caseSensitive = new YesNoRadioPanel(&quot;yes&quot;);        
+        caseSensitive = new YesNoRadioPanel(&quot;yes&quot;);
         
+        target.getDocument().addDocumentListener(this);
+        source.getDocument().addDocumentListener(this);        
+        
         fileSetsModel = new FileSet();
         fileSets = new JList(fileSetsModel);
         
@@ -107,12 +118,8 @@
             public void actionPerformed(ActionEvent e)
             {        
                 JFileChooser chooser = new JFileChooser();
-                chooser.addChoosableFileFilter(new ImageFilter());
-                chooser.addChoosableFileFilter(new TextFilter());
-                chooser.addChoosableFileFilter(new XMLFilter());
-                chooser.addChoosableFileFilter(new HTMLFilter());
-                chooser.setFileSelectionMode(JFileChooser.FILES_ONLY);                
-                chooser.setDialogTitle(lr.getText(&quot;UI.FileEditor.Title&quot;));
+                chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);                
+                chooser.setDialogTitle(lr.getText(&quot;UI.FileSetEditor.BrowseTitle&quot;));
                 
                 if (source.getText().length() != 0)
                 {
@@ -126,13 +133,13 @@
             }
         });
         
-        builder.append(lr.getText(&quot;UI.FileEditor.Source&quot;), source, browse);
+        builder.append(lr.getText(&quot;UI.FileSetEditor.Source&quot;), source, browse);
         builder.nextLine();
-        builder.append(lr.getText(&quot;UI.FileEditor.Target&quot;), target);
+        builder.append(lr.getText(&quot;UI.FileSetEditor.Target&quot;), target);
         builder.nextLine();        
         builder.append(&quot;&lt;html&gt;&quot; + lr.getText(&quot;UI.FileEditor.Overwrite&quot;), overwrite);
         builder.nextLine();
-        builder.append(lr.getText(&quot;UI.FileEditor.OS&quot;), os);
+        builder.append(lr.getText(&quot;UI.FileEditor.OS&quot;), os, 3);
         builder.nextLine();        
         
         builder.append(lr.getText(&quot;UI.FileSetEditor.Excludes&quot;), defaultExcludes);
@@ -149,7 +156,8 @@
         builder.nextLine();
         builder.append(ButtonBarFactory.buildOKCancelBar(ok, cancel), 3);
         builder.nextLine();
-        
+     
+        configureValidation();
         getContentPane().add(builder.getPanel());
         pack();
         getRootPane().setDefaultButton(ok);
@@ -174,7 +182,7 @@
         target.setText(fs.target);
         
         overwrite.setOverwriteOption(fs.override);
-        os.setOS(fs.os);
+        os.setOsModel(fs.os);
         
         defaultExcludes.setBoolean(fs.defaultExcludes);
         caseSensitive.setBoolean(fs.caseSensitive);
@@ -191,7 +199,7 @@
         target.setText(&quot;$INSTALL_PATH&quot;);
 
         overwrite.setSelectedIndex(-1);
-        os.setSelectedIndex(-1);
+        os.setNoneSelected();
         
         defaultExcludes.setSelected(&quot;yes&quot;);
         caseSensitive.setSelected(&quot;yes&quot;);
@@ -211,7 +219,7 @@
         fs.source = source.getText();
         fs.target = target.getText();
         
-        fs.os = os.getOS();
+        fs.os = os.getOsModel();
         fs.override = overwrite.getOverwriteOption();
         
         fs.caseSensitive = caseSensitive.getBoolean();
@@ -224,7 +232,7 @@
 
     JButton browse;
     JTextField target, source;    
-    OSComboBox os;
+    OSSelector os;
     OverwriteComboBox overwrite;
     YesNoRadioPanel defaultExcludes;
     YesNoRadioPanel caseSensitive;
@@ -240,4 +248,46 @@
     {
         return type.equals(FileSet.class);
     }
+    
+    @Override
+    public void configureValidation()
+    {   
+        System.out.println(&quot;fileset config valid&quot;);
+        ValidationComponentUtils.setMandatory(target, true);
+        ValidationComponentUtils.setMandatory(source, true);
+        
+        ValidationComponentUtils.setMessageKey(target, &quot;Destination.directory&quot;);
+        ValidationComponentUtils.setMessageKey(source, &quot;Source.directory&quot;);        
+        
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, ValidationResult.EMPTY);
+    }
+
+    @Override
+    public ValidationResult validateEditor()
+    {   
+        ValidationResult vr = new ValidationResult();
+        
+        if (target.getText().length() == 0)
+            vr.add(new PropertyValidationMessage(Severity.ERROR, &quot;is mandatory&quot;, target, &quot;Destination&quot;, &quot;directory&quot;));
+        
+        if (source.getText().length() == 0)
+            vr.add(new PropertyValidationMessage(Severity.ERROR, &quot;is mandatory&quot;, source, &quot;Source&quot;, &quot;directory&quot;));
+        else        
+            if (!new File(source.getText()).exists())
+                vr.add(new PropertyValidationMessage(Severity.WARNING, &quot;may not exist&quot;, source, &quot;Source&quot;, &quot;directory&quot;));
+        
+        target.setToolTipText(null);
+        source.setToolTipText(null);
+        
+        List messages = vr.getMessages();
+        for (Object object : messages)
+        {
+            PropertyValidationMessage message = (PropertyValidationMessage) object;
+            ((JComponent) message.target()).setToolTipText(message.formattedText());
+        }
+        
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, vr);
+        
+        return vr;
+    }
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/PackEditor.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/PackEditor.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/PackEditor.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -27,19 +27,26 @@
 import izpack.frontend.model.files.ElementModel;
 import izpack.frontend.view.components.AbstractListSelect;
 import izpack.frontend.view.components.DependencyListSelect;
-import izpack.frontend.view.components.OSComboBox;
+import izpack.frontend.view.components.OSSelector;
 import izpack.frontend.view.components.YesNoRadioPanel;
 import izpack.frontend.view.components.table.TableEditor;
 
 import java.awt.Frame;
+import java.io.File;
+import java.util.List;
 
 import javax.swing.JButton;
+import javax.swing.JComponent;
 import javax.swing.JPanel;
 import javax.swing.JTextField;
 
 import com.jgoodies.forms.builder.DefaultFormBuilder;
 import com.jgoodies.forms.factories.ButtonBarFactory;
 import com.jgoodies.forms.layout.FormLayout;
+import com.jgoodies.validation.Severity;
+import com.jgoodies.validation.ValidationResult;
+import com.jgoodies.validation.message.PropertyValidationMessage;
+import com.jgoodies.validation.view.ValidationComponentUtils;
 
 /**
  * @author Andy Gombos
@@ -57,24 +64,27 @@
         name = new JTextField();
         desc = new JTextField();
         id = new JTextField();
-        osBox = new OSComboBox();
+        osSel = new OSSelector();
         requiredPanel = new YesNoRadioPanel(&quot;yes&quot;);
         preselectPanel = new YesNoRadioPanel(&quot;yes&quot;);
-        looseFilesPanel = new YesNoRadioPanel(&quot;no&quot;);        
+        looseFilesPanel = new YesNoRadioPanel(&quot;no&quot;);
         
+        name.getDocument().addDocumentListener(this);
+        desc.getDocument().addDocumentListener(this);        
+        
         ok = new JButton(lr.getText(&quot;UI.Buttons.OK&quot;));
         ok.addActionListener(this);
         
         cancel = new JButton(lr.getText(&quot;UI.Buttons.Cancel&quot;));
         cancel.addActionListener(this);
         
-        builder.append(lr.getText(&quot;UI.PackEditor.Name&quot;), name);
+        builder.append(lr.getText(&quot;UI.PackEditor.Name&quot;), name, 2);
         builder.nextLine();
         builder.append(lr.getText(&quot;UI.PackEditor.Desc&quot;), desc, 2);
         builder.nextLine();
-        builder.append(lr.getText(&quot;UI.PackEditor.ID&quot;), id);
+        builder.append(lr.getText(&quot;UI.PackEditor.ID&quot;), id, 2);
         builder.nextLine();
-        builder.append(lr.getText(&quot;UI.PackEditor.OS&quot;), osBox);
+        builder.append(lr.getText(&quot;UI.PackEditor.OS&quot;), osSel, 2);
         builder.nextLine();
         
         builder.appendUnrelatedComponentsGapRow();        
@@ -87,16 +97,13 @@
         builder.nextLine();
         
         builder.appendUnrelatedComponentsGapRow();
-        builder.nextLine();
+        builder.nextLine();        
         
-        //builder.append(createDependencyPanel());
-        
-        //builder.appendUnrelatedComponentsGapRow();
-        //builder.nextLine();
-        
         builder.append(ButtonBarFactory.buildOKCancelBar(ok, cancel), 3);
         builder.nextLine();
         
+        configureValidation();
+        
         getContentPane().add(builder.getPanel());
         pack();
         getRootPane().setDefaultButton(ok);
@@ -122,6 +129,8 @@
     {
         name.requestFocusInWindow();
         
+        validateEditor();
+        
         super.setVisible(b);
     }
     
@@ -132,7 +141,7 @@
         name.setText(p.getName());
         desc.setText(p.getDesc());
         id.setText(p.getId());
-        osBox.setOS(p.getOS());
+        osSel.setOsModel(p.getOS());
         
         requiredPanel.setBoolean(p.isRequired());
         preselectPanel.setBoolean(p.isPreselected());
@@ -146,7 +155,7 @@
         p.setName(name.getText());
         p.setDesc(desc.getText());
         p.setId(id.getText());
-        p.setOS(osBox.getOS());
+        p.setOSes(osSel.getOsModel());
         
         p.setRequired(requiredPanel.getBoolean());
         p.setPreselected(preselectPanel.getBoolean());
@@ -156,7 +165,7 @@
     }    
     
     JTextField name, desc, id;
-    OSComboBox osBox;
+    OSSelector osSel;
     YesNoRadioPanel preselectPanel;
     YesNoRadioPanel looseFilesPanel;
     YesNoRadioPanel requiredPanel;    
@@ -170,7 +179,7 @@
         desc.setText(&quot;&quot;);
         id.setText(&quot;&quot;);
         
-        osBox.setSelectedIndex(-1);
+        osSel.setNoneSelected();
        
         requiredPanel.setBoolean(true);
         preselectPanel.setBoolean(true);
@@ -184,4 +193,44 @@
     {
         return type.equals(PackModel.class);
     }
+    
+    @Override
+    public void configureValidation()
+    {   
+        System.out.println(&quot;pack config valid&quot;);
+        ValidationComponentUtils.setMandatory(name, true);
+        ValidationComponentUtils.setMandatory(desc, true);
+        
+        ValidationComponentUtils.setMessageKey(name, &quot;Pack.name&quot;);
+        ValidationComponentUtils.setMessageKey(desc, &quot;Pack.description&quot;);        
+        
+        validateEditor();
+    }
+
+    @Override
+    public ValidationResult validateEditor()
+    {        
+        ValidationResult vr = new ValidationResult();
+        
+        if (name.getText().length() == 0)
+            vr.add(new PropertyValidationMessage(Severity.ERROR, &quot;is mandatory&quot;, name, &quot;Pack&quot;, &quot;name&quot;));
+        
+        if (desc.getText().length() == 0)
+            vr.add(new PropertyValidationMessage(Severity.ERROR, &quot;is mandatory&quot;, desc, &quot;Pack&quot;, &quot;description&quot;));
+        
+        name.setToolTipText(null);
+        desc.setToolTipText(null);
+        
+        List messages = vr.getMessages();
+        for (Object object : messages)
+        {
+            PropertyValidationMessage message = (PropertyValidationMessage) object;
+            ((JComponent) message.target()).setToolTipText(message.formattedText());
+        }
+        
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, vr);
+        ValidationComponentUtils.updateComponentTreeMandatoryAndBlankBackground(this);
+        
+        return vr;
+    }
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/ParsableEditor.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/ParsableEditor.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/ParsableEditor.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -26,14 +26,17 @@
 import izpack.frontend.model.files.ElementModel;
 import izpack.frontend.model.files.Parsable;
 import izpack.frontend.view.components.FormatComboBox;
-import izpack.frontend.view.components.OSComboBox;
+import izpack.frontend.view.components.OSSelector;
 import izpack.frontend.view.components.table.TableEditor;
 
 import java.awt.Frame;
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
+import java.io.File;
+import java.util.List;
 
 import javax.swing.JButton;
+import javax.swing.JComponent;
 import javax.swing.JFileChooser;
 import javax.swing.JPanel;
 import javax.swing.JTextField;
@@ -41,6 +44,10 @@
 import com.jgoodies.forms.builder.DefaultFormBuilder;
 import com.jgoodies.forms.factories.ButtonBarFactory;
 import com.jgoodies.forms.layout.FormLayout;
+import com.jgoodies.validation.Severity;
+import com.jgoodies.validation.ValidationResult;
+import com.jgoodies.validation.message.PropertyValidationMessage;
+import com.jgoodies.validation.view.ValidationComponentUtils;
 
 /**
  * @author Andy Gombos
@@ -58,8 +65,10 @@
         targetFile = new JTextField();
         format = new FormatComboBox();
         encoding = new JTextField();
-        os = new OSComboBox();
+        os = new OSSelector();
         
+        targetFile.getDocument().addDocumentListener(this);
+        
         ok = new JButton(lr.getText(&quot;UI.Buttons.OK&quot;));
         ok.addActionListener(this);
         
@@ -84,13 +93,14 @@
         builder.nextLine();
         builder.append(lr.getText(&quot;UI.ParsableEditor.Encoding&quot;), encoding);
         builder.nextLine();
-        builder.append(lr.getText(&quot;UI.ParsableEditor.OS&quot;), os);
+        builder.append(lr.getText(&quot;UI.ParsableEditor.OS&quot;), os, 3);
         builder.nextLine();        
         
         builder.appendUnrelatedComponentsGapRow();
         builder.nextLine();
         builder.append(ButtonBarFactory.buildOKCancelBar(ok, cancel), 3);
         
+        configureValidation();
         getContentPane().add(builder.getPanel());
         pack();
         getRootPane().setDefaultButton(ok);
@@ -116,7 +126,7 @@
         encoding.setText(pm.encoding);
         
         format.setFormat(pm.type);
-        os.setOS(pm.os);
+        os.setOsModel(pm.os);
     }
 
     /* (non-Javadoc)
@@ -129,7 +139,7 @@
         encoding.setText(&quot;&quot;);
         
         format.setSelectedIndex(-1);
-        os.setSelectedIndex(-1);        
+        os.setNoneSelected();        
     }
 
     /* (non-Javadoc)
@@ -143,7 +153,7 @@
         pm.encoding = encoding.getText();
         
         pm.type = format.getFormat();
-        pm.os = os.getOS();
+        pm.os = os.getOsModel();
         
         return pm;
     }
@@ -152,7 +162,7 @@
     JTextField targetFile;
     FormatComboBox format;
     JTextField encoding;
-    OSComboBox os;
+    OSSelector os;
     /* (non-Javadoc)
      * @see izpack.frontend.view.components.table.TableEditor#handles(java.lang.Class)
      */
@@ -160,4 +170,38 @@
     {
         return type.equals(Parsable.class);
     }   
+    
+    @Override
+    public void configureValidation()
+    {   
+        ValidationComponentUtils.setMandatory(targetFile, true);        
+        
+        ValidationComponentUtils.setMessageKey(targetFile, &quot;Target.file&quot;);                
+        
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, ValidationResult.EMPTY);
+    }
+
+    @Override
+    public ValidationResult validateEditor()
+    {        
+        ValidationResult vr = new ValidationResult();        
+        
+        if (targetFile.getText().length() == 0)
+            vr.add(new PropertyValidationMessage(Severity.ERROR, &quot;is mandatory&quot;, targetFile, &quot;Target&quot;, &quot;file&quot;));
+        else if (!new File(targetFile.getText()).exists())
+            vr.add(new PropertyValidationMessage(Severity.WARNING, &quot;may not exist&quot;, targetFile, &quot;Target&quot;, &quot;file&quot;));
+        
+        targetFile.setToolTipText(null);
+        
+        List messages = vr.getMessages();
+        for (Object object : messages)
+        {
+            PropertyValidationMessage message = (PropertyValidationMessage) object;
+            ((JComponent) message.target()).setToolTipText(message.formattedText());
+        }
+        
+        ValidationComponentUtils.updateComponentTreeSeverityBackground(this, vr);
+        
+        return vr;
+    }
 }

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/SetEditor.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/SetEditor.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/packs/editors/SetEditor.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -77,7 +77,7 @@
         builder.add(new JLabel(lr.getText(&quot;UI.SetEditor.Name&quot;)), new CellConstraints(1, 1), descriptor, cc.xy(3, 1));
         builder.add(include, cc.xy(1, 3));        
         builder.add(exclude, cc.xy(3, 3));        
-        builder.add(ButtonBarFactory.buildOKCancelBar(ok, cancel), cc.xyw(1, 5, 3, CellConstraints.CENTER, CellConstraints.FILL));
+        builder.add(ButtonBarFactory.buildOKCancelBar(ok, cancel), cc.xyw(1, 5, 3, CellConstraints.CENTER, CellConstraints.FILL));        
         
         add(builder.getPanel());        
         pack();

Modified: izpack-frontend/trunk/src/izpack/frontend/view/stages/panelselect/PanelSelection.java
===================================================================
--- izpack-frontend/trunk/src/izpack/frontend/view/stages/panelselect/PanelSelection.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/izpack/frontend/view/stages/panelselect/PanelSelection.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -135,4 +135,10 @@
     {
         model.initFromXML(doc);        
     }
+
+    @Override
+    public void resetStage()
+    {
+        model.clear();
+    }
 }

Added: izpack-frontend/trunk/src/lib/validation-1.3.0.jar
===================================================================
(Binary files differ)


Property changes on: izpack-frontend/trunk/src/lib/validation-1.3.0.jar
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: izpack-frontend/trunk/src/res/i18n/LangResources_en.properties
===================================================================
--- izpack-frontend/trunk/src/res/i18n/LangResources_en.properties	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/res/i18n/LangResources_en.properties	2006-08-11 15:52:24 UTC (rev 1527)
@@ -25,6 +25,7 @@
 UI.ExecutableEditor.Stage                      = Stage to execute during
 UI.ExecutableEditor.Target                     = Executable file
 UI.ExecutableEditor.Type                       = Type of executable
+UI.ExecutableEditor.OS                         = OS(es) to execute on
 UI.ExecutableEditor.Type.Bin                   = Binary
 UI.ExecutableEditor.Type.JAR                   = Class in JAR
 UI.FileEditor.OS                               = Applicable OS
@@ -42,11 +43,14 @@
 UI.FileFilters.Jar.Desc                        = JAR Files (JAR)
 UI.FileFilters.Text.Desc                       = Text Files (TXT, INI, CONF)
 UI.FileFilters.XML.Desc                        = XML Files (XML, XSL)
+UI.FileSetEditor.Source                        = Source directory
+UI.FileSetEditor.Target                        = Destination directory
 UI.FileSetEditor.AddSet                        = Add Set
 UI.FileSetEditor.CaseSensitive                 = Set pattern is case sensitive
 UI.FileSetEditor.Excludes                      = Use default exclude set
 UI.FileSetEditor.RemoveSet                     = Remove Set
 UI.FileSetEditor.Title                         = Create a file set...
+UI.FileSetEditor.BrowseTitle                   = Select the source directory...
 UI.GeneralInfoPage.APPNAME.Text                = Application Name\:
 UI.GeneralInfoPage.AUTHORS.Text                = Authors\:
 UI.GeneralInfoPage.Dialog.ELEMENT.CancelButton = Cancel

Modified: izpack-frontend/trunk/src/utils/XML.java
===================================================================
--- izpack-frontend/trunk/src/utils/XML.java	2006-08-08 14:41:42 UTC (rev 1526)
+++ izpack-frontend/trunk/src/utils/XML.java	2006-08-11 15:52:24 UTC (rev 1527)
@@ -27,6 +27,7 @@
 import java.io.FileNotFoundException;
 import java.io.IOException;
 
+import javax.xml.XMLConstants;
 import javax.xml.parsers.DocumentBuilder;
 import javax.xml.parsers.DocumentBuilderFactory;
 import javax.xml.parsers.ParserConfigurationException;
@@ -39,15 +40,16 @@
 import javax.xml.transform.dom.DOMSource;
 import javax.xml.transform.stream.StreamResult;
 import javax.xml.transform.stream.StreamSource;
+import javax.xml.validation.Schema;
+import javax.xml.validation.SchemaFactory;
+import javax.xml.validation.Validator;
 import javax.xml.xpath.XPath;
-import javax.xml.xpath.XPathConstants;
 import javax.xml.xpath.XPathExpressionException;
 import javax.xml.xpath.XPathFactory;
 
 import org.w3c.dom.Document;
 import org.w3c.dom.Element;
 import org.w3c.dom.Node;
-import org.w3c.dom.NodeList;
 import org.xml.sax.SAXException;
 
 import exceptions.DocumentCreationException;
@@ -90,7 +92,7 @@
             document = builder.parse(new File(filename));            
             
             String URI = new File(filename).getParent();
-            
+                        
             if (URI == null)
                 URI = &quot;&quot;;
             else
@@ -172,6 +174,47 @@
         }
     }
     
+    public static void writeXML(StreamResult stream, Node node, String xslFile)
+    {
+        try
+        {   
+            // Prepare the DOM document for writing
+            Source source = new DOMSource(node);
+
+            // Prepare the output file            
+            Result result = stream;
+
+            //Load the XSL file to make everything pretty
+            StreamSource xsl = new StreamSource(new File(xslFile));
+            // Write the DOM document to the file
+            // Get Transformer
+            //This won't properly indent - research indicates a 1.5 bug (so 1.3 JAXP?)            
+            TransformerFactory tFactory = TransformerFactory.newInstance();
+            Transformer xformer = tFactory.newTransformer(xsl);
+            
+            //Set the output doctype
+            //String systemValue = new File(&quot;dtd/installation.dtd&quot;).getPath();            
+            //xformer.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM, systemValue);
+            
+            //xformer.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);
+            
+            // Write to a file
+            xformer.transform(source, result);
+        }
+        catch (TransformerConfigurationException tce)
+        {
+            //TODO Make this a better handler - it's not really a fatal error
+            //But, we can't save anything without a working transformer. So, maybe it is
+            //UI.showError(&quot;An error occurred configuring the transformer for XML output&quot;, )
+            throw new UnhandleableException(tce);
+        }
+        catch (TransformerException te)
+        {
+            //TODO Same as above
+            throw new UnhandleableException(te);
+        }
+    }
+    
     public static Document merge(Document doc1, Document doc2)
     {
         Element head1 = doc1.getDocumentElement();
@@ -202,7 +245,7 @@
     {        
         try
         {            
-            //Use XPath to return the resource value by searching with it
+            //Use XPath to return the resource value by searching with it            
             return xpath.evaluate(&quot;//res[@id='&quot; + id + &quot;']/@src&quot;, document);            
         }
         catch (XPathExpressionException xpee)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000271.html">[izpack-changes] r1526 - in	izpack-src/trunk/src/lib/com/izforge/izpack: gui installer
</A></li>
	<LI>Next message: <A HREF="000273.html">[izpack-changes] r1528 - izpack-frontend/trunk/src/lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#272">[ date ]</a>
              <a href="thread.html#272">[ thread ]</a>
              <a href="subject.html#272">[ subject ]</a>
              <a href="author.html#272">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/izpack-changes">More information about the izpack-changes
mailing list</a><br>
</body></html>

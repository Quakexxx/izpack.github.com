<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [izpack-devel] yet another patch - user panel layout when switching packs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:izpack-devel%40lists.berlios.de?Subject=%5Bizpack-devel%5D%20yet%20another%20patch%20-%20user%20panel%20layout%20when%0A%20switching%20packs&In-Reply-To=44C0CB04.1060508%40imbus.de">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001090.html">
   <LINK REL="Next"  HREF="001068.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[izpack-devel] yet another patch - user panel layout when switching packs</H1>
    <B>David.Guan</B> 
    <A HREF="mailto:izpack-devel%40lists.berlios.de?Subject=%5Bizpack-devel%5D%20yet%20another%20patch%20-%20user%20panel%20layout%20when%0A%20switching%20packs&In-Reply-To=44C0CB04.1060508%40imbus.de"
       TITLE="[izpack-devel] yet another patch - user panel layout when switching packs">soft.guan at yahoo.com.cn
       </A><BR>
    <I>Sat May  5 05:46:24 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001090.html">[izpack-devel] Docutils
</A></li>
        <LI>Next message: <A HREF="001068.html">[izpack-devel] Fix properly position components while switching between packs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1067">[ date ]</a>
              <a href="thread.html#1067">[ thread ]</a>
              <a href="subject.html#1067">[ subject ]</a>
              <a href="author.html#1067">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hello everyone.
This problem still exists in the IzPack3.10.1.
It has not been solved.


Joachim Hofer wrote:
&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> this has haunted IzPack for far too long now...
</I>&gt;<i> 
</I>&gt;<i> Scenario: When I select a pack and forward to some UserInputPanel (which
</I>&gt;<i> has elements that depend on the pack), then go back and switch to
</I>&gt;<i> another pack and forward again to the UserInputPanel, then I get ugly
</I>&gt;<i> stuff (butchered layout, exceptions).
</I>&gt;<i> 
</I>&gt;<i> I noticed some beginnings of a workaround in the source, but disabling
</I>&gt;<i> the back button isn't really a viable solution, imho.
</I>&gt;<i> 
</I>&gt;<i> The source of all evil really is the empty &quot;removeLayoutComponent()&quot; in
</I>&gt;<i> the TwoColumnLayout. So I implemented it so that it allows a clean
</I>&gt;<i> &quot;removeAll()&quot;.
</I>&gt;<i> 
</I>&gt;<i> I adapted the UserInputPanel accordingly - buildUI() now does a
</I>&gt;<i> &quot;removeAll()&quot; and adds all components back afterwards each time it's
</I>&gt;<i> activated.
</I>&gt;<i> 
</I>&gt;<i> (Unfortunately, I didn't get the layout to work cleanly with individual
</I>&gt;<i> &quot;remove()&quot;s. I'm no expert with custom LayoutManagers.)
</I>&gt;<i> 
</I>&gt;<i> I also removed a NullPointerException I happened upon (I think it was in
</I>&gt;<i> the case of empty SearchField choices) - this is a small modification in
</I>&gt;<i> the RuleInputField code.
</I>&gt;<i> 
</I>&gt;<i> These three changes are attached.
</I>&gt;<i> 
</I>&gt;<i> The patch is generated by subversion and based on rev 1493 (I did branch
</I>&gt;<i> this time as I don't know yet if you're going to take over my previous
</I>&gt;<i> patch(es)).
</I>&gt;<i> 
</I>&gt;<i> I hope you like it. :-)
</I>&gt;<i> 
</I>&gt;<i> Joachim Hofer
</I>&gt;<i> imbus AG
</I>&gt;<i> 
</I>&gt;<i> Index: src/lib/com/izforge/izpack/gui/TwoColumnLayout.java
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- src/lib/com/izforge/izpack/gui/TwoColumnLayout.java	(Revision 1493)
</I>&gt;<i> +++ src/lib/com/izforge/izpack/gui/TwoColumnLayout.java	(Arbeitskopie)
</I>&gt;<i> @@ -874,13 +874,34 @@
</I>&gt;<i>      {
</I>&gt;<i>      }
</I>&gt;<i>  
</I>&gt;<i> +    private void removeLayoutComponent(Component comp, int pos) {
</I>&gt;<i> +        // look through all components
</I>&gt;<i> +        int numComponents = components[pos].size();
</I>&gt;<i> +        for (int i = numComponents - 1; i &gt;= 0; i--)
</I>&gt;<i> +        {
</I>&gt;<i> +            TwoColumnConstraints existingComp = (TwoColumnConstraints)
</I>&gt;<i> components[pos].get(i);
</I>&gt;<i> +            if (null != existingComp &amp;&amp; comp == existingComp.component)
</I>&gt;<i> +            {
</I>&gt;<i> +                components[pos].remove(i);
</I>&gt;<i> +                break;
</I>&gt;<i> +            }
</I>&gt;<i> +        }
</I>&gt;<i> +    }
</I>&gt;<i> +
</I>&gt;<i>      /**
</I>&gt;<i> -     * This functionality is not supported
</I>&gt;<i> +     * Removes the specified component from the layout.
</I>&gt;<i>       * 
</I>&gt;<i> +     * Unfortunately, this does not seem to work completely. This means
</I>&gt;<i> that removing 
</I>&gt;<i> +     * individual components from an existing layout will probably still
</I>&gt;<i> kill that layout.
</I>&gt;<i> +     * However, removeAll() and adding the components again afterwards
</I>&gt;<i> should work now 
</I>&gt;<i> +     * if you need a fresh start for the layout.
</I>&gt;<i> +     *
</I>&gt;<i>       * @param comp the component to be removed
</I>&gt;<i>       */
</I>&gt;<i>      public void removeLayoutComponent(Component comp)
</I>&gt;<i>      {
</I>&gt;<i> +        removeLayoutComponent(comp, LEFT);
</I>&gt;<i> +        removeLayoutComponent(comp, RIGHT);
</I>&gt;<i>      }
</I>&gt;<i>  
</I>&gt;<i>      /**
</I>&gt;<i> Index: src/lib/com/izforge/izpack/panels/RuleInputField.java
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- src/lib/com/izforge/izpack/panels/RuleInputField.java	(Revision 1493)
</I>&gt;<i> +++ src/lib/com/izforge/izpack/panels/RuleInputField.java	(Arbeitskopie)
</I>&gt;<i> @@ -748,17 +748,20 @@
</I>&gt;<i>     
</I>&gt;<i> /*--------------------------------------------------------------------------*/
</I>&gt;<i>      public void caretUpdate(CaretEvent event)
</I>&gt;<i>      {
</I>&gt;<i> -        String text = activeField.getText();
</I>&gt;<i> -        int fieldSize = activeField.getEditLength();
</I>&gt;<i> -        int caretPosition = activeField.getCaretPosition();
</I>&gt;<i> -        int selection = activeField.getSelectionEnd() -
</I>&gt;<i> activeField.getSelectionStart();
</I>&gt;<i> +        if (activeField != null)
</I>&gt;<i> +        {
</I>&gt;<i> +            String text = activeField.getText();
</I>&gt;<i> +            int fieldSize = activeField.getEditLength();
</I>&gt;<i> +            int caretPosition = activeField.getCaretPosition();
</I>&gt;<i> +            int selection = activeField.getSelectionEnd() -
</I>&gt;<i> activeField.getSelectionStart();
</I>&gt;<i>  
</I>&gt;<i> -        if ((!inputFields.lastElement().equals(activeField)) &amp;&amp;
</I>&gt;<i> (!activeField.unlimitedEdit()))
</I>&gt;<i> -        {
</I>&gt;<i> -            if ((text.length() == fieldSize) &amp;&amp; (selection == 0) &amp;&amp;
</I>&gt;<i> (caretPosition == fieldSize)
</I>&gt;<i> -                    &amp;&amp; !backstep)
</I>&gt;<i> +            if ((!inputFields.lastElement().equals(activeField)) &amp;&amp;
</I>&gt;<i> (!activeField.unlimitedEdit()))
</I>&gt;<i>              {
</I>&gt;<i> -                activeField.transferFocus();
</I>&gt;<i> +                if ((text.length() == fieldSize) &amp;&amp; (selection == 0) &amp;&amp;
</I>&gt;<i> (caretPosition == fieldSize)
</I>&gt;<i> +                        &amp;&amp; !backstep)
</I>&gt;<i> +                {
</I>&gt;<i> +                    activeField.transferFocus();
</I>&gt;<i> +                }
</I>&gt;<i>              }
</I>&gt;<i>          }
</I>&gt;<i>      }
</I>&gt;<i> Index: src/lib/com/izforge/izpack/panels/UserInputPanel.java
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- src/lib/com/izforge/izpack/panels/UserInputPanel.java	(Revision 1493)
</I>&gt;<i> +++ src/lib/com/izforge/izpack/panels/UserInputPanel.java	(Arbeitskopie)
</I>&gt;<i> @@ -308,14 +308,6 @@
</I>&gt;<i>  
</I>&gt;<i>      protected int instanceNumber = 0;
</I>&gt;<i>  
</I>&gt;<i> -    /**
</I>&gt;<i> -     * If there is a possibility that some UI elements will not get added
</I>&gt;<i> we can not allow to go
</I>&gt;<i> -     * back to the PacksPanel, because the process of building the UI is
</I>&gt;<i> not reversable. This
</I>&gt;<i> -     * variable keeps track if any packs have been defined and will be
</I>&gt;<i> used to make a decision for
</I>&gt;<i> -     * locking the 'previous' button.
</I>&gt;<i> -     */
</I>&gt;<i> -    private boolean packsDefined = false;
</I>&gt;<i> -
</I>&gt;<i>      private InstallerFrame parentFrame;
</I>&gt;<i>  
</I>&gt;<i>      /** The parsed result from reading the XML specification from the
</I>&gt;<i> file */
</I>&gt;<i> @@ -519,16 +511,8 @@
</I>&gt;<i>              parentFrame.skipPanel();
</I>&gt;<i>              return;
</I>&gt;<i>          }
</I>&gt;<i> -        // if (uiBuilt)
</I>&gt;<i> -        // {
</I>&gt;<i> -        // return;
</I>&gt;<i> -        // }
</I>&gt;<i>  
</I>&gt;<i>          buildUI();
</I>&gt;<i> -        if (packsDefined)
</I>&gt;<i> -        {
</I>&gt;<i> -            parentFrame.lockPrevButton();
</I>&gt;<i> -        }
</I>&gt;<i>      }
</I>&gt;<i>  
</I>&gt;<i>     
</I>&gt;<i> /*--------------------------------------------------------------------------*/
</I>&gt;<i> @@ -561,6 +545,10 @@
</I>&gt;<i>      {
</I>&gt;<i>          Object[] uiElement;
</I>&gt;<i>  
</I>&gt;<i> +		// clean up before starting to build the UI; things may have changed
</I>&gt;<i> +		// (ie if the user has selected a different panel in the meantime)
</I>&gt;<i> +		removeAll();
</I>&gt;<i> +
</I>&gt;<i>          for (int i = 0; i &lt; uiElements.size(); i++)
</I>&gt;<i>          {
</I>&gt;<i>              uiElement = (Object[]) uiElements.elementAt(i);
</I>&gt;<i> @@ -570,11 +558,7 @@
</I>&gt;<i>              {
</I>&gt;<i>                  try
</I>&gt;<i>                  {
</I>&gt;<i> -                    if (uiElement[POS_DISPLAYED] == null
</I>&gt;<i> -                            ||
</I>&gt;<i> &quot;false&quot;.equals(uiElement[POS_DISPLAYED].toString()))
</I>&gt;<i> -                    {
</I>&gt;<i> -                        add((JComponent) uiElement[POS_FIELD],
</I>&gt;<i> uiElement[POS_CONSTRAINTS]);
</I>&gt;<i> -                    }
</I>&gt;<i> +					add((JComponent) uiElement[POS_FIELD], uiElement[POS_CONSTRAINTS]);
</I>&gt;<i>  
</I>&gt;<i>                      uiElement[POS_DISPLAYED] = Boolean.valueOf(true);
</I>&gt;<i>                      uiElements.remove(i);
</I>&gt;<i> @@ -588,19 +572,6 @@
</I>&gt;<i>              }
</I>&gt;<i>              else
</I>&gt;<i>              {
</I>&gt;<i> -                try
</I>&gt;<i> -                {
</I>&gt;<i> -                    if (uiElement[POS_DISPLAYED] != null
</I>&gt;<i> -                            &amp;&amp;
</I>&gt;<i> &quot;true&quot;.equals(uiElement[POS_DISPLAYED].toString()))
</I>&gt;<i> -                    {
</I>&gt;<i> -                        remove((JComponent) uiElement[POS_FIELD]);
</I>&gt;<i> -                    }
</I>&gt;<i> -                }
</I>&gt;<i> -                catch (Throwable exception)
</I>&gt;<i> -                {
</I>&gt;<i> -                    System.out.println(&quot;Internal format error in field: &quot;
</I>&gt;<i> -                            + uiElement[POS_TYPE].toString()); // !!!
</I>&gt;<i> logging
</I>&gt;<i> -                }
</I>&gt;<i>                  uiElement[POS_DISPLAYED] = Boolean.valueOf(false);
</I>&gt;<i>                  uiElements.remove(i);
</I>&gt;<i>                  uiElements.add(i, uiElement);
</I>&gt;<i> @@ -2318,16 +2289,6 @@
</I>&gt;<i>          if (packs.size() == 0) { return (true); }
</I>&gt;<i>  
</I>&gt;<i>          // ----------------------------------------------------
</I>&gt;<i> -        // We are getting to this point if any packs have been
</I>&gt;<i> -        // specified. This means that there is a possibility
</I>&gt;<i> -        // that some UI elements will not get added. This
</I>&gt;<i> -        // means that we can not allow to go back to the
</I>&gt;<i> -        // PacksPanel, because the process of building the
</I>&gt;<i> -        // UI is not reversable.
</I>&gt;<i> -        // ----------------------------------------------------
</I>&gt;<i> -        // packsDefined = true;
</I>&gt;<i> -
</I>&gt;<i> -        // ----------------------------------------------------
</I>&gt;<i>          // analyze if the any of the packs for which the item
</I>&gt;<i>          // is required have been selected for installation.
</I>&gt;<i>          // ----------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> izpack-devel mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel at lists.berlios.de</A>
</I>&gt;<i> <A HREF="http://bat.berlios.de/mailman/listinfo/izpack-devel">http://bat.berlios.de/mailman/listinfo/izpack-devel</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>
-- 
View this message in context: <A HREF="http://www.nabble.com/yet-another-patch---user-panel-layout-when-switching-packs-tf1980027.html#a10333386">http://www.nabble.com/yet-another-patch---user-panel-layout-when-switching-packs-tf1980027.html#a10333386</A>
Sent from the izpack devel mailing list archive at Nabble.com.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001090.html">[izpack-devel] Docutils
</A></li>
	<LI>Next message: <A HREF="001068.html">[izpack-devel] Fix properly position components while switching between packs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1067">[ date ]</a>
              <a href="thread.html#1067">[ thread ]</a>
              <a href="subject.html#1067">[ subject ]</a>
              <a href="author.html#1067">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/izpack-devel">More information about the izpack-devel
mailing list</a><br>
</body></html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [izpack-devel] Patch 5/6 patch against the current trunk
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:izpack-devel%40lists.berlios.de?Subject=%5Bizpack-devel%5D%20Patch%205/6%20patch%20against%20the%20current%20trunk&In-Reply-To=D86ACDA44DB9304C99DC9CEBC86AB6508848DF%40pulinco1.pulinco.ch">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000774.html">
   <LINK REL="Next"  HREF="000778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[izpack-devel] Patch 5/6 patch against the current trunk</H1>
    <B>Ari Voutilainen</B> 
    <A HREF="mailto:izpack-devel%40lists.berlios.de?Subject=%5Bizpack-devel%5D%20Patch%205/6%20patch%20against%20the%20current%20trunk&In-Reply-To=D86ACDA44DB9304C99DC9CEBC86AB6508848DF%40pulinco1.pulinco.ch"
       TITLE="[izpack-devel] Patch 5/6 patch against the current trunk">ari.voutilainen at iki.fi
       </A><BR>
    <I>Wed Jan 10 21:44:07 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000774.html">[izpack-devel] Patch 5/6 patch against the current trunk
</A></li>
        <LI>Next message: <A HREF="000778.html">[izpack-devel] Patch 5/6 patch against the current trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#777">[ date ]</a>
              <a href="thread.html#777">[ thread ]</a>
              <a href="subject.html#777">[ subject ]</a>
              <a href="author.html#777">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I think taking language from OS is the best guess to offer 
readable texts to user. But this should be offered via language 
selection dialog. So situation is this:

langFromOS=yes &amp;&amp; lang pack found =&gt; You have to make your 
installation with that language.

What about if I go to Germany and let's assume I can understand 
only Finnish. My friend have German as regional settings and 
langFromOS is yes and lang pack is found so installer gives me 
German and I would say something... well, at least I wouldn't 
thank developers. This is only one example where this feature 
isn't very good. We cannot be 100 % sure the _user_ wants to use 
that language which is set in a operating system.

If someone wants to offer only one language in the installation I 
think he/she should edit install XML file so that there will be 
only one language and that is used regardless of the regional 
settings. If there is multiple languages let's have a selection 
dialog with the language which is in the system (or english if 
not matched). So I vote for the original behaviour.

Regards,
Ari

Markus Schlegel wrote:
&gt;<i> Hi Julien
</I>&gt;<i> 
</I>&gt;<i> I've also made a patch against the current trunk for the
</I>&gt;<i> &quot;langFromOS&quot;-Feature.
</I>&gt;<i> 
</I>&gt;<i> I can not understand why this feature is a problem for the izpack team,
</I>&gt;<i> since it does not change current behavior. I can understand when the
</I>&gt;<i> commandline switch (in my original post) was a problem for you. But I
</I>&gt;<i> changed the implementation to use gui-modifiers. Also I have added the
</I>&gt;<i> Documentation for it.
</I>&gt;<i> 
</I>&gt;<i> Please concern, that the Language Selection Dialog is the only part of
</I>&gt;<i> your installer (except for the uninstaller) that can not be replaced by
</I>&gt;<i> an other component and that cannot be omitted (if you want to support
</I>&gt;<i> multiple installer languages).
</I>&gt;<i> 
</I>&gt;<i> Mabe there is someone on the users-list that would vote for this
</I>&gt;<i> feature?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Regards
</I>&gt;<i> Markus
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel-bounces at lists.berlios.de</A>
</I>&gt;<i> [mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel-bounces at lists.berlios.de</A>] On Behalf Of Julien Ponge
</I>&gt;<i> Sent: Tuesday, January 09, 2007 8:40 AM
</I>&gt;<i> To: <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel at lists.berlios.de</A>
</I>&gt;<i> Subject: Re: [izpack-devel] Next release will be 3.10.0
</I>&gt;<i> 
</I>&gt;<i> Hi Markus,
</I>&gt;<i> 
</I>&gt;<i> ...
</I>&gt;<i> 
</I>&gt;<i> About 5/6: I will have a look again to make my mind, but I am mildly in
</I>&gt;<i> favour of this patch since there is no consensus about it.
</I>&gt;<i> 
</I>&gt;<i> ...
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> Index: C:/deron/tools_/IzPack_TRUNK/src/lib/com/izforge/izpack/installer/GUIInstaller.java
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- C:/deron/tools_/IzPack_TRUNK/src/lib/com/izforge/izpack/installer/GUIInstaller.java	(revision 1698)
</I>&gt;<i> +++ C:/deron/tools_/IzPack_TRUNK/src/lib/com/izforge/izpack/installer/GUIInstaller.java	(working copy)
</I>&gt;<i> @@ -1,5 +1,5 @@
</I>&gt;<i>  /*
</I>&gt;<i> - * $Id:$
</I>&gt;<i> + * $Id$
</I>&gt;<i>   * IzPack - Copyright 2001-2006 Julien Ponge, All Rights Reserved.
</I>&gt;<i>   * 
</I>&gt;<i>   * <A HREF="http://www.izforge.com/izpack/">http://www.izforge.com/izpack/</A>
</I>&gt;<i> @@ -205,35 +205,57 @@
</I>&gt;<i>          List availableLangPacks = getAvailableLangPacks();
</I>&gt;<i>          int npacks = availableLangPacks.size();
</I>&gt;<i>          if (npacks == 0) throw new Exception(&quot;no language pack available&quot;);
</I>&gt;<i> -        String selectedPack;
</I>&gt;<i> +        String selectedPack = null;
</I>&gt;<i> + 
</I>&gt;<i> +        //if modifier langFromOS is set to &quot;yes&quot;, we may not display a dialog and take instead the language from the OS
</I>&gt;<i> +        //The Langugedialog is displayed anyway, if the installer does not contain the language that the system runs with.
</I>&gt;<i> +        if (useLanguageFromOS()){
</I>&gt;<i> +            Locale l = Locale.getDefault();
</I>&gt;<i> +            String osCode = l.getISO3Language().toLowerCase();
</I>&gt;<i> +            if (availableLangPacks.contains(osCode)){
</I>&gt;<i> +                selectedPack = osCode;
</I>&gt;<i> +            }else{
</I>&gt;<i> +                //now let's try the countrycode for backward compatibility. Think we should take langcode instead...
</I>&gt;<i> +                osCode = l.getISO3Country().toLowerCase();
</I>&gt;<i> +                if (availableLangPacks.contains(osCode)){
</I>&gt;<i> +                    selectedPack = osCode;
</I>&gt;<i> +                }else{
</I>&gt;<i> +                    //noop, let the user choose the language...
</I>&gt;<i> +                }
</I>&gt;<i> +            }
</I>&gt;<i> +        }
</I>&gt;<i> +        
</I>&gt;<i> +        if (selectedPack==null){
</I>&gt;<i> +            // Dummy Frame
</I>&gt;<i> +            JFrame frame = new JFrame();
</I>&gt;<i> +            frame.setIconImage(new ImageIcon(this.getClass().getResource(&quot;/img/JFrameIcon.png&quot;))
</I>&gt;<i> +            .getImage());
</I>&gt;<i>  
</I>&gt;<i> -        // Dummy Frame
</I>&gt;<i> -        JFrame frame = new JFrame();
</I>&gt;<i> -        frame.setIconImage(new ImageIcon(this.getClass().getResource(&quot;/img/JFrameIcon.png&quot;))
</I>&gt;<i> -                .getImage());
</I>&gt;<i> +            Dimension frameSize = frame.getSize();
</I>&gt;<i> +            Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
</I>&gt;<i> +            frame.setLocation((screenSize.width - frameSize.width) / 2,
</I>&gt;<i> +                    (screenSize.height - frameSize.height) / 2 - 10);
</I>&gt;<i>  
</I>&gt;<i> -        Dimension frameSize = frame.getSize();
</I>&gt;<i> -        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
</I>&gt;<i> -        frame.setLocation((screenSize.width - frameSize.width) / 2,
</I>&gt;<i> -                (screenSize.height - frameSize.height) / 2 - 10);
</I>&gt;<i> +            // We get the langpack name
</I>&gt;<i> +            if (npacks != 1)
</I>&gt;<i> +            {
</I>&gt;<i> +                LanguageDialog picker = new LanguageDialog(frame, availableLangPacks.toArray());
</I>&gt;<i> +                picker.setSelection(Locale.getDefault().getISO3Country().toLowerCase());
</I>&gt;<i> +                picker.setModal(true);
</I>&gt;<i> +                picker.toFront();
</I>&gt;<i> +                //frame.setVisible(true);
</I>&gt;<i> +                frame.setVisible(false);
</I>&gt;<i> +                picker.setVisible(true);
</I>&gt;<i>  
</I>&gt;<i> -        // We get the langpack name
</I>&gt;<i> -        if (npacks != 1)
</I>&gt;<i> -        {
</I>&gt;<i> -            LanguageDialog picker = new LanguageDialog(frame, availableLangPacks.toArray());
</I>&gt;<i> -            picker.setSelection(Locale.getDefault().getISO3Country().toLowerCase());
</I>&gt;<i> -            picker.setModal(true);
</I>&gt;<i> -            picker.toFront();
</I>&gt;<i> -            //frame.setVisible(true);
</I>&gt;<i> -            frame.setVisible(false);
</I>&gt;<i> -            picker.setVisible(true);
</I>&gt;<i> -
</I>&gt;<i> -            selectedPack = (String) picker.getSelection();
</I>&gt;<i> -            if (selectedPack == null) throw new Exception(&quot;installation canceled&quot;);
</I>&gt;<i> +                selectedPack = (String) picker.getSelection();
</I>&gt;<i> +                if (selectedPack == null) throw new Exception(&quot;installation canceled&quot;);
</I>&gt;<i> +            }
</I>&gt;<i> +            else
</I>&gt;<i> +            {
</I>&gt;<i> +                selectedPack = (String) availableLangPacks.get(0);
</I>&gt;<i> +            }
</I>&gt;<i>          }
</I>&gt;<i> -        else
</I>&gt;<i> -            selectedPack = (String) availableLangPacks.get(0);
</I>&gt;<i> -
</I>&gt;<i> +        
</I>&gt;<i>          // We add an xml data information
</I>&gt;<i>          this.installdata.xmlData.setAttribute(&quot;langpack&quot;, selectedPack);
</I>&gt;<i>  
</I>&gt;<i> @@ -440,6 +462,20 @@
</I>&gt;<i>          return (true);
</I>&gt;<i>      }
</I>&gt;<i>  
</I>&gt;<i> +    /** 
</I>&gt;<i> +     * Returns whether the Language Selection Dialog should be displayed even if the Installer contains a language matching the System's language.
</I>&gt;<i> +     *
</I>&gt;<i> +     * @return true if the gui-modifier &quot;langFromOS&quot; was set to &quot;yes&quot;, false otherwise
</I>&gt;<i> +     */
</I>&gt;<i> +     protected boolean useLanguageFromOS()
</I>&gt;<i> +     {
</I>&gt;<i> +         if (installdata.guiPrefs.modifier.containsKey(&quot;langFromOS&quot;) 
</I>&gt;<i> +                &amp;&amp; &quot;yes&quot;.equalsIgnoreCase((String) installdata.guiPrefs.modifier.get(&quot;langFromOS&quot;)))
</I>&gt;<i> +             return (true);
</I>&gt;<i> +         else
</I>&gt;<i> +             return (false);
</I>&gt;<i> +     }
</I>&gt;<i> +
</I>&gt;<i>      /**
</I>&gt;<i>       * Returns the type in which the language should be displayed in the language selction dialog.
</I>&gt;<i>       * Possible are &quot;iso3&quot;, &quot;native&quot; and &quot;usingDefault&quot;.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> Index: C:/deron/tools_/IzPack_TRUNK/src/doc-ng/XHTML/node5.html
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- C:/deron/tools_/IzPack_TRUNK/src/doc-ng/XHTML/node5.html	(revision 1698)
</I>&gt;<i> +++ C:/deron/tools_/IzPack_TRUNK/src/doc-ng/XHTML/node5.html	(working copy)
</I>&gt;<i> @@ -273,6 +273,16 @@
</I>&gt;<i>          language will be used if possible, else the notation of the default locale. Using &quot;default&quot;
</I>&gt;<i>          will be presented the language in the notation of the default locale of the VM.
</I>&gt;<i>        &lt;/li&gt;
</I>&gt;<i> +
</I>&gt;<i> +      &lt;li&gt;
</I>&gt;<i> +        &lt;tt&gt;langFromOS&lt;/tt&gt;:&lt;br /&gt;
</I>&gt;<i> +        possible are &quot;yes&quot; or &quot;no&quot;. Default (when ommitted) is &quot;no&quot;. If it is set to &quot;yes&quot;, 
</I>&gt;<i> +        the installer first checks if the system runs with a language supported by the installer 
</I>&gt;<i> +        and ommits the Lanugage Selection Dialog if so. If the System runs with a Language not 
</I>&gt;<i> +        supported by the installer, the Language Selection Dialog is displayed neverthless. &lt;br /&gt;
</I>&gt;<i> +        Example: If you have an Installer supporting German and English with &quot;langFromOS=yes&quot;, 
</I>&gt;<i> +        the dialog will show up on french systems but not on german or english ones.
</I>&gt;<i> +      &lt;/li&gt;
</I>&gt;<i>      &lt;/ul&gt;
</I>&gt;<i>  
</I>&gt;<i>      &lt;h2&gt;&lt;a id=&quot;modifyingPanels&quot; name=&quot;modifyingPanels&quot;&gt;Modifying IzPack Panels&lt;/a&gt;&lt;/h2&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> izpack-devel mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">https://lists.berlios.de/mailman/listinfo/izpack-devel</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000774.html">[izpack-devel] Patch 5/6 patch against the current trunk
</A></li>
	<LI>Next message: <A HREF="000778.html">[izpack-devel] Patch 5/6 patch against the current trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#777">[ date ]</a>
              <a href="thread.html#777">[ thread ]</a>
              <a href="subject.html#777">[ subject ]</a>
              <a href="author.html#777">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/izpack-devel">More information about the izpack-devel
mailing list</a><br>
</body></html>

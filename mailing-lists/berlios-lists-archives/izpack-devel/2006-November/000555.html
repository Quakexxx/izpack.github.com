<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [izpack-devel] Bug in InstallerFrame.java, v3.9.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:izpack-devel%40lists.berlios.de?Subject=%5Bizpack-devel%5D%20Bug%20in%20InstallerFrame.java%2C%20v3.9.0&In-Reply-To=">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000554.html">
   <LINK REL="Next"  HREF="000556.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[izpack-devel] Bug in InstallerFrame.java, v3.9.0</H1>
    <B>Bartz, Klaus</B> 
    <A HREF="mailto:izpack-devel%40lists.berlios.de?Subject=%5Bizpack-devel%5D%20Bug%20in%20InstallerFrame.java%2C%20v3.9.0&In-Reply-To="
       TITLE="[izpack-devel] Bug in InstallerFrame.java, v3.9.0">Klaus.Bartz at coi.de
       </A><BR>
    <I>Mon Nov  6 12:21:13 CET 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000554.html">[izpack-devel] Bug in InstallerFrame.java, v3.9.0
</A></li>
        <LI>Next message: <A HREF="000556.html">[izpack-devel] Bug in InstallerFrame.java, v3.9.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#555">[ date ]</a>
              <a href="thread.html#555">[ thread ]</a>
              <a href="subject.html#555">[ subject ]</a>
              <a href="author.html#555">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Fran&#231;ois,
just checked in the bugfix into trunk.
All access operations to visiblePanelMapping
has to use count instead of i else an installation
with hidden panels will be failed with out of bounds
(of course my installations have hidden panels...).

Additional I have addapted installation.dtd to this
feature. Before it, a validation with an os tag for
panels have to failed, think.

@Fabrice: Hi Fabrice,
fixing this bug I have searched for a docu for this
feature. I have nothing found. At adding of this feature
to cvs before two years only the docu for Packs and OS
where updated, but not for Panels and OS.
Can you look also and if needed add a short docu?

Cheers

Klaus

&gt;<i>-----Original Message-----
</I>&gt;<i>From: <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel-bounces at lists.berlios.de</A>
</I>&gt;<i>[mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel-bounces at lists.berlios.de</A>]On Behalf Of Bartz, Klaus
</I>&gt;<i>Sent: Monday, November 06, 2006 9:13 AM
</I>&gt;<i>To: <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel at lists.berlios.de</A>
</I>&gt;<i>Subject: Re: [izpack-devel] Bug in InstallerFrame.java, v3.9.0
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Hi Fran&#231;ois,
</I>&gt;<i>thank you for your bug report and fix.
</I>&gt;<i>Normally we need the result of a diff -u. I have
</I>&gt;<i>just made it for me and I am looking what you done.
</I>&gt;<i>In the moment I am not certain wether it alter the visible
</I>&gt;<i>panel counting or not. If so I have to ponder for an other
</I>&gt;<i>solution.
</I>&gt;<i>I will test it and fix the bug you have reported as soon as
</I>&gt;<i>possible.
</I>&gt;<i>
</I>&gt;<i>Cheers
</I>&gt;<i>
</I>&gt;<i>Klaus
</I>&gt;<i>
</I>&gt;&gt;<i>-----Original Message-----
</I>&gt;&gt;<i>From: <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel-bounces at lists.berlios.de</A>
</I>&gt;&gt;<i>[mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel-bounces at lists.berlios.de</A>]On Behalf Of Fran&#231;ois
</I>&gt;&gt;<i>Guillet
</I>&gt;&gt;<i>Sent: Monday, November 06, 2006 7:30 AM
</I>&gt;&gt;<i>To: <A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel at lists.berlios.de</A>
</I>&gt;&gt;<i>Subject: [izpack-devel] Bug in InstallerFrame.java, v3.9.0
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I was asked by Julien to report this bug to the izpack-devel mailing
</I>&gt;&gt;<i>list.
</I>&gt;&gt;<i>While making an installer for both Windows and Linux using 
</I>&gt;&gt;<i>IzPack, I had
</I>&gt;&gt;<i>to resort to OS Specific panels. But having a windows only panel when
</I>&gt;&gt;<i>installing under Linux raised an exception (and vice versa). The point
</I>&gt;&gt;<i>is that OS dependant panels are incorrectly ignored in
</I>&gt;&gt;<i>InstallerFrame.loadPanels(). The error is pretty easy to 
</I>&gt;<i>reproduce so I
</I>&gt;&gt;<i>won't reprint the full error exception trace. I badly need those OS
</I>&gt;&gt;<i>dependant panels (that's one of the major points of a cross-platform
</I>&gt;&gt;<i>installer), so I made a quick fix in the source code. Here is the
</I>&gt;&gt;<i>modified source code for InstallerFrame.loadPanels(). It's a
</I>&gt;&gt;<i>straightforward quick hack which may be a bit crude, but it 
</I>&gt;&gt;<i>allows me to
</I>&gt;&gt;<i>finish the installer for the Art of Illusion project
</I>&gt;&gt;<i>(<A HREF="http://www.artofillusion.org">http://www.artofillusion.org</A>).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>The full InstallerFrame.java code is attached.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Fran&#231;ois.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    private void loadPanels() throws Exception
</I>&gt;&gt;<i>    {
</I>&gt;&gt;<i>        // Initialisation
</I>&gt;&gt;<i>        java.util.List panelsOrder = installdata.panelsOrder;
</I>&gt;&gt;<i>        int i;
</I>&gt;&gt;<i>        int size = panelsOrder.size();
</I>&gt;&gt;<i>        String className;
</I>&gt;&gt;<i>        Class objectClass;
</I>&gt;&gt;<i>        Constructor constructor;
</I>&gt;&gt;<i>        Object object;
</I>&gt;&gt;<i>        IzPanel panel;
</I>&gt;&gt;<i>        Class[] paramsClasses = new Class[2];
</I>&gt;&gt;<i>        paramsClasses[0] =
</I>&gt;&gt;<i>Class.forName(&quot;com.izforge.izpack.installer.InstallerFrame&quot;);
</I>&gt;&gt;<i>        paramsClasses[1] =
</I>&gt;&gt;<i>Class.forName(&quot;com.izforge.izpack.installer.InstallData&quot;);
</I>&gt;&gt;<i>        Object[] params = { this, installdata};
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        // We load each of them
</I>&gt;&gt;<i>        int curVisPanelNumber = 0;
</I>&gt;&gt;<i>        int lastVis = 0;
</I>&gt;&gt;<i>        int count = 0;
</I>&gt;&gt;<i>        for (i = 0; i &lt; size; i++)
</I>&gt;&gt;<i>        {
</I>&gt;&gt;<i>            // We add the panel
</I>&gt;&gt;<i>            Panel p = (Panel) panelsOrder.get(i);
</I>&gt;&gt;<i>            if 
</I>&gt;<i>(!OsConstraint.oneMatchesCurrentSystem(p.osConstraints))
</I>&gt;&gt;<i>                    continue;
</I>&gt;&gt;<i>            className = p.className;
</I>&gt;&gt;<i>            String praefix = &quot;com.izforge.izpack.panels.&quot;;
</I>&gt;&gt;<i>            if (className.indexOf('.') &gt; -1)
</I>&gt;&gt;<i>            // Full qualified class name
</I>&gt;&gt;<i>                praefix = &quot;&quot;;
</I>&gt;&gt;<i>            objectClass = Class.forName(praefix + className);
</I>&gt;&gt;<i>            constructor =
</I>&gt;&gt;<i>objectClass.getDeclaredConstructor(paramsClasses);
</I>&gt;&gt;<i>            object = constructor.newInstance(params);
</I>&gt;&gt;<i>            panel = (IzPanel) object;
</I>&gt;&gt;<i>            installdata.panels.add(panel);
</I>&gt;&gt;<i>            if (panel.isHidden())
</I>&gt;&gt;<i>                visiblePanelMapping.add(i, new Integer(-1));
</I>&gt;&gt;<i>            else
</I>&gt;&gt;<i>            {
</I>&gt;&gt;<i>                visiblePanelMapping.add(count, new
</I>&gt;&gt;<i>Integer(curVisPanelNumber));
</I>&gt;&gt;<i>                curVisPanelNumber++;
</I>&gt;&gt;<i>                lastVis = count;
</I>&gt;&gt;<i>            }
</I>&gt;&gt;<i>            count++;
</I>&gt;&gt;<i>            // We add the XML data panel root
</I>&gt;&gt;<i>            XMLElement panelRoot = new XMLElement(className);
</I>&gt;&gt;<i>            installdata.xmlData.addChild(panelRoot);
</I>&gt;&gt;<i>        }
</I>&gt;&gt;<i>        visiblePanelMapping.add(count,new Integer(lastVis));
</I>&gt;&gt;<i>    }
</I>&gt;&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>izpack-devel mailing list
</I>&gt;<i><A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">izpack-devel at lists.berlios.de</A>
</I>&gt;<i><A HREF="https://lists.berlios.de/mailman/listinfo/izpack-devel">https://lists.berlios.de/mailman/listinfo/izpack-devel</A>
</I>&gt;<i>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000554.html">[izpack-devel] Bug in InstallerFrame.java, v3.9.0
</A></li>
	<LI>Next message: <A HREF="000556.html">[izpack-devel] Bug in InstallerFrame.java, v3.9.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#555">[ date ]</a>
              <a href="thread.html#555">[ thread ]</a>
              <a href="subject.html#555">[ subject ]</a>
              <a href="author.html#555">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/izpack-devel">More information about the izpack-devel
mailing list</a><br>
</body></html>
